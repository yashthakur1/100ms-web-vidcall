(self.webpackChunk=self.webpackChunk||[]).push([[404],{8404:function(Ct){typeof window<"u"&&function(F,T){Ct.exports=T()}(this,function(){return function(G){var F={};function T(M){if(F[M])return F[M].exports;var O=F[M]={i:M,l:!1,exports:{}};return G[M].call(O.exports,O,O.exports,T),O.l=!0,O.exports}return T.m=G,T.c=F,T.d=function(M,O,D){T.o(M,O)||Object.defineProperty(M,O,{enumerable:!0,get:D})},T.r=function(M){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(M,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(M,"__esModule",{value:!0})},T.t=function(M,O){if(O&1&&(M=T(M)),O&8||O&4&&typeof M=="object"&&M&&M.__esModule)return M;var D=Object.create(null);if(T.r(D),Object.defineProperty(D,"default",{enumerable:!0,value:M}),O&2&&typeof M!="string")for(var b in M)T.d(D,b,function(C){return M[C]}.bind(null,b));return D},T.n=function(M){var O=M&&M.__esModule?function(){return M.default}:function(){return M};return T.d(O,"a",O),O},T.o=function(M,O){return Object.prototype.hasOwnProperty.call(M,O)},T.p="/dist/",T(T.s="./src/hls.ts")}({"./node_modules/eventemitter3/index.js":function(G,F,T){"use strict";var M=Object.prototype.hasOwnProperty,O="~";function D(){}Object.create&&(D.prototype=Object.create(null),new D().__proto__||(O=!1));function b(g,y,L){this.fn=g,this.context=y,this.once=L||!1}function C(g,y,L,p,E){if(typeof L!="function")throw new TypeError("The listener must be a function");var m=new b(L,p||g,E),u=O?O+y:y;return g._events[u]?g._events[u].fn?g._events[u]=[g._events[u],m]:g._events[u].push(m):(g._events[u]=m,g._eventsCount++),g}function I(g,y){--g._eventsCount===0?g._events=new D:delete g._events[y]}function A(){this._events=new D,this._eventsCount=0}A.prototype.eventNames=function(){var y=[],L,p;if(this._eventsCount===0)return y;for(p in L=this._events)M.call(L,p)&&y.push(O?p.slice(1):p);return Object.getOwnPropertySymbols?y.concat(Object.getOwnPropertySymbols(L)):y},A.prototype.listeners=function(y){var L=O?O+y:y,p=this._events[L];if(!p)return[];if(p.fn)return[p.fn];for(var E=0,m=p.length,u=new Array(m);E<m;E++)u[E]=p[E].fn;return u},A.prototype.listenerCount=function(y){var L=O?O+y:y,p=this._events[L];return p?p.fn?1:p.length:0},A.prototype.emit=function(y,L,p,E,m,u){var t=O?O+y:y;if(!this._events[t])return!1;var r=this._events[t],e=arguments.length,f,o;if(r.fn){switch(r.once&&this.removeListener(y,r.fn,void 0,!0),e){case 1:return r.fn.call(r.context),!0;case 2:return r.fn.call(r.context,L),!0;case 3:return r.fn.call(r.context,L,p),!0;case 4:return r.fn.call(r.context,L,p,E),!0;case 5:return r.fn.call(r.context,L,p,E,m),!0;case 6:return r.fn.call(r.context,L,p,E,m,u),!0}for(o=1,f=new Array(e-1);o<e;o++)f[o-1]=arguments[o];r.fn.apply(r.context,f)}else{var a=r.length,v;for(o=0;o<a;o++)switch(r[o].once&&this.removeListener(y,r[o].fn,void 0,!0),e){case 1:r[o].fn.call(r[o].context);break;case 2:r[o].fn.call(r[o].context,L);break;case 3:r[o].fn.call(r[o].context,L,p);break;case 4:r[o].fn.call(r[o].context,L,p,E);break;default:if(!f)for(v=1,f=new Array(e-1);v<e;v++)f[v-1]=arguments[v];r[o].fn.apply(r[o].context,f)}}return!0},A.prototype.on=function(y,L,p){return C(this,y,L,p,!1)},A.prototype.once=function(y,L,p){return C(this,y,L,p,!0)},A.prototype.removeListener=function(y,L,p,E){var m=O?O+y:y;if(!this._events[m])return this;if(!L)return I(this,m),this;var u=this._events[m];if(u.fn)u.fn===L&&(!E||u.once)&&(!p||u.context===p)&&I(this,m);else{for(var t=0,r=[],e=u.length;t<e;t++)(u[t].fn!==L||E&&!u[t].once||p&&u[t].context!==p)&&r.push(u[t]);r.length?this._events[m]=r.length===1?r[0]:r:I(this,m)}return this},A.prototype.removeAllListeners=function(y){var L;return y?(L=O?O+y:y,this._events[L]&&I(this,L)):(this._events=new D,this._eventsCount=0),this},A.prototype.off=A.prototype.removeListener,A.prototype.addListener=A.prototype.on,A.prefixed=O,A.EventEmitter=A,G.exports=A},"./node_modules/url-toolkit/src/url-toolkit.js":function(G,F,T){(function(M){var O=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/?#]*\/)*[^;?#]*)?(;[^?#]*)?(\?[^#]*)?(#[^]*)?$/,D=/^([^\/?#]*)([^]*)$/,b=/(?:\/|^)\.(?=\/)/g,C=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,I={buildAbsoluteURL:function(A,g,y){if(y=y||{},A=A.trim(),g=g.trim(),!g){if(!y.alwaysNormalize)return A;var L=I.parseURL(A);if(!L)throw new Error("Error trying to parse base URL.");return L.path=I.normalizePath(L.path),I.buildURLFromParts(L)}var p=I.parseURL(g);if(!p)throw new Error("Error trying to parse relative URL.");if(p.scheme)return y.alwaysNormalize?(p.path=I.normalizePath(p.path),I.buildURLFromParts(p)):g;var E=I.parseURL(A);if(!E)throw new Error("Error trying to parse base URL.");if(!E.netLoc&&E.path&&E.path[0]!=="/"){var m=D.exec(E.path);E.netLoc=m[1],E.path=m[2]}E.netLoc&&!E.path&&(E.path="/");var u={scheme:E.scheme,netLoc:p.netLoc,path:null,params:p.params,query:p.query,fragment:p.fragment};if(!p.netLoc&&(u.netLoc=E.netLoc,p.path[0]!=="/"))if(!p.path)u.path=E.path,p.params||(u.params=E.params,p.query||(u.query=E.query));else{var t=E.path,r=t.substring(0,t.lastIndexOf("/")+1)+p.path;u.path=I.normalizePath(r)}return u.path===null&&(u.path=y.alwaysNormalize?I.normalizePath(p.path):p.path),I.buildURLFromParts(u)},parseURL:function(A){var g=O.exec(A);return g?{scheme:g[1]||"",netLoc:g[2]||"",path:g[3]||"",params:g[4]||"",query:g[5]||"",fragment:g[6]||""}:null},normalizePath:function(A){for(A=A.split("").reverse().join("").replace(b,"");A.length!==(A=A.replace(C,"")).length;);return A.split("").reverse().join("")},buildURLFromParts:function(A){return A.scheme+A.netLoc+A.path+A.params+A.query+A.fragment}};G.exports=I})(this)},"./node_modules/webworkify-webpack/index.js":function(G,F,T){function M(y){var L={};function p(m){if(L[m])return L[m].exports;var u=L[m]={i:m,l:!1,exports:{}};return y[m].call(u.exports,u,u.exports,p),u.l=!0,u.exports}p.m=y,p.c=L,p.i=function(m){return m},p.d=function(m,u,t){p.o(m,u)||Object.defineProperty(m,u,{configurable:!1,enumerable:!0,get:t})},p.r=function(m){Object.defineProperty(m,"__esModule",{value:!0})},p.n=function(m){var u=m&&m.__esModule?function(){return m.default}:function(){return m};return p.d(u,"a",u),u},p.o=function(m,u){return Object.prototype.hasOwnProperty.call(m,u)},p.p="/",p.oe=function(m){throw console.error(m),m};var E=p(p.s=ENTRY_MODULE);return E.default||E}var O="[\\.|\\-|\\+|\\w|/|@]+",D="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+O+").*?\\)";function b(y){return(y+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function C(y){return!isNaN(1*y)}function I(y,L,p){var E={};E[p]=[];var m=L.toString(),u=m.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!u)return E;for(var t=u[1],r=new RegExp("(\\\\n|\\W)"+b(t)+D,"g"),e;e=r.exec(m);)e[3]!=="dll-reference"&&E[p].push(e[3]);for(r=new RegExp("\\("+b(t)+'\\("(dll-reference\\s('+O+'))"\\)\\)'+D,"g");e=r.exec(m);)y[e[2]]||(E[p].push(e[1]),y[e[2]]=T(e[1]).m),E[e[2]]=E[e[2]]||[],E[e[2]].push(e[4]);for(var f=Object.keys(E),o=0;o<f.length;o++)for(var a=0;a<E[f[o]].length;a++)C(E[f[o]][a])&&(E[f[o]][a]=1*E[f[o]][a]);return E}function A(y){var L=Object.keys(y);return L.reduce(function(p,E){return p||y[E].length>0},!1)}function g(y,L){for(var p={main:[L]},E={main:[]},m={main:{}};A(p);)for(var u=Object.keys(p),t=0;t<u.length;t++){var r=u[t],e=p[r],f=e.pop();if(m[r]=m[r]||{},!(m[r][f]||!y[r][f])){m[r][f]=!0,E[r]=E[r]||[],E[r].push(f);for(var o=I(y,y[r][f],r),a=Object.keys(o),v=0;v<a.length;v++)p[a[v]]=p[a[v]]||[],p[a[v]]=p[a[v]].concat(o[a[v]])}}return E}G.exports=function(y,L){L=L||{};var p={main:T.m},E=L.all?{main:Object.keys(p.main)}:g(p,y),m="";Object.keys(E).filter(function(f){return f!=="main"}).forEach(function(f){for(var o=0;E[f][o];)o++;E[f].push(o),p[f][o]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",m=m+"var "+f+" = ("+M.toString().replace("ENTRY_MODULE",JSON.stringify(o))+")({"+E[f].map(function(a){return""+JSON.stringify(a)+": "+p[f][a].toString()}).join(",")+`});
`}),m=m+"new (("+M.toString().replace("ENTRY_MODULE",JSON.stringify(y))+")({"+E.main.map(function(f){return""+JSON.stringify(f)+": "+p.main[f].toString()}).join(",")+"}))(self);";var u=new window.Blob([m],{type:"text/javascript"});if(L.bare)return u;var t=window.URL||window.webkitURL||window.mozURL||window.msURL,r=t.createObjectURL(u),e=new window.Worker(r);return e.objectURL=r,e}},"./src/config.ts":function(G,F,T){"use strict";T.r(F),T.d(F,"hlsDefaultConfig",function(){return v}),T.d(F,"mergeConfig",function(){return l}),T.d(F,"enableStreamingMode",function(){return s});var M=T("./src/controller/abr-controller.ts"),O=T("./src/controller/audio-stream-controller.ts"),D=T("./src/controller/audio-track-controller.ts"),b=T("./src/controller/subtitle-stream-controller.ts"),C=T("./src/controller/subtitle-track-controller.ts"),I=T("./src/controller/buffer-controller.ts"),A=T("./src/controller/timeline-controller.ts"),g=T("./src/controller/cap-level-controller.ts"),y=T("./src/controller/fps-controller.ts"),L=T("./src/controller/eme-controller.ts"),p=T("./src/controller/cmcd-controller.ts"),E=T("./src/utils/xhr-loader.ts"),m=T("./src/utils/fetch-loader.ts"),u=T("./src/utils/cues.ts"),t=T("./src/utils/mediakeys-helper.ts"),r=T("./src/utils/logger.ts");function e(){return e=Object.assign||function(n){for(var i=1;i<arguments.length;i++){var d=arguments[i];for(var c in d)Object.prototype.hasOwnProperty.call(d,c)&&(n[c]=d[c])}return n},e.apply(this,arguments)}function f(n,i){var d=Object.keys(n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(n);i&&(c=c.filter(function(S){return Object.getOwnPropertyDescriptor(n,S).enumerable})),d.push.apply(d,c)}return d}function o(n){for(var i=1;i<arguments.length;i++){var d=arguments[i]!=null?arguments[i]:{};i%2?f(Object(d),!0).forEach(function(c){a(n,c,d[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(d)):f(Object(d)).forEach(function(c){Object.defineProperty(n,c,Object.getOwnPropertyDescriptor(d,c))})}return n}function a(n,i,d){return i in n?Object.defineProperty(n,i,{value:d,enumerable:!0,configurable:!0,writable:!0}):n[i]=d,n}var v=o(o({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:60*1e3*1e3,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:E.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:M.default,bufferController:I.default,capLevelController:g.default,fpsController:y.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:t.requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0},h()),{},{subtitleStreamController:b.SubtitleStreamController,subtitleTrackController:C.default,timelineController:A.TimelineController,audioStreamController:O.default,audioTrackController:D.default,emeController:L.default,cmcdController:p.default});function h(){return{cueHandler:u.default,enableCEA708Captions:!0,enableWebVTT:!0,enableIMSC1:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function l(n,i){if((i.liveSyncDurationCount||i.liveMaxLatencyDurationCount)&&(i.liveSyncDuration||i.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(i.liveMaxLatencyDurationCount!==void 0&&(i.liveSyncDurationCount===void 0||i.liveMaxLatencyDurationCount<=i.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(i.liveMaxLatencyDuration!==void 0&&(i.liveSyncDuration===void 0||i.liveMaxLatencyDuration<=i.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return e({},n,i)}function s(n){var i=n.loader;if(i!==m.default&&i!==E.default)r.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),n.progressive=!1;else{var d=Object(m.fetchSupported)();d&&(n.loader=m.default,n.progressive=!0,n.enableSoftwareAES=!0,r.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}}},"./src/controller/abr-controller.ts":function(G,F,T){"use strict";T.r(F);var M=T("./src/polyfills/number.ts"),O=T("./src/utils/ewma-bandwidth-estimator.ts"),D=T("./src/events.ts"),b=T("./src/utils/buffer-helper.ts"),C=T("./src/errors.ts"),I=T("./src/types/loader.ts"),A=T("./src/utils/logger.ts");function g(p,E){for(var m=0;m<E.length;m++){var u=E[m];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(p,u.key,u)}}function y(p,E,m){return E&&g(p.prototype,E),m&&g(p,m),p}var L=function(){function p(m){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=m;var u=m.config;this.bwEstimator=new O.default(u.abrEwmaSlowVoD,u.abrEwmaFastVoD,u.abrEwmaDefaultEstimate),this.registerListeners()}var E=p.prototype;return E.registerListeners=function(){var u=this.hls;u.on(D.Events.FRAG_LOADING,this.onFragLoading,this),u.on(D.Events.FRAG_LOADED,this.onFragLoaded,this),u.on(D.Events.FRAG_BUFFERED,this.onFragBuffered,this),u.on(D.Events.LEVEL_LOADED,this.onLevelLoaded,this),u.on(D.Events.ERROR,this.onError,this)},E.unregisterListeners=function(){var u=this.hls;u.off(D.Events.FRAG_LOADING,this.onFragLoading,this),u.off(D.Events.FRAG_LOADED,this.onFragLoaded,this),u.off(D.Events.FRAG_BUFFERED,this.onFragBuffered,this),u.off(D.Events.LEVEL_LOADED,this.onLevelLoaded,this),u.off(D.Events.ERROR,this.onError,this)},E.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},E.onFragLoading=function(u,t){var r=t.frag;if(r.type===I.PlaylistLevelType.MAIN&&!this.timer){var e;this.fragCurrent=r,this.partCurrent=(e=t.part)!=null?e:null,this.timer=self.setInterval(this.onCheck,100)}},E.onLevelLoaded=function(u,t){var r=this.hls.config;t.details.live?this.bwEstimator.update(r.abrEwmaSlowLive,r.abrEwmaFastLive):this.bwEstimator.update(r.abrEwmaSlowVoD,r.abrEwmaFastVoD)},E._abandonRulesCheck=function(){var u=this.fragCurrent,t=this.partCurrent,r=this.hls,e=r.autoLevelEnabled,f=r.config,o=r.media;if(!(!u||!o)){var a=t?t.stats:u.stats,v=t?t.duration:u.duration;if(a.aborted){A.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),this._nextAutoLevel=-1;return}if(!(!e||o.paused||!o.playbackRate||!o.readyState)){var h=performance.now()-a.loading.start,l=Math.abs(o.playbackRate);if(!(h<=500*v/l)){var s=r.levels,n=r.minAutoLevel,i=s[u.level],d=a.total||Math.max(a.loaded,Math.round(v*i.maxBitrate/8)),c=Math.max(1,a.bwEstimate?a.bwEstimate/8:a.loaded*1e3/h),S=(d-a.loaded)/c,R=o.currentTime,P=(b.BufferHelper.bufferInfo(o,R,f.maxBufferHole).end-R)/l;if(!(P>=2*v/l||S<=P)){var B=Number.POSITIVE_INFINITY,x;for(x=u.level-1;x>n;x--){var U=s[x].maxBitrate;if(B=v*U/(8*.8*c),B<P)break}if(!(B>=S)){var k=this.bwEstimator.getEstimate();A.logger.warn("Fragment "+u.sn+(t?" part "+t.index:"")+" of level "+u.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+x+`
      Current BW estimate: `+(Object(M.isFiniteNumber)(k)?(k/1024).toFixed(3):"Unknown")+` Kb/s
      Estimated load time for current fragment: `+S.toFixed(3)+` s
      Estimated load time for the next fragment: `+B.toFixed(3)+` s
      Time to underbuffer: `+P.toFixed(3)+" s"),r.nextLoadLevel=x,this.bwEstimator.sample(h,a.loaded),this.clearTimer(),u.loader&&(this.fragCurrent=this.partCurrent=null,u.loader.abort()),r.trigger(D.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:u,part:t,stats:a})}}}}}},E.onFragLoaded=function(u,t){var r=t.frag,e=t.part;if(r.type===I.PlaylistLevelType.MAIN&&Object(M.isFiniteNumber)(r.sn)){var f=e?e.stats:r.stats,o=e?e.duration:r.duration;if(this.clearTimer(),this.lastLoadedFragLevel=r.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var a=this.hls.levels[r.level],v=(a.loaded?a.loaded.bytes:0)+f.loaded,h=(a.loaded?a.loaded.duration:0)+o;a.loaded={bytes:v,duration:h},a.realBitrate=Math.round(8*v/h)}if(r.bitrateTest){var l={stats:f,frag:r,part:e,id:r.type};this.onFragBuffered(D.Events.FRAG_BUFFERED,l),r.bitrateTest=!1}}},E.onFragBuffered=function(u,t){var r=t.frag,e=t.part,f=e?e.stats:r.stats;if(!f.aborted&&!(r.type!==I.PlaylistLevelType.MAIN||r.sn==="initSegment")){var o=f.parsing.end-f.loading.start;this.bwEstimator.sample(o,f.loaded),f.bwEstimate=this.bwEstimator.getEstimate(),r.bitrateTest?this.bitrateTestDelay=o/1e3:this.bitrateTestDelay=0}},E.onError=function(u,t){switch(t.details){case C.ErrorDetails.FRAG_LOAD_ERROR:case C.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer();break;default:break}},E.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},E.getNextABRAutoLevel=function(){var u=this.fragCurrent,t=this.partCurrent,r=this.hls,e=r.maxAutoLevel,f=r.config,o=r.minAutoLevel,a=r.media,v=t?t.duration:u?u.duration:0,h=a?a.currentTime:0,l=a&&a.playbackRate!==0?Math.abs(a.playbackRate):1,s=this.bwEstimator?this.bwEstimator.getEstimate():f.abrEwmaDefaultEstimate,n=(b.BufferHelper.bufferInfo(a,h,f.maxBufferHole).end-h)/l,i=this.findBestLevel(s,o,e,n,f.abrBandWidthFactor,f.abrBandWidthUpFactor);if(i>=0)return i;A.logger.trace((n?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var d=v?Math.min(v,f.maxStarvationDelay):f.maxStarvationDelay,c=f.abrBandWidthFactor,S=f.abrBandWidthUpFactor;if(!n){var R=this.bitrateTestDelay;if(R){var P=v?Math.min(v,f.maxLoadingDelay):f.maxLoadingDelay;d=P-R,A.logger.trace("bitrate test took "+Math.round(1e3*R)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*d)+" ms"),c=S=1}}return i=this.findBestLevel(s,o,e,n+d,c,S),Math.max(i,0)},E.findBestLevel=function(u,t,r,e,f,o){for(var a,v=this.fragCurrent,h=this.partCurrent,l=this.lastLoadedFragLevel,s=this.hls.levels,n=s[l],i=!!(n!=null&&(a=n.details)!==null&&a!==void 0&&a.live),d=n==null?void 0:n.codecSet,c=h?h.duration:v?v.duration:0,S=r;S>=t;S--){var R=s[S];if(!(!R||d&&R.codecSet!==d)){var P=R.details,B=(h?P==null?void 0:P.partTarget:P==null?void 0:P.averagetargetduration)||c,x=void 0;S<=l?x=f*u:x=o*u;var U=s[S].maxBitrate,k=U*B/x;if(A.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+S+"/"+Math.round(x)+"/"+U+"/"+B+"/"+e+"/"+k),x>U&&(!k||i&&!this.bitrateTestDelay||k<e))return S}}return-1},y(p,[{key:"nextAutoLevel",get:function(){var u=this._nextAutoLevel,t=this.bwEstimator;if(u!==-1&&(!t||!t.canEstimate()))return u;var r=this.getNextABRAutoLevel();return u!==-1&&(r=Math.min(u,r)),r},set:function(u){this._nextAutoLevel=u}}]),p}();F.default=L},"./src/controller/audio-stream-controller.ts":function(G,F,T){"use strict";T.r(F);var M=T("./src/polyfills/number.ts"),O=T("./src/controller/base-stream-controller.ts"),D=T("./src/events.ts"),b=T("./src/utils/buffer-helper.ts"),C=T("./src/controller/fragment-tracker.ts"),I=T("./src/types/level.ts"),A=T("./src/types/loader.ts"),g=T("./src/loader/fragment.ts"),y=T("./src/demux/chunk-cache.ts"),L=T("./src/demux/transmuxer-interface.ts"),p=T("./src/types/transmuxer.ts"),E=T("./src/controller/fragment-finders.ts"),m=T("./src/utils/discontinuities.ts"),u=T("./src/errors.ts"),t=T("./src/utils/logger.ts");function r(){return r=Object.assign||function(v){for(var h=1;h<arguments.length;h++){var l=arguments[h];for(var s in l)Object.prototype.hasOwnProperty.call(l,s)&&(v[s]=l[s])}return v},r.apply(this,arguments)}function e(v,h){v.prototype=Object.create(h.prototype),v.prototype.constructor=v,f(v,h)}function f(v,h){return f=Object.setPrototypeOf||function(s,n){return s.__proto__=n,s},f(v,h)}var o=100,a=function(v){e(h,v);function h(s,n){var i;return i=v.call(this,s,n,"[audio-stream-controller]")||this,i.videoBuffer=null,i.videoTrackCC=-1,i.waitingVideoCC=-1,i.audioSwitch=!1,i.trackId=-1,i.waitingData=null,i.mainDetails=null,i.bufferFlushed=!1,i._registerListeners(),i}var l=h.prototype;return l.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},l._registerListeners=function(){var n=this.hls;n.on(D.Events.MEDIA_ATTACHED,this.onMediaAttached,this),n.on(D.Events.MEDIA_DETACHING,this.onMediaDetaching,this),n.on(D.Events.MANIFEST_LOADING,this.onManifestLoading,this),n.on(D.Events.LEVEL_LOADED,this.onLevelLoaded,this),n.on(D.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),n.on(D.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),n.on(D.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),n.on(D.Events.ERROR,this.onError,this),n.on(D.Events.BUFFER_RESET,this.onBufferReset,this),n.on(D.Events.BUFFER_CREATED,this.onBufferCreated,this),n.on(D.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),n.on(D.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),n.on(D.Events.FRAG_BUFFERED,this.onFragBuffered,this)},l._unregisterListeners=function(){var n=this.hls;n.off(D.Events.MEDIA_ATTACHED,this.onMediaAttached,this),n.off(D.Events.MEDIA_DETACHING,this.onMediaDetaching,this),n.off(D.Events.MANIFEST_LOADING,this.onManifestLoading,this),n.off(D.Events.LEVEL_LOADED,this.onLevelLoaded,this),n.off(D.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),n.off(D.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),n.off(D.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),n.off(D.Events.ERROR,this.onError,this),n.off(D.Events.BUFFER_RESET,this.onBufferReset,this),n.off(D.Events.BUFFER_CREATED,this.onBufferCreated,this),n.off(D.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),n.off(D.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),n.off(D.Events.FRAG_BUFFERED,this.onFragBuffered,this)},l.onInitPtsFound=function(n,i){var d=i.frag,c=i.id,S=i.initPTS;if(c==="main"){var R=d.cc;this.initPTS[d.cc]=S,this.log("InitPTS for cc: "+R+" found from main: "+S),this.videoTrackCC=R,this.state===O.State.WAITING_INIT_PTS&&this.tick()}},l.startLoad=function(n){if(!this.levels){this.startPosition=n,this.state=O.State.STOPPED;return}var i=this.lastCurrentTime;this.stopLoad(),this.setInterval(o),this.fragLoadError=0,i>0&&n===-1?(this.log("Override startPosition with lastCurrentTime @"+i.toFixed(3)),this.state=O.State.IDLE):(this.loadedmetadata=!1,this.state=O.State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=n,this.tick()},l.doTick=function(){switch(this.state){case O.State.IDLE:this.doTickIdle();break;case O.State.WAITING_TRACK:{var n,i=this.levels,d=this.trackId,c=i==null||(n=i[d])===null||n===void 0?void 0:n.details;if(c){if(this.waitForCdnTuneIn(c))break;this.state=O.State.WAITING_INIT_PTS}break}case O.State.FRAG_LOADING_WAITING_RETRY:{var S,R=performance.now(),P=this.retryDate;(!P||R>=P||(S=this.media)!==null&&S!==void 0&&S.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.state=O.State.IDLE);break}case O.State.WAITING_INIT_PTS:{var B=this.waitingData;if(B){var x=B.frag,U=B.part,k=B.cache,N=B.complete;if(this.initPTS[x.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=O.State.FRAG_LOADING;var K=k.flush(),W={frag:x,part:U,payload:K,networkDetails:null};this._handleFragmentLoadProgress(W),N&&v.prototype._handleFragmentLoadComplete.call(this,W)}else if(this.videoTrackCC!==this.waitingVideoCC)t.logger.log("Waiting fragment cc ("+x.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var w=this.getLoadPosition(),H=b.BufferHelper.bufferInfo(this.mediaBuffer,w,this.config.maxBufferHole),V=Object(E.fragmentWithinToleranceTest)(H.end,this.config.maxFragLookUpTolerance,x);V<0&&(t.logger.log("Waiting fragment cc ("+x.cc+") @ "+x.start+" cancelled because another fragment at "+H.end+" is needed"),this.clearWaitingFragment())}}else this.state=O.State.IDLE}}this.onTickEnd()},l.clearWaitingFragment=function(){var n=this.waitingData;n&&(this.fragmentTracker.removeFragment(n.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=O.State.IDLE)},l.onTickEnd=function(){var n=this.media;if(!(!n||!n.readyState)){var i=this.mediaBuffer?this.mediaBuffer:n,d=i.buffered;!this.loadedmetadata&&d.length&&(this.loadedmetadata=!0),this.lastCurrentTime=n.currentTime}},l.doTickIdle=function(){var n,i,d=this.hls,c=this.levels,S=this.media,R=this.trackId,P=d.config;if(!(!c||!c[R])&&!(!S&&(this.startFragRequested||!P.startFragPrefetch))){var B=c[R],x=B.details;if(!x||x.live&&this.levelLastLoaded!==R||this.waitForCdnTuneIn(x)){this.state=O.State.WAITING_TRACK;return}this.bufferFlushed&&(this.bufferFlushed=!1,this.afterBufferFlushed(this.mediaBuffer?this.mediaBuffer:this.media,g.ElementaryStreamTypes.AUDIO,A.PlaylistLevelType.AUDIO));var U=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,A.PlaylistLevelType.AUDIO);if(U!==null){var k=U.len,N=this.getMaxBufferLength(),K=this.audioSwitch;if(!(k>=N&&!K)){if(!K&&this._streamEnded(U,x)){d.trigger(D.Events.BUFFER_EOS,{type:"audio"}),this.state=O.State.ENDED;return}var W=x.fragments,w=W[0].start,H=U.end;if(K){var V=this.getLoadPosition();H=V,x.PTSKnown&&V<w&&(U.end>w||U.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),S.currentTime=w+.05)}var j=this.getNextFragment(H,x);if(!j){this.bufferFlushed=!0;return}((n=j.decryptdata)===null||n===void 0?void 0:n.keyFormat)==="identity"&&!((i=j.decryptdata)!==null&&i!==void 0&&i.key)?this.loadKey(j,x):this.loadFragment(j,x,H)}}}},l.getMaxBufferLength=function(){var n=v.prototype.getMaxBufferLength.call(this),i=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,A.PlaylistLevelType.MAIN);return i===null?n:Math.max(n,i.len)},l.onMediaDetaching=function(){this.videoBuffer=null,v.prototype.onMediaDetaching.call(this)},l.onAudioTracksUpdated=function(n,i){var d=i.audioTracks;this.resetTransmuxer(),this.levels=d.map(function(c){return new I.Level(c)})},l.onAudioTrackSwitching=function(n,i){var d=!!i.url;this.trackId=i.id;var c=this.fragCurrent;c!=null&&c.loader&&c.loader.abort(),this.fragCurrent=null,this.clearWaitingFragment(),d?this.setInterval(o):this.resetTransmuxer(),d?(this.audioSwitch=!0,this.state=O.State.IDLE):this.state=O.State.STOPPED,this.tick()},l.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},l.onLevelLoaded=function(n,i){this.mainDetails=i.details},l.onAudioTrackLoaded=function(n,i){var d,c=this.levels,S=i.details,R=i.id;if(!c){this.warn("Audio tracks were reset while loading level "+R);return}this.log("Track "+R+" loaded ["+S.startSN+","+S.endSN+"],duration:"+S.totalduration);var P=c[R],B=0;if(S.live||(d=P.details)!==null&&d!==void 0&&d.live){var x=this.mainDetails;if(S.fragments[0]||(S.deltaUpdateFailed=!0),S.deltaUpdateFailed||!x)return;!P.details&&S.hasProgramDateTime&&x.hasProgramDateTime?(Object(m.alignMediaPlaylistByPDT)(S,x),B=S.fragments[0].start):B=this.alignPlaylists(S,P.details)}P.details=S,this.levelLastLoaded=R,!this.startFragRequested&&(this.mainDetails||!S.live)&&this.setStartPosition(P.details,B),this.state===O.State.WAITING_TRACK&&!this.waitForCdnTuneIn(S)&&(this.state=O.State.IDLE),this.tick()},l._handleFragmentLoadProgress=function(n){var i,d=n.frag,c=n.part,S=n.payload,R=this.config,P=this.trackId,B=this.levels;if(!B){this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+d.sn+" of level "+d.level+" will not be buffered");return}var x=B[P];console.assert(x,"Audio track is defined on fragment load progress");var U=x.details;console.assert(U,"Audio track details are defined on fragment load progress");var k=R.defaultAudioCodec||x.audioCodec||"mp4a.40.2",N=this.transmuxer;N||(N=this.transmuxer=new L.default(this.hls,A.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var K=this.initPTS[d.cc],W=(i=d.initSegment)===null||i===void 0?void 0:i.data;if(K!==void 0){var w=!1,H=c?c.index:-1,V=H!==-1,j=new p.ChunkMetadata(d.level,d.sn,d.stats.chunkCount,S.byteLength,H,V);N.push(S,W,k,"",d,c,U.totalduration,w,j,K)}else{t.logger.log("Unknown video PTS for cc "+d.cc+", waiting for video PTS before demuxing audio frag "+d.sn+" of ["+U.startSN+" ,"+U.endSN+"],track "+P);var X=this.waitingData=this.waitingData||{frag:d,part:c,cache:new y.default,complete:!1},Y=X.cache;Y.push(new Uint8Array(S)),this.waitingVideoCC=this.videoTrackCC,this.state=O.State.WAITING_INIT_PTS}},l._handleFragmentLoadComplete=function(n){if(this.waitingData){this.waitingData.complete=!0;return}v.prototype._handleFragmentLoadComplete.call(this,n)},l.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},l.onBufferCreated=function(n,i){var d=i.tracks.audio;d&&(this.mediaBuffer=d.buffer),i.tracks.video&&(this.videoBuffer=i.tracks.video.buffer)},l.onFragBuffered=function(n,i){var d=i.frag,c=i.part;if(d.type===A.PlaylistLevelType.AUDIO){if(this.fragContextChanged(d)){this.warn("Fragment "+d.sn+(c?" p: "+c.index:"")+" of level "+d.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch);return}d.sn!=="initSegment"&&(this.fragPrevious=d,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(D.Events.AUDIO_TRACK_SWITCHED,{id:this.trackId}))),this.fragBufferedComplete(d,c)}},l.onError=function(n,i){switch(i.details){case u.ErrorDetails.FRAG_LOAD_ERROR:case u.ErrorDetails.FRAG_LOAD_TIMEOUT:case u.ErrorDetails.KEY_LOAD_ERROR:case u.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(A.PlaylistLevelType.AUDIO,i);break;case u.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case u.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==O.State.ERROR&&this.state!==O.State.STOPPED&&(this.state=i.fatal?O.State.ERROR:O.State.IDLE,this.warn(i.details+" while loading frag, switching to "+this.state+" state"));break;case u.ErrorDetails.BUFFER_FULL_ERROR:if(i.parent==="audio"&&(this.state===O.State.PARSING||this.state===O.State.PARSED)){var d=!0,c=this.getFwdBufferInfo(this.mediaBuffer,A.PlaylistLevelType.AUDIO);c&&c.len>.5&&(d=!this.reduceMaxBufferLength(c.len)),d&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,v.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}break;default:break}},l.onBufferFlushed=function(n,i){var d=i.type;d===g.ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0)},l._handleTransmuxComplete=function(n){var i,d="audio",c=this.hls,S=n.remuxResult,R=n.chunkMeta,P=this.getCurrentContext(R);if(!P){this.warn("The loading context changed while buffering fragment "+R.sn+" of level "+R.level+". This chunk will not be buffered."),this.resetLiveStartWhenNotLoaded(R.level);return}var B=P.frag,x=P.part,U=S.audio,k=S.text,N=S.id3,K=S.initSegment;if(!this.fragContextChanged(B)){if(this.state=O.State.PARSING,this.audioSwitch&&U&&this.completeAudioSwitch(),K!=null&&K.tracks&&(this._bufferInitSegment(K.tracks,B,R),c.trigger(D.Events.FRAG_PARSING_INIT_SEGMENT,{frag:B,id:d,tracks:K.tracks})),U){var W=U.startPTS,w=U.endPTS,H=U.startDTS,V=U.endDTS;x&&(x.elementaryStreams[g.ElementaryStreamTypes.AUDIO]={startPTS:W,endPTS:w,startDTS:H,endDTS:V}),B.setElementaryStreamInfo(g.ElementaryStreamTypes.AUDIO,W,w,H,V),this.bufferFragmentData(U,B,x,R)}if(N!=null&&(i=N.samples)!==null&&i!==void 0&&i.length){var j=r({frag:B,id:d},N);c.trigger(D.Events.FRAG_PARSING_METADATA,j)}if(k){var X=r({frag:B,id:d},k);c.trigger(D.Events.FRAG_PARSING_USERDATA,X)}}},l._bufferInitSegment=function(n,i,d){if(this.state===O.State.PARSING){n.video&&delete n.video;var c=n.audio;if(!!c){c.levelCodec=c.codec,c.id="audio",this.log("Init audio buffer, container:"+c.container+", codecs[parsed]=["+c.codec+"]"),this.hls.trigger(D.Events.BUFFER_CODECS,n);var S=c.initSegment;if(S!=null&&S.byteLength){var R={type:"audio",frag:i,part:null,chunkMeta:d,parent:i.type,data:S};this.hls.trigger(D.Events.BUFFER_APPENDING,R)}this.tick()}}},l.loadFragment=function(n,i,d){var c=this.fragmentTracker.getState(n);this.fragCurrent=n,(this.audioSwitch||c===C.FragmentState.NOT_LOADED||c===C.FragmentState.PARTIAL)&&(n.sn==="initSegment"?this._loadInitSegment(n):i.live&&!Object(M.isFiniteNumber)(this.initPTS[n.cc])?(this.log("Waiting for video PTS in continuity counter "+n.cc+" of live stream before loading audio fragment "+n.sn+" of level "+this.trackId),this.state=O.State.WAITING_INIT_PTS):(this.startFragRequested=!0,v.prototype.loadFragment.call(this,n,i,d)))},l.completeAudioSwitch=function(){var n=this.hls,i=this.media,d=this.trackId;i&&(this.log("Switching audio track : flushing all audio"),v.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,n.trigger(D.Events.AUDIO_TRACK_SWITCHED,{id:d})},h}(O.default);F.default=a},"./src/controller/audio-track-controller.ts":function(G,F,T){"use strict";T.r(F);var M=T("./src/events.ts"),O=T("./src/errors.ts"),D=T("./src/controller/base-playlist-controller.ts"),b=T("./src/types/loader.ts");function C(L,p){for(var E=0;E<p.length;E++){var m=p[E];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Object.defineProperty(L,m.key,m)}}function I(L,p,E){return p&&C(L.prototype,p),E&&C(L,E),L}function A(L,p){L.prototype=Object.create(p.prototype),L.prototype.constructor=L,g(L,p)}function g(L,p){return g=Object.setPrototypeOf||function(m,u){return m.__proto__=u,m},g(L,p)}var y=function(L){A(p,L);function p(m){var u;return u=L.call(this,m,"[audio-track-controller]")||this,u.tracks=[],u.groupId=null,u.tracksInGroup=[],u.trackId=-1,u.trackName="",u.selectDefaultTrack=!0,u.registerListeners(),u}var E=p.prototype;return E.registerListeners=function(){var u=this.hls;u.on(M.Events.MANIFEST_LOADING,this.onManifestLoading,this),u.on(M.Events.MANIFEST_PARSED,this.onManifestParsed,this),u.on(M.Events.LEVEL_LOADING,this.onLevelLoading,this),u.on(M.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),u.on(M.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),u.on(M.Events.ERROR,this.onError,this)},E.unregisterListeners=function(){var u=this.hls;u.off(M.Events.MANIFEST_LOADING,this.onManifestLoading,this),u.off(M.Events.MANIFEST_PARSED,this.onManifestParsed,this),u.off(M.Events.LEVEL_LOADING,this.onLevelLoading,this),u.off(M.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),u.off(M.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),u.off(M.Events.ERROR,this.onError,this)},E.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,L.prototype.destroy.call(this)},E.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},E.onManifestParsed=function(u,t){this.tracks=t.audioTracks||[]},E.onAudioTrackLoaded=function(u,t){var r=t.id,e=t.details,f=this.tracksInGroup[r];if(!f){this.warn("Invalid audio track id "+r);return}var o=f.details;f.details=t.details,this.log("audioTrack "+r+" loaded ["+e.startSN+"-"+e.endSN+"]"),r===this.trackId&&(this.retryCount=0,this.playlistLoaded(r,t,o))},E.onLevelLoading=function(u,t){this.switchLevel(t.level)},E.onLevelSwitching=function(u,t){this.switchLevel(t.level)},E.switchLevel=function(u){var t=this.hls.levels[u];if(!!(t!=null&&t.audioGroupIds)){var r=t.audioGroupIds[t.urlId];if(this.groupId!==r){this.groupId=r;var e=this.tracks.filter(function(o){return!r||o.groupId===r});this.selectDefaultTrack&&!e.some(function(o){return o.default})&&(this.selectDefaultTrack=!1),this.tracksInGroup=e;var f={audioTracks:e};this.log("Updating audio tracks, "+e.length+' track(s) found in "'+r+'" group-id'),this.hls.trigger(M.Events.AUDIO_TRACKS_UPDATED,f),this.selectInitialTrack()}}},E.onError=function(u,t){L.prototype.onError.call(this,u,t),!(t.fatal||!t.context)&&t.context.type===b.PlaylistContextType.AUDIO_TRACK&&t.context.id===this.trackId&&t.context.groupId===this.groupId&&this.retryLoadingOrFail(t)},E.setAudioTrack=function(u){var t=this.tracksInGroup;if(u<0||u>=t.length){this.warn("Invalid id passed to audio-track controller");return}this.clearTimer();var r=t[this.trackId];this.log("Now switching to audio-track index "+u);var e=t[u],f=e.id,o=e.groupId,a=o===void 0?"":o,v=e.name,h=e.type,l=e.url;if(this.trackId=u,this.trackName=v,this.selectDefaultTrack=!1,this.hls.trigger(M.Events.AUDIO_TRACK_SWITCHING,{id:f,groupId:a,name:v,type:h,url:l}),!(e.details&&!e.details.live)){var s=this.switchParams(e.url,r==null?void 0:r.details);this.loadPlaylist(s)}},E.selectInitialTrack=function(){var u=this.tracksInGroup;console.assert(u.length,"Initial audio track should be selected when tracks are known");var t=this.trackName,r=this.findTrackId(t)||this.findTrackId();r!==-1?this.setAudioTrack(r):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(M.Events.ERROR,{type:O.ErrorTypes.MEDIA_ERROR,details:O.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},E.findTrackId=function(u){for(var t=this.tracksInGroup,r=0;r<t.length;r++){var e=t[r];if((!this.selectDefaultTrack||e.default)&&(!u||u===e.name))return e.id}return-1},E.loadPlaylist=function(u){var t=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(t)){var r=t.id,e=t.groupId,f=t.url;if(u)try{f=u.addDirectives(f)}catch(o){this.warn("Could not construct new URL with HLS Delivery Directives: "+o)}this.log("loading audio-track playlist for id: "+r),this.clearTimer(),this.hls.trigger(M.Events.AUDIO_TRACK_LOADING,{url:f,id:r,groupId:e,deliveryDirectives:u||null})}},I(p,[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(u){this.selectDefaultTrack=!1,this.setAudioTrack(u)}}]),p}(D.default);F.default=y},"./src/controller/base-playlist-controller.ts":function(G,F,T){"use strict";T.r(F),T.d(F,"default",function(){return I});var M=T("./src/polyfills/number.ts"),O=T("./src/types/level.ts"),D=T("./src/controller/level-helper.ts"),b=T("./src/utils/logger.ts"),C=T("./src/errors.ts"),I=function(){function A(y,L){this.hls=void 0,this.timer=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=b.logger.log.bind(b.logger,L+":"),this.warn=b.logger.warn.bind(b.logger,L+":"),this.hls=y}var g=A.prototype;return g.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},g.onError=function(L,p){p.fatal&&p.type===C.ErrorTypes.NETWORK_ERROR&&this.clearTimer()},g.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},g.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.loadPlaylist()},g.stopLoad=function(){this.canLoad=!1,this.clearTimer()},g.switchParams=function(L,p){var E=p==null?void 0:p.renditionReports;if(E)for(var m=0;m<E.length;m++){var u=E[m],t=""+u.URI;if(t===L.substr(-t.length)){var r=parseInt(u["LAST-MSN"]),e=parseInt(u["LAST-PART"]);if(p&&this.hls.config.lowLatencyMode){var f=Math.min(p.age-p.partTarget,p.targetduration);e!==void 0&&f>p.partTarget&&(e+=1)}if(Object(M.isFiniteNumber)(r))return new O.HlsUrlParameters(r,Object(M.isFiniteNumber)(e)?e:void 0,O.HlsSkip.No)}}},g.loadPlaylist=function(L){},g.shouldLoadTrack=function(L){return this.canLoad&&L&&!!L.url&&(!L.details||L.details.live)},g.playlistLoaded=function(L,p,E){var m=this,u=p.details,t=p.stats,r=t.loading.end?Math.max(0,self.performance.now()-t.loading.end):0;if(u.advancedDateTime=Date.now()-r,u.live||E!=null&&E.live){if(u.reloaded(E),E&&this.log("live playlist "+L+" "+(u.advanced?"REFRESHED "+u.lastPartSn+"-"+u.lastPartIndex:"MISSED")),E&&u.fragments.length>0&&Object(D.mergeDetails)(E,u),!this.canLoad||!u.live)return;var e,f=void 0,o=void 0;if(u.canBlockReload&&u.endSN&&u.advanced){var a=this.hls.config.lowLatencyMode,v=u.lastPartSn,h=u.endSN,l=u.lastPartIndex,s=l!==-1,n=v===h,i=a?0:l;s?(f=n?h+1:v,o=n?i:l+1):f=h+1;var d=u.age,c=d+u.ageHeader,S=Math.min(c-u.partTarget,u.targetduration*1.5);if(S>0){if(E&&S>E.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+E.tuneInGoal+" to: "+S+" with playlist age: "+u.age),S=0;else{var R=Math.floor(S/u.targetduration);if(f+=R,o!==void 0){var P=Math.round(S%u.targetduration/u.partTarget);o+=P}this.log("CDN Tune-in age: "+u.ageHeader+"s last advanced "+d.toFixed(2)+"s goal: "+S+" skip sn "+R+" to part "+o)}u.tuneInGoal=S}if(e=this.getDeliveryDirectives(u,p.deliveryDirectives,f,o),a||!n){this.loadPlaylist(e);return}}else e=this.getDeliveryDirectives(u,p.deliveryDirectives,f,o);var B=Object(D.computeReloadInterval)(u,t);f!==void 0&&u.canBlockReload&&(B-=u.partTarget||1),this.log("reload live playlist "+L+" in "+Math.round(B)+" ms"),this.timer=self.setTimeout(function(){return m.loadPlaylist(e)},B)}else this.clearTimer()},g.getDeliveryDirectives=function(L,p,E,m){var u=Object(O.getSkipValue)(L,E);return p!=null&&p.skip&&L.deltaUpdateFailed&&(E=p.msn,m=p.part,u=O.HlsSkip.No),new O.HlsUrlParameters(E,m,u)},g.retryLoadingOrFail=function(L){var p=this,E=this.hls.config,m=this.retryCount<E.levelLoadingMaxRetry;if(m){var u;if(this.retryCount++,L.details.indexOf("LoadTimeOut")>-1&&(u=L.context)!==null&&u!==void 0&&u.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+L.details+'"'),this.loadPlaylist();else{var t=Math.min(Math.pow(2,this.retryCount)*E.levelLoadingRetryDelay,E.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout(function(){return p.loadPlaylist()},t),this.warn("retry playlist loading #"+this.retryCount+" in "+t+' ms after "'+L.details+'"')}}else this.warn('cannot recover from error "'+L.details+'"'),this.clearTimer(),L.fatal=!0;return m},A}()},"./src/controller/base-stream-controller.ts":function(G,F,T){"use strict";T.r(F),T.d(F,"State",function(){return h}),T.d(F,"default",function(){return l});var M=T("./src/polyfills/number.ts"),O=T("./src/task-loop.ts"),D=T("./src/controller/fragment-tracker.ts"),b=T("./src/utils/buffer-helper.ts"),C=T("./src/utils/logger.ts"),I=T("./src/events.ts"),A=T("./src/errors.ts"),g=T("./src/types/transmuxer.ts"),y=T("./src/utils/mp4-tools.ts"),L=T("./src/utils/discontinuities.ts"),p=T("./src/controller/fragment-finders.ts"),E=T("./src/controller/level-helper.ts"),m=T("./src/loader/fragment-loader.ts"),u=T("./src/crypt/decrypter.ts"),t=T("./src/utils/time-ranges.ts"),r=T("./src/types/loader.ts");function e(s,n){for(var i=0;i<n.length;i++){var d=n[i];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(s,d.key,d)}}function f(s,n,i){return n&&e(s.prototype,n),i&&e(s,i),s}function o(s){if(s===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return s}function a(s,n){s.prototype=Object.create(n.prototype),s.prototype.constructor=s,v(s,n)}function v(s,n){return v=Object.setPrototypeOf||function(d,c){return d.__proto__=c,d},v(s,n)}var h={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BACKTRACKING:"BACKTRACKING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},l=function(s){a(n,s);function n(d,c,S){var R;return R=s.call(this)||this,R.hls=void 0,R.fragPrevious=null,R.fragCurrent=null,R.fragmentTracker=void 0,R.transmuxer=null,R._state=h.STOPPED,R.media=void 0,R.mediaBuffer=void 0,R.config=void 0,R.bitrateTest=!1,R.lastCurrentTime=0,R.nextLoadPosition=0,R.startPosition=0,R.loadedmetadata=!1,R.fragLoadError=0,R.retryDate=0,R.levels=null,R.fragmentLoader=void 0,R.levelLastLoaded=null,R.startFragRequested=!1,R.decrypter=void 0,R.initPTS=[],R.onvseeking=null,R.onvended=null,R.logPrefix="",R.log=void 0,R.warn=void 0,R.logPrefix=S,R.log=C.logger.log.bind(C.logger,S+":"),R.warn=C.logger.warn.bind(C.logger,S+":"),R.hls=d,R.fragmentLoader=new m.default(d.config),R.fragmentTracker=c,R.config=d.config,R.decrypter=new u.default(d,d.config),d.on(I.Events.KEY_LOADED,R.onKeyLoaded,o(R)),R}var i=n.prototype;return i.doTick=function(){this.onTickEnd()},i.onTickEnd=function(){},i.startLoad=function(c){},i.stopLoad=function(){this.fragmentLoader.abort();var c=this.fragCurrent;c&&this.fragmentTracker.removeFragment(c),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=h.STOPPED},i._streamEnded=function(c,S){var R=this.fragCurrent,P=this.fragmentTracker;if(!S.live&&R&&R.sn>=S.endSN&&!c.nextStart){var B=S.partList;if(B!=null&&B.length){var x=B[B.length-1],U=b.BufferHelper.isBuffered(this.media,x.start+x.duration/2);return U}var k=P.getState(R);return k===D.FragmentState.PARTIAL||k===D.FragmentState.OK}return!1},i.onMediaAttached=function(c,S){var R=this.media=this.mediaBuffer=S.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),R.addEventListener("seeking",this.onvseeking),R.addEventListener("ended",this.onvended);var P=this.config;this.levels&&P.autoStartLoad&&this.state===h.STOPPED&&this.startLoad(P.startPosition)},i.onMediaDetaching=function(){var c=this.media;c!=null&&c.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),c&&(c.removeEventListener("seeking",this.onvseeking),c.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},i.onMediaSeeking=function(){var c=this.config,S=this.fragCurrent,R=this.media,P=this.mediaBuffer,B=this.state,x=R?R.currentTime:0,U=b.BufferHelper.bufferInfo(P||R,x,c.maxBufferHole);if(this.log("media seeking to "+(Object(M.isFiniteNumber)(x)?x.toFixed(3):x)+", state: "+B),B===h.ENDED)this.resetLoadingState();else if(S&&!U.len){var k=c.maxFragLookUpTolerance,N=S.start-k,K=S.start+S.duration+k,W=x>K;(x<N||W)&&(W&&S.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),S.loader.abort()),this.resetLoadingState())}R&&(this.lastCurrentTime=x),!this.loadedmetadata&&!U.len&&(this.nextLoadPosition=this.startPosition=x),this.tickImmediate()},i.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},i.onKeyLoaded=function(c,S){if(!(this.state!==h.KEY_LOADING||S.frag!==this.fragCurrent||!this.levels)){this.state=h.IDLE;var R=this.levels[S.frag.level].details;R&&this.loadFragment(S.frag,R,S.frag.start)}},i.onHandlerDestroying=function(){this.stopLoad(),s.prototype.onHandlerDestroying.call(this)},i.onHandlerDestroyed=function(){this.state=h.STOPPED,this.hls.off(I.Events.KEY_LOADED,this.onKeyLoaded,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.fragmentLoader=this.fragmentTracker=null,s.prototype.onHandlerDestroyed.call(this)},i.loadKey=function(c,S){this.log("Loading key for "+c.sn+" of ["+S.startSN+"-"+S.endSN+"], "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+c.level),this.state=h.KEY_LOADING,this.fragCurrent=c,this.hls.trigger(I.Events.KEY_LOADING,{frag:c})},i.loadFragment=function(c,S,R){this._loadFragForPlayback(c,S,R)},i._loadFragForPlayback=function(c,S,R){var P=this,B=function(U){if(P.fragContextChanged(c)){P.warn("Fragment "+c.sn+(U.part?" p: "+U.part.index:"")+" of level "+c.level+" was dropped during download."),P.fragmentTracker.removeFragment(c);return}c.stats.chunkCount++,P._handleFragmentLoadProgress(U)};this._doFragLoad(c,S,R,B).then(function(x){if(!!x){P.fragLoadError=0;var U=P.state;if(P.fragContextChanged(c)){(U===h.FRAG_LOADING||U===h.BACKTRACKING||!P.fragCurrent&&U===h.PARSING)&&(P.fragmentTracker.removeFragment(c),P.state=h.IDLE);return}if("payload"in x&&(P.log("Loaded fragment "+c.sn+" of level "+c.level),P.hls.trigger(I.Events.FRAG_LOADED,x),P.state===h.BACKTRACKING)){P.fragmentTracker.backtrack(c,x),P.resetFragmentLoading(c);return}P._handleFragmentLoadComplete(x)}}).catch(function(x){P.warn(x),P.resetFragmentLoading(c)})},i.flushMainBuffer=function(c,S,R){if(R===void 0&&(R=null),!!(c-S)){var P={startOffset:c,endOffset:S,type:R};this.fragLoadError=0,this.hls.trigger(I.Events.BUFFER_FLUSHING,P)}},i._loadInitSegment=function(c){var S=this;this._doFragLoad(c).then(function(R){if(!R||S.fragContextChanged(c)||!S.levels)throw new Error("init load aborted");return R}).then(function(R){var P=S.hls,B=R.payload,x=c.decryptdata;if(B&&B.byteLength>0&&x&&x.key&&x.iv&&x.method==="AES-128"){var U=self.performance.now();return S.decrypter.webCryptoDecrypt(new Uint8Array(B),x.key.buffer,x.iv.buffer).then(function(k){var N=self.performance.now();return P.trigger(I.Events.FRAG_DECRYPTED,{frag:c,payload:k,stats:{tstart:U,tdecrypt:N}}),R.payload=k,R})}return R}).then(function(R){var P=S.fragCurrent,B=S.hls,x=S.levels;if(!x)throw new Error("init load aborted, missing levels");var U=x[c.level].details;console.assert(U,"Level details are defined when init segment is loaded");var k=c.stats;S.state=h.IDLE,S.fragLoadError=0,c.data=new Uint8Array(R.payload),k.parsing.start=k.buffering.start=self.performance.now(),k.parsing.end=k.buffering.end=self.performance.now(),R.frag===P&&B.trigger(I.Events.FRAG_BUFFERED,{stats:k,frag:P,part:null,id:c.type}),S.tick()}).catch(function(R){S.warn(R),S.resetFragmentLoading(c)})},i.fragContextChanged=function(c){var S=this.fragCurrent;return!c||!S||c.level!==S.level||c.sn!==S.sn||c.urlId!==S.urlId},i.fragBufferedComplete=function(c,S){var R=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+c.type+" sn: "+c.sn+(S?" part: "+S.index:"")+" of "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+c.level+" "+t.default.toString(b.BufferHelper.getBuffered(R))),this.state=h.IDLE,this.tick()},i._handleFragmentLoadComplete=function(c){var S=this.transmuxer;if(!!S){var R=c.frag,P=c.part,B=c.partsLoaded,x=!B||B.length===0||B.some(function(k){return!k}),U=new g.ChunkMetadata(R.level,R.sn,R.stats.chunkCount+1,0,P?P.index:-1,!x);S.flush(U)}},i._handleFragmentLoadProgress=function(c){},i._doFragLoad=function(c,S,R,P){var B=this;if(R===void 0&&(R=null),!this.levels)throw new Error("frag load aborted, missing levels");if(R=Math.max(c.start,R||0),this.config.lowLatencyMode&&S){var x=S.partList;if(x&&P){R>c.end&&S.fragmentHint&&(c=S.fragmentHint);var U=this.getNextPart(x,c,R);if(U>-1){var k=x[U];return this.log("Loading part sn: "+c.sn+" p: "+k.index+" cc: "+c.cc+" of playlist ["+S.startSN+"-"+S.endSN+"] parts [0-"+U+"-"+(x.length-1)+"] "+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+c.level+", target: "+parseFloat(R.toFixed(3))),this.nextLoadPosition=k.start+k.duration,this.state=h.FRAG_LOADING,this.hls.trigger(I.Events.FRAG_LOADING,{frag:c,part:x[U],targetBufferTime:R}),this.doFragPartsLoad(c,x,U,P).catch(function(N){return B.handleFragLoadError(N)})}else if(!c.url||this.loadedEndOfParts(x,R))return Promise.resolve(null)}}return this.log("Loading fragment "+c.sn+" cc: "+c.cc+" "+(S?"of ["+S.startSN+"-"+S.endSN+"] ":"")+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+c.level+", target: "+parseFloat(R.toFixed(3))),Object(M.isFiniteNumber)(c.sn)&&!this.bitrateTest&&(this.nextLoadPosition=c.start+c.duration),this.state=h.FRAG_LOADING,this.hls.trigger(I.Events.FRAG_LOADING,{frag:c,targetBufferTime:R}),this.fragmentLoader.load(c,P).catch(function(N){return B.handleFragLoadError(N)})},i.doFragPartsLoad=function(c,S,R,P){var B=this;return new Promise(function(x,U){var k=[],N=function K(W){var w=S[W];B.fragmentLoader.loadPart(c,w,P).then(function(H){k[w.index]=H;var V=H.part;B.hls.trigger(I.Events.FRAG_LOADED,H);var j=S[W+1];if(j&&j.fragment===c)K(W+1);else return x({frag:c,part:V,partsLoaded:k})}).catch(U)};N(R)})},i.handleFragLoadError=function(c){var S=c.data;return S&&S.details===A.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(S.frag,S.part):this.hls.trigger(I.Events.ERROR,S),null},i._handleTransmuxerFlush=function(c){var S=this.getCurrentContext(c);if(!S||this.state!==h.PARSING){this.fragCurrent||(this.state=h.IDLE);return}var R=S.frag,P=S.part,B=S.level,x=self.performance.now();R.stats.parsing.end=x,P&&(P.stats.parsing.end=x),this.updateLevelTiming(R,P,B,c.partial)},i.getCurrentContext=function(c){var S=this.levels,R=c.level,P=c.sn,B=c.part;if(!S||!S[R])return this.warn("Levels object was unset while buffering fragment "+P+" of level "+R+". The current chunk will not be buffered."),null;var x=S[R],U=B>-1?Object(E.getPartWith)(x,P,B):null,k=U?U.fragment:Object(E.getFragmentWithSN)(x,P,this.fragCurrent);return k?{frag:k,part:U,level:x}:null},i.bufferFragmentData=function(c,S,R,P){if(!(!c||this.state!==h.PARSING)){var B=c.data1,x=c.data2,U=B;if(B&&x&&(U=Object(y.appendUint8Array)(B,x)),!(!U||!U.length)){var k={type:c.type,frag:S,part:R,chunkMeta:P,parent:S.type,data:U};this.hls.trigger(I.Events.BUFFER_APPENDING,k),c.dropped&&c.independent&&!R&&this.flushBufferGap(S)}}},i.flushBufferGap=function(c){var S=this.media;if(!!S){if(!b.BufferHelper.isBuffered(S,S.currentTime)){this.flushMainBuffer(0,c.start);return}var R=S.currentTime,P=b.BufferHelper.bufferInfo(S,R,0),B=c.duration,x=Math.min(this.config.maxFragLookUpTolerance*2,B*.25),U=Math.max(Math.min(c.start-x,P.end-x),R+x);c.start-U>x&&this.flushMainBuffer(U,c.start)}},i.getFwdBufferInfo=function(c,S){var R=this.config,P=this.getLoadPosition();if(!Object(M.isFiniteNumber)(P))return null;var B=b.BufferHelper.bufferInfo(c,P,R.maxBufferHole);if(B.len===0&&B.nextStart!==void 0){var x=this.fragmentTracker.getBufferedFrag(P,S);if(x&&B.nextStart<x.end)return b.BufferHelper.bufferInfo(c,P,Math.max(B.nextStart,R.maxBufferHole))}return B},i.getMaxBufferLength=function(c){var S=this.config,R;return c?R=Math.max(8*S.maxBufferSize/c,S.maxBufferLength):R=S.maxBufferLength,Math.min(R,S.maxMaxBufferLength)},i.reduceMaxBufferLength=function(c){var S=this.config,R=c||S.maxBufferLength;return S.maxMaxBufferLength>=R?(S.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+S.maxMaxBufferLength+"s"),!0):!1},i.getNextFragment=function(c,S){var R,P,B=S.fragments,x=B.length;if(!x)return null;var U=this.config,k=B[0].start,N;if(S.live){var K=U.initialLiveManifestSize;if(x<K)return this.warn("Not enough fragments to start playback (have: "+x+", need: "+K+")"),null;!S.PTSKnown&&!this.startFragRequested&&this.startPosition===-1&&(N=this.getInitialLiveFragment(S,B),this.startPosition=N?this.hls.liveSyncPosition||N.start:c)}else c<=k&&(N=B[0]);if(!N){var W=U.lowLatencyMode?S.partEnd:S.fragmentEnd;N=this.getFragmentAtPosition(c,W,S)}return(R=N)!==null&&R!==void 0&&R.initSegment&&!((P=N)!==null&&P!==void 0&&P.initSegment.data)&&!this.bitrateTest&&(N=N.initSegment),N},i.getNextPart=function(c,S,R){for(var P=-1,B=!1,x=!0,U=0,k=c.length;U<k;U++){var N=c[U];if(x=x&&!N.independent,P>-1&&R<N.start)break;var K=N.loaded;!K&&(B||N.independent||x)&&N.fragment===S&&(P=U),B=K}return P},i.loadedEndOfParts=function(c,S){var R=c[c.length-1];return R&&S>R.start&&R.loaded},i.getInitialLiveFragment=function(c,S){var R=this.fragPrevious,P=null;if(R){if(c.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+R.programDateTime),P=Object(p.findFragmentByPDT)(S,R.endProgramDateTime,this.config.maxFragLookUpTolerance)),!P){var B=R.sn+1;if(B>=c.startSN&&B<=c.endSN){var x=S[B-c.startSN];R.cc===x.cc&&(P=x,this.log("Live playlist, switching playlist, load frag with next SN: "+P.sn))}P||(P=Object(p.findFragWithCC)(S,R.cc),P&&this.log("Live playlist, switching playlist, load frag with same CC: "+P.sn))}}else{var U=this.hls.liveSyncPosition;U!==null&&(P=this.getFragmentAtPosition(U,this.bitrateTest?c.fragmentEnd:c.edge,c))}return P},i.getFragmentAtPosition=function(c,S,R){var P=this.config,B=this.fragPrevious,x=R.fragments,U=R.endSN,k=R.fragmentHint,N=P.maxFragLookUpTolerance,K=!!(P.lowLatencyMode&&R.partList&&k);K&&k&&!this.bitrateTest&&(x=x.concat(k),U=k.sn);var W;if(c<S){var w=c>S-N?0:N;W=Object(p.findFragmentByPTS)(B,x,c,w)}else W=x[x.length-1];if(W){var H=W.sn-R.startSN,V=B&&W.level===B.level,j=x[H+1],X=this.fragmentTracker.getState(W);if(X===D.FragmentState.BACKTRACKED){W=null;for(var Y=H;x[Y]&&this.fragmentTracker.getState(x[Y])===D.FragmentState.BACKTRACKED;)B?W=x[Y--]:W=x[--Y];W||(W=j)}else B&&W.sn===B.sn&&!K&&V&&(W.sn<U&&this.fragmentTracker.getState(j)!==D.FragmentState.OK?(this.log("SN "+W.sn+" just loaded, load next one: "+j.sn),W=j):W=null)}return W},i.synchronizeToLiveEdge=function(c){var S=this.config,R=this.media;if(!!R){var P=this.hls.liveSyncPosition,B=R.currentTime,x=c.fragments[0].start,U=c.edge,k=B>=x-S.maxFragLookUpTolerance&&B<=U;if(P!==null&&R.duration>P&&(B<P||!k)){var N=S.liveMaxLatencyDuration!==void 0?S.liveMaxLatencyDuration:S.liveMaxLatencyDurationCount*c.targetduration;(!k&&R.readyState<4||B<U-N)&&(this.loadedmetadata||(this.nextLoadPosition=P),R.readyState&&(this.warn("Playback: "+B.toFixed(3)+" is located too far from the end of live sliding playlist: "+U+", reset currentTime to : "+P.toFixed(3)),R.currentTime=P))}}},i.alignPlaylists=function(c,S){var R=this.levels,P=this.levelLastLoaded,B=this.fragPrevious,x=P!==null?R[P]:null,U=c.fragments.length;if(!U)return this.warn("No fragments in live playlist"),0;var k=c.fragments[0].start,N=!S,K=c.alignedSliding&&Object(M.isFiniteNumber)(k);if(N||!K&&!k){Object(L.alignStream)(B,x,c);var W=c.fragments[0].start;return this.log("Live playlist sliding: "+W.toFixed(2)+" start-sn: "+(S?S.startSN:"na")+"->"+c.startSN+" prev-sn: "+(B?B.sn:"na")+" fragments: "+U),W}return k},i.waitForCdnTuneIn=function(c){var S=3;return c.live&&c.canBlockReload&&c.tuneInGoal>Math.max(c.partHoldBack,c.partTarget*S)},i.setStartPosition=function(c,S){var R=this.startPosition;if(R<S&&(R=-1),R===-1||this.lastCurrentTime===-1){var P=c.startTimeOffset;Object(M.isFiniteNumber)(P)?(R=S+P,P<0&&(R+=c.totalduration),R=Math.min(Math.max(S,R),S+c.totalduration),this.log("Start time offset "+P+" found in playlist, adjust startPosition to "+R),this.startPosition=R):c.live?R=this.hls.liveSyncPosition||S:this.startPosition=R=0,this.lastCurrentTime=R}this.nextLoadPosition=R},i.getLoadPosition=function(){var c=this.media,S=0;return this.loadedmetadata&&c?S=c.currentTime:this.nextLoadPosition&&(S=this.nextLoadPosition),S},i.handleFragLoadAborted=function(c,S){this.transmuxer&&c.sn!=="initSegment"&&c.stats.aborted&&(this.warn("Fragment "+c.sn+(S?" part"+S.index:"")+" of level "+c.level+" was aborted"),this.resetFragmentLoading(c))},i.resetFragmentLoading=function(c){(!this.fragCurrent||!this.fragContextChanged(c))&&(this.state=h.IDLE)},i.onFragmentOrKeyLoadError=function(c,S){if(!S.fatal){var R=S.frag;if(!(!R||R.type!==c)){var P=this.fragCurrent;console.assert(P&&R.sn===P.sn&&R.level===P.level&&R.urlId===P.urlId,"Frag load error must match current frag to retry");var B=this.config;if(this.fragLoadError+1<=B.fragLoadingMaxRetry){if(this.resetLiveStartWhenNotLoaded(R.level))return;var x=Math.min(Math.pow(2,this.fragLoadError)*B.fragLoadingRetryDelay,B.fragLoadingMaxRetryTimeout);this.warn("Fragment "+R.sn+" of "+c+" "+R.level+" failed to load, retrying in "+x+"ms"),this.retryDate=self.performance.now()+x,this.fragLoadError++,this.state=h.FRAG_LOADING_WAITING_RETRY}else S.levelRetry?(c===r.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=h.IDLE):(C.logger.error(S.details+" reaches max retry, redispatch as fatal ..."),S.fatal=!0,this.hls.stopLoad(),this.state=h.ERROR)}}},i.afterBufferFlushed=function(c,S,R){if(!!c){var P=b.BufferHelper.getBuffered(c);this.fragmentTracker.detectEvictedFragments(S,P,R),this.state===h.ENDED&&this.resetLoadingState()}},i.resetLoadingState=function(){this.fragCurrent=null,this.fragPrevious=null,this.state=h.IDLE},i.resetLiveStartWhenNotLoaded=function(c){if(!this.loadedmetadata){this.startFragRequested=!1;var S=this.levels?this.levels[c].details:null;if(S!=null&&S.live)return this.startPosition=-1,this.setStartPosition(S,0),this.resetLoadingState(),!0;this.nextLoadPosition=this.startPosition}return!1},i.updateLevelTiming=function(c,S,R,P){var B=this,x=R.details;console.assert(!!x,"level.details must be defined");var U=Object.keys(c.elementaryStreams).reduce(function(k,N){var K=c.elementaryStreams[N];if(K){var W=K.endPTS-K.startPTS;if(W<=0)return B.warn("Could not parse fragment "+c.sn+" "+N+" duration reliably ("+W+") resetting transmuxer to fallback to playlist timing"),B.resetTransmuxer(),k||!1;var w=P?0:Object(E.updateFragPTSDTS)(x,c,K.startPTS,K.endPTS,K.startDTS,K.endDTS);return B.hls.trigger(I.Events.LEVEL_PTS_UPDATED,{details:x,level:R,drift:w,type:N,frag:c,start:K.startPTS,end:K.endPTS}),!0}return k},!1);U?(this.state=h.PARSED,this.hls.trigger(I.Events.FRAG_PARSED,{frag:c,part:S})):this.resetLoadingState()},i.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},f(n,[{key:"state",get:function(){return this._state},set:function(c){var S=this._state;S!==c&&(this._state=c,this.log(S+"->"+c))}}]),n}(O.default)},"./src/controller/buffer-controller.ts":function(G,F,T){"use strict";T.r(F),T.d(F,"default",function(){return p});var M=T("./src/polyfills/number.ts"),O=T("./src/events.ts"),D=T("./src/utils/logger.ts"),b=T("./src/errors.ts"),C=T("./src/utils/buffer-helper.ts"),I=T("./src/utils/mediasource-helper.ts"),A=T("./src/loader/fragment.ts"),g=T("./src/controller/buffer-operation-queue.ts"),y=Object(I.getMediaSource)(),L=/([ha]vc.)(?:\.[^.,]+)+/,p=function(){function E(u){var t=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var r=t.hls,e=t.media,f=t.mediaSource;D.logger.log("[buffer-controller]: Media source opened"),e&&(t.updateMediaElementDuration(),r.trigger(O.Events.MEDIA_ATTACHED,{media:e})),f&&f.removeEventListener("sourceopen",t._onMediaSourceOpen),t.checkPendingTracks()},this._onMediaSourceClose=function(){D.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){D.logger.log("[buffer-controller]: Media source ended")},this.hls=u,this._initSourceBuffer(),this.registerListeners()}var m=E.prototype;return m.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},m.destroy=function(){this.unregisterListeners(),this.details=null},m.registerListeners=function(){var t=this.hls;t.on(O.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(O.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(O.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.on(O.Events.BUFFER_RESET,this.onBufferReset,this),t.on(O.Events.BUFFER_APPENDING,this.onBufferAppending,this),t.on(O.Events.BUFFER_CODECS,this.onBufferCodecs,this),t.on(O.Events.BUFFER_EOS,this.onBufferEos,this),t.on(O.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(O.Events.LEVEL_UPDATED,this.onLevelUpdated,this),t.on(O.Events.FRAG_PARSED,this.onFragParsed,this),t.on(O.Events.FRAG_CHANGED,this.onFragChanged,this)},m.unregisterListeners=function(){var t=this.hls;t.off(O.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(O.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(O.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.off(O.Events.BUFFER_RESET,this.onBufferReset,this),t.off(O.Events.BUFFER_APPENDING,this.onBufferAppending,this),t.off(O.Events.BUFFER_CODECS,this.onBufferCodecs,this),t.off(O.Events.BUFFER_EOS,this.onBufferEos,this),t.off(O.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(O.Events.LEVEL_UPDATED,this.onLevelUpdated,this),t.off(O.Events.FRAG_PARSED,this.onFragParsed,this),t.off(O.Events.FRAG_CHANGED,this.onFragChanged,this)},m._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new g.default(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]}},m.onManifestParsed=function(t,r){var e=2;(r.audio&&!r.video||!r.altAudio)&&(e=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=e,this.details=null,D.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},m.onMediaAttaching=function(t,r){var e=this.media=r.media;if(e&&y){var f=this.mediaSource=new y;f.addEventListener("sourceopen",this._onMediaSourceOpen),f.addEventListener("sourceended",this._onMediaSourceEnded),f.addEventListener("sourceclose",this._onMediaSourceClose),e.src=self.URL.createObjectURL(f),this._objectUrl=e.src}},m.onMediaDetaching=function(){var t=this.media,r=this.mediaSource,e=this._objectUrl;if(r){if(D.logger.log("[buffer-controller]: media source detaching"),r.readyState==="open")try{r.endOfStream()}catch(f){D.logger.warn("[buffer-controller]: onMediaDetaching: "+f.message+" while calling endOfStream")}this.onBufferReset(),r.removeEventListener("sourceopen",this._onMediaSourceOpen),r.removeEventListener("sourceended",this._onMediaSourceEnded),r.removeEventListener("sourceclose",this._onMediaSourceClose),t&&(e&&self.URL.revokeObjectURL(e),t.src===e?(t.removeAttribute("src"),t.load()):D.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(O.Events.MEDIA_DETACHED,void 0)},m.onBufferReset=function(){var t=this;this.getSourceBufferTypes().forEach(function(r){var e=t.sourceBuffer[r];try{e&&(t.removeBufferListeners(r),t.mediaSource&&t.mediaSource.removeSourceBuffer(e),t.sourceBuffer[r]=void 0)}catch(f){D.logger.warn("[buffer-controller]: Failed to reset the "+r+" buffer",f)}}),this._initSourceBuffer()},m.onBufferCodecs=function(t,r){var e=this,f=this.getSourceBufferTypes().length;Object.keys(r).forEach(function(o){if(f){var a=e.tracks[o];if(a&&typeof a.buffer.changeType=="function"){var v=r[o],h=v.codec,l=v.levelCodec,s=v.container,n=(a.levelCodec||a.codec).replace(L,"$1"),i=(l||h).replace(L,"$1");if(n!==i){var d=s+";codecs="+(l||h);e.appendChangeType(o,d)}}}else e.pendingTracks[o]=r[o]}),!f&&(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())},m.appendChangeType=function(t,r){var e=this,f=this.operationQueue,o={execute:function(){var v=e.sourceBuffer[t];v&&(D.logger.log("[buffer-controller]: changing "+t+" sourceBuffer type to "+r),v.changeType(r)),f.shiftAndExecuteNext(t)},onStart:function(){},onComplete:function(){},onError:function(v){D.logger.warn("[buffer-controller]: Failed to change "+t+" SourceBuffer type",v)}};f.append(o,t)},m.onBufferAppending=function(t,r){var e=this,f=this.hls,o=this.operationQueue,a=this.tracks,v=r.data,h=r.type,l=r.frag,s=r.part,n=r.chunkMeta,i=n.buffering[h],d=self.performance.now();i.start=d;var c=l.stats.buffering,S=s?s.stats.buffering:null;c.start===0&&(c.start=d),S&&S.start===0&&(S.start=d);var R=a.audio,P=h==="audio"&&n.id===1&&(R==null?void 0:R.container)==="audio/mpeg",B={execute:function(){if(i.executeStart=self.performance.now(),P){var U=e.sourceBuffer[h];if(U){var k=l.start-U.timestampOffset;Math.abs(k)>=.1&&(D.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+l.start+" (delta: "+k+") sn: "+l.sn+")"),U.timestampOffset=l.start)}}e.appendExecutor(v,h)},onStart:function(){},onComplete:function(){var U=self.performance.now();i.executeEnd=i.end=U,c.first===0&&(c.first=U),S&&S.first===0&&(S.first=U);var k=e.sourceBuffer,N={};for(var K in k)N[K]=C.BufferHelper.getBuffered(k[K]);e.appendError=0,e.hls.trigger(O.Events.BUFFER_APPENDED,{type:h,frag:l,part:s,chunkMeta:n,parent:l.type,timeRanges:N})},onError:function(U){D.logger.error("[buffer-controller]: Error encountered while trying to append to the "+h+" SourceBuffer",U);var k={type:b.ErrorTypes.MEDIA_ERROR,parent:l.type,details:b.ErrorDetails.BUFFER_APPEND_ERROR,err:U,fatal:!1};U.code===DOMException.QUOTA_EXCEEDED_ERR?k.details=b.ErrorDetails.BUFFER_FULL_ERROR:(e.appendError++,k.details=b.ErrorDetails.BUFFER_APPEND_ERROR,e.appendError>f.config.appendErrorMaxRetry&&(D.logger.error("[buffer-controller]: Failed "+f.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),k.fatal=!0)),f.trigger(O.Events.ERROR,k)}};o.append(B,h)},m.onBufferFlushing=function(t,r){var e=this,f=this.operationQueue,o=function(v){return{execute:e.removeExecutor.bind(e,v,r.startOffset,r.endOffset),onStart:function(){},onComplete:function(){e.hls.trigger(O.Events.BUFFER_FLUSHED,{type:v})},onError:function(l){D.logger.warn("[buffer-controller]: Failed to remove from "+v+" SourceBuffer",l)}}};r.type?f.append(o(r.type),r.type):this.getSourceBufferTypes().forEach(function(a){f.append(o(a),a)})},m.onFragParsed=function(t,r){var e=this,f=r.frag,o=r.part,a=[],v=o?o.elementaryStreams:f.elementaryStreams;v[A.ElementaryStreamTypes.AUDIOVIDEO]?a.push("audiovideo"):(v[A.ElementaryStreamTypes.AUDIO]&&a.push("audio"),v[A.ElementaryStreamTypes.VIDEO]&&a.push("video"));var h=function(){var s=self.performance.now();f.stats.buffering.end=s,o&&(o.stats.buffering.end=s);var n=o?o.stats:f.stats;e.hls.trigger(O.Events.FRAG_BUFFERED,{frag:f,part:o,stats:n,id:f.type})};a.length===0&&D.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+f.type+" level: "+f.level+" sn: "+f.sn),this.blockBuffers(h,a)},m.onFragChanged=function(t,r){this.flushBackBuffer()},m.onBufferEos=function(t,r){var e=this,f=this.getSourceBufferTypes().reduce(function(o,a){var v=e.sourceBuffer[a];return(!r.type||r.type===a)&&v&&!v.ended&&(v.ended=!0,D.logger.log("[buffer-controller]: "+a+" sourceBuffer now EOS")),o&&!!(!v||v.ended)},!0);f&&this.blockBuffers(function(){var o=e.mediaSource;!o||o.readyState!=="open"||o.endOfStream()})},m.onLevelUpdated=function(t,r){var e=r.details;!e.fragments.length||(this.details=e,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},m.flushBackBuffer=function(){var t=this.hls,r=this.details,e=this.media,f=this.sourceBuffer;if(!(!e||r===null)){var o=this.getSourceBufferTypes();if(!!o.length){var a=r.live&&t.config.liveBackBufferLength!==null?t.config.liveBackBufferLength:t.config.backBufferLength;if(!(!Object(M.isFiniteNumber)(a)||a<0)){var v=e.currentTime,h=r.levelTargetDuration,l=Math.max(a,h),s=Math.floor(v/h)*h-l;o.forEach(function(n){var i=f[n];if(i){var d=C.BufferHelper.getBuffered(i);d.length>0&&s>d.start(0)&&(t.trigger(O.Events.BACK_BUFFER_REACHED,{bufferEnd:s}),r.live&&t.trigger(O.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:s}),t.trigger(O.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:s,type:n}))}})}}}},m.updateMediaElementDuration=function(){if(!(!this.details||!this.media||!this.mediaSource||this.mediaSource.readyState!=="open")){var t=this.details,r=this.hls,e=this.media,f=this.mediaSource,o=t.fragments[0].start+t.totalduration,a=e.duration,v=Object(M.isFiniteNumber)(f.duration)?f.duration:0;t.live&&r.config.liveDurationInfinity?(D.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),f.duration=1/0,this.updateSeekableRange(t)):(o>v&&o>a||!Object(M.isFiniteNumber)(a))&&(D.logger.log("[buffer-controller]: Updating Media Source duration to "+o.toFixed(3)),f.duration=o)}},m.updateSeekableRange=function(t){var r=this.mediaSource,e=t.fragments,f=e.length;if(f&&t.live&&r!==null&&r!==void 0&&r.setLiveSeekableRange){var o=Math.max(0,e[0].start),a=Math.max(o,o+t.totalduration);r.setLiveSeekableRange(o,a)}},m.checkPendingTracks=function(){var t=this.bufferCodecEventsExpected,r=this.operationQueue,e=this.pendingTracks,f=Object.keys(e).length;if(f&&!t||f===2){this.createSourceBuffers(e),this.pendingTracks={};var o=this.getSourceBufferTypes();if(o.length===0){this.hls.trigger(O.Events.ERROR,{type:b.ErrorTypes.MEDIA_ERROR,details:b.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});return}o.forEach(function(a){r.executeNext(a)})}},m.createSourceBuffers=function(t){var r=this.sourceBuffer,e=this.mediaSource;if(!e)throw Error("createSourceBuffers called when mediaSource was null");var f=0;for(var o in t)if(!r[o]){var a=t[o];if(!a)throw Error("source buffer exists for track "+o+", however track does not");var v=a.levelCodec||a.codec,h=a.container+";codecs="+v;D.logger.log("[buffer-controller]: creating sourceBuffer("+h+")");try{var l=r[o]=e.addSourceBuffer(h),s=o;this.addBufferListener(s,"updatestart",this._onSBUpdateStart),this.addBufferListener(s,"updateend",this._onSBUpdateEnd),this.addBufferListener(s,"error",this._onSBUpdateError),this.tracks[o]={buffer:l,codec:v,container:a.container,levelCodec:a.levelCodec,id:a.id},f++}catch(n){D.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+n.message),this.hls.trigger(O.Events.ERROR,{type:b.ErrorTypes.MEDIA_ERROR,details:b.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:n,mimeType:h})}}f&&this.hls.trigger(O.Events.BUFFER_CREATED,{tracks:this.tracks})},m._onSBUpdateStart=function(t){var r=this.operationQueue,e=r.current(t);e.onStart()},m._onSBUpdateEnd=function(t){var r=this.operationQueue,e=r.current(t);e.onComplete(),r.shiftAndExecuteNext(t)},m._onSBUpdateError=function(t,r){D.logger.error("[buffer-controller]: "+t+" SourceBuffer error",r),this.hls.trigger(O.Events.ERROR,{type:b.ErrorTypes.MEDIA_ERROR,details:b.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});var e=this.operationQueue.current(t);e&&e.onError(r)},m.removeExecutor=function(t,r,e){var f=this.media,o=this.mediaSource,a=this.operationQueue,v=this.sourceBuffer,h=v[t];if(!f||!o||!h){D.logger.warn("[buffer-controller]: Attempting to remove from the "+t+" SourceBuffer, but it does not exist"),a.shiftAndExecuteNext(t);return}var l=Object(M.isFiniteNumber)(f.duration)?f.duration:1/0,s=Object(M.isFiniteNumber)(o.duration)?o.duration:1/0,n=Math.max(0,r),i=Math.min(e,l,s);i>n?(D.logger.log("[buffer-controller]: Removing ["+n+","+i+"] from the "+t+" SourceBuffer"),console.assert(!h.updating,t+" sourceBuffer must not be updating"),h.remove(n,i)):a.shiftAndExecuteNext(t)},m.appendExecutor=function(t,r){var e=this.operationQueue,f=this.sourceBuffer,o=f[r];if(!o){D.logger.warn("[buffer-controller]: Attempting to append to the "+r+" SourceBuffer, but it does not exist"),e.shiftAndExecuteNext(r);return}o.ended=!1,console.assert(!o.updating,r+" sourceBuffer must not be updating"),o.appendBuffer(t)},m.blockBuffers=function(t,r){var e=this;if(r===void 0&&(r=this.getSourceBufferTypes()),!r.length){D.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),Promise.resolve(t);return}var f=this.operationQueue,o=r.map(function(a){return f.appendBlocker(a)});Promise.all(o).then(function(){t(),r.forEach(function(a){var v=e.sourceBuffer[a];(!v||!v.updating)&&f.shiftAndExecuteNext(a)})})},m.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},m.addBufferListener=function(t,r,e){var f=this.sourceBuffer[t];if(!!f){var o=e.bind(this,t);this.listeners[t].push({event:r,listener:o}),f.addEventListener(r,o)}},m.removeBufferListeners=function(t){var r=this.sourceBuffer[t];!r||this.listeners[t].forEach(function(e){r.removeEventListener(e.event,e.listener)})},E}()},"./src/controller/buffer-operation-queue.ts":function(G,F,T){"use strict";T.r(F),T.d(F,"default",function(){return O});var M=T("./src/utils/logger.ts"),O=function(){function D(C){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=C}var b=D.prototype;return b.append=function(I,A){var g=this.queues[A];g.push(I),g.length===1&&this.buffers[A]&&this.executeNext(A)},b.insertAbort=function(I,A){var g=this.queues[A];g.unshift(I),this.executeNext(A)},b.appendBlocker=function(I){var A,g=new Promise(function(L){A=L}),y={execute:A,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(y,I),g},b.executeNext=function(I){var A=this.buffers,g=this.queues,y=A[I],L=g[I];if(L.length){var p=L[0];try{p.execute()}catch(E){M.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),p.onError(E),(!y||!y.updating)&&(L.shift(),this.executeNext(I))}}},b.shiftAndExecuteNext=function(I){this.queues[I].shift(),this.executeNext(I)},b.current=function(I){return this.queues[I][0]},D}()},"./src/controller/cap-level-controller.ts":function(G,F,T){"use strict";T.r(F);var M=T("./src/events.ts");function O(C,I){for(var A=0;A<I.length;A++){var g=I[A];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(C,g.key,g)}}function D(C,I,A){return I&&O(C.prototype,I),A&&O(C,A),C}var b=function(){function C(A){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=A,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var I=C.prototype;return I.setStreamController=function(g){this.streamController=g},I.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},I.registerListeners=function(){var g=this.hls;g.on(M.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),g.on(M.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),g.on(M.Events.MANIFEST_PARSED,this.onManifestParsed,this),g.on(M.Events.BUFFER_CODECS,this.onBufferCodecs,this),g.on(M.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},I.unregisterListener=function(){var g=this.hls;g.off(M.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),g.off(M.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),g.off(M.Events.MANIFEST_PARSED,this.onManifestParsed,this),g.off(M.Events.BUFFER_CODECS,this.onBufferCodecs,this),g.off(M.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},I.onFpsDropLevelCapping=function(g,y){C.isLevelAllowed(y.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(y.droppedLevel)},I.onMediaAttaching=function(g,y){this.media=y.media instanceof HTMLVideoElement?y.media:null},I.onManifestParsed=function(g,y){var L=this.hls;this.restrictedLevels=[],this.firstLevel=y.firstLevel,L.config.capLevelToPlayerSize&&y.video&&this.startCapping()},I.onBufferCodecs=function(g,y){var L=this.hls;L.config.capLevelToPlayerSize&&y.video&&this.startCapping()},I.onMediaDetaching=function(){this.stopCapping()},I.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var g=this.hls.levels;if(g.length){var y=this.hls;y.autoLevelCapping=this.getMaxLevel(g.length-1),y.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=y.autoLevelCapping}}},I.getMaxLevel=function(g){var y=this,L=this.hls.levels;if(!L.length)return-1;var p=L.filter(function(E,m){return C.isLevelAllowed(m,y.restrictedLevels)&&m<=g});return this.clientRect=null,C.getMaxLevelByMediaSize(p,this.mediaWidth,this.mediaHeight)},I.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},I.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},I.getDimensions=function(){if(this.clientRect)return this.clientRect;var g=this.media,y={width:0,height:0};if(g){var L=g.getBoundingClientRect();y.width=L.width,y.height=L.height,!y.width&&!y.height&&(y.width=L.right-L.left||g.width||0,y.height=L.bottom-L.top||g.height||0)}return this.clientRect=y,y},C.isLevelAllowed=function(g,y){return y===void 0&&(y=[]),y.indexOf(g)===-1},C.getMaxLevelByMediaSize=function(g,y,L){if(!g||!g.length)return-1;for(var p=function(r,e){return e?r.width!==e.width||r.height!==e.height:!0},E=g.length-1,m=0;m<g.length;m+=1){var u=g[m];if((u.width>=y||u.height>=L)&&p(u,g[m+1])){E=m;break}}return E},D(C,[{key:"mediaWidth",get:function(){return this.getDimensions().width*C.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*C.contentScaleFactor}}],[{key:"contentScaleFactor",get:function(){var g=1;try{g=self.devicePixelRatio}catch{}return g}}]),C}();F.default=b},"./src/controller/cmcd-controller.ts":function(G,F,T){"use strict";T.r(F),T.d(F,"default",function(){return p});var M=T("./src/events.ts"),O=T("./src/types/cmcd.ts"),D=T("./src/utils/buffer-helper.ts"),b=T("./src/utils/logger.ts");function C(E,m){for(var u=0;u<m.length;u++){var t=m[u];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(E,t.key,t)}}function I(E,m,u){return m&&C(E.prototype,m),u&&C(E,u),E}function A(E,m){var u=typeof Symbol<"u"&&E[Symbol.iterator]||E["@@iterator"];if(u)return(u=u.call(E)).next.bind(u);if(Array.isArray(E)||(u=g(E))||m&&E&&typeof E.length=="number"){u&&(E=u);var t=0;return function(){return t>=E.length?{done:!0}:{done:!1,value:E[t++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function g(E,m){if(!!E){if(typeof E=="string")return y(E,m);var u=Object.prototype.toString.call(E).slice(8,-1);if(u==="Object"&&E.constructor&&(u=E.constructor.name),u==="Map"||u==="Set")return Array.from(E);if(u==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(u))return y(E,m)}}function y(E,m){(m==null||m>E.length)&&(m=E.length);for(var u=0,t=new Array(m);u<m;u++)t[u]=E[u];return t}function L(){return L=Object.assign||function(E){for(var m=1;m<arguments.length;m++){var u=arguments[m];for(var t in u)Object.prototype.hasOwnProperty.call(u,t)&&(E[t]=u[t])}return E},L.apply(this,arguments)}var p=function(){function E(u){var t=this;this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){t.initialized&&(t.starved=!0),t.buffering=!0},this.onPlaying=function(){t.initialized||(t.initialized=!0),t.buffering=!1},this.applyPlaylistData=function(f){try{t.apply(f,{ot:O.CMCDObjectType.MANIFEST,su:!t.initialized})}catch(o){b.logger.warn("Could not generate manifest CMCD data.",o)}},this.applyFragmentData=function(f){try{var o=f.frag,a=t.hls.levels[o.level],v=t.getObjectType(o),h={d:o.duration*1e3,ot:v};(v===O.CMCDObjectType.VIDEO||v===O.CMCDObjectType.AUDIO||v==O.CMCDObjectType.MUXED)&&(h.br=a.bitrate/1e3,h.tb=t.getTopBandwidth(v)/1e3,h.bl=t.getBufferLength(v)),t.apply(f,h)}catch(l){b.logger.warn("Could not generate segment CMCD data.",l)}},this.hls=u;var r=this.config=u.config,e=r.cmcd;e!=null&&(r.pLoader=this.createPlaylistLoader(),r.fLoader=this.createFragmentLoader(),this.sid=e.sessionId||E.uuid(),this.cid=e.contentId,this.useHeaders=e.useHeaders===!0,this.registerListeners())}var m=E.prototype;return m.registerListeners=function(){var t=this.hls;t.on(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(M.Events.MEDIA_DETACHED,this.onMediaDetached,this),t.on(M.Events.BUFFER_CREATED,this.onBufferCreated,this)},m.unregisterListeners=function(){var t=this.hls;t.off(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(M.Events.MEDIA_DETACHED,this.onMediaDetached,this),t.off(M.Events.BUFFER_CREATED,this.onBufferCreated,this),this.onMediaDetached()},m.destroy=function(){this.unregisterListeners(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null},m.onMediaAttached=function(t,r){this.media=r.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)},m.onMediaDetached=function(){!this.media||(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},m.onBufferCreated=function(t,r){var e,f;this.audioBuffer=(e=r.tracks.audio)===null||e===void 0?void 0:e.buffer,this.videoBuffer=(f=r.tracks.video)===null||f===void 0?void 0:f.buffer},m.createData=function(){var t;return{v:O.CMCDVersion,sf:O.CMCDStreamingFormat.HLS,sid:this.sid,cid:this.cid,pr:(t=this.media)===null||t===void 0?void 0:t.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}},m.apply=function(t,r){r===void 0&&(r={}),L(r,this.createData());var e=r.ot===O.CMCDObjectType.INIT||r.ot===O.CMCDObjectType.VIDEO||r.ot===O.CMCDObjectType.MUXED;if(this.starved&&e&&(r.bs=!0,r.su=!0,this.starved=!1),r.su==null&&(r.su=this.buffering),this.useHeaders){var f=E.toHeaders(r);if(!Object.keys(f).length)return;t.headers||(t.headers={}),L(t.headers,f)}else{var o=E.toQuery(r);if(!o)return;t.url=E.appendQueryToUri(t.url,o)}},m.getObjectType=function(t){var r=t.type;if(r==="subtitle")return O.CMCDObjectType.TIMED_TEXT;if(t.sn==="initSegment")return O.CMCDObjectType.INIT;if(r==="audio")return O.CMCDObjectType.AUDIO;if(r==="main")return this.hls.audioTracks.length?O.CMCDObjectType.VIDEO:O.CMCDObjectType.MUXED},m.getTopBandwidth=function(t){var r=0,e,f=this.hls;if(t===O.CMCDObjectType.AUDIO)e=f.audioTracks;else{var o=f.maxAutoLevel,a=o>-1?o+1:f.levels.length;e=f.levels.slice(0,a)}for(var v=A(e),h;!(h=v()).done;){var l=h.value;l.bitrate>r&&(r=l.bitrate)}return r>0?r:NaN},m.getBufferLength=function(t){var r=this.hls.media,e=t===O.CMCDObjectType.AUDIO?this.audioBuffer:this.videoBuffer;if(!e||!r)return NaN;var f=D.BufferHelper.bufferInfo(e,r.currentTime,this.config.maxBufferHole);return f.len*1e3},m.createPlaylistLoader=function(){var t=this.config.pLoader,r=this.applyPlaylistData,e=t||this.config.loader;return function(){function f(a){this.loader=void 0,this.loader=new e(a)}var o=f.prototype;return o.destroy=function(){this.loader.destroy()},o.abort=function(){this.loader.abort()},o.load=function(v,h,l){r(v),this.loader.load(v,h,l)},I(f,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),f}()},m.createFragmentLoader=function(){var t=this.config.fLoader,r=this.applyFragmentData,e=t||this.config.loader;return function(){function f(a){this.loader=void 0,this.loader=new e(a)}var o=f.prototype;return o.destroy=function(){this.loader.destroy()},o.abort=function(){this.loader.abort()},o.load=function(v,h,l){r(v),this.loader.load(v,h,l)},I(f,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),f}()},E.uuid=function(){var t=URL.createObjectURL(new Blob),r=t.toString();return URL.revokeObjectURL(t),r.substr(r.lastIndexOf("/")+1)},E.serialize=function(t){for(var r=[],e=function(P){return!Number.isNaN(P)&&P!=null&&P!==""&&P!==!1},f=function(P){return Math.round(P)},o=function(P){return f(P/100)*100},a=function(P){return encodeURIComponent(P)},v={br:f,d:f,bl:o,dl:o,mtp:o,nor:a,rtp:o,tb:f},h=Object.keys(t||{}).sort(),l=A(h),s;!(s=l()).done;){var n=s.value,i=t[n];if(!!e(i)&&!(n==="v"&&i===1)&&!(n=="pr"&&i===1)){var d=v[n];d&&(i=d(i));var c=typeof i,S=void 0;n==="ot"||n==="sf"||n==="st"?S=n+"="+i:c==="boolean"?S=n:c==="number"?S=n+"="+i:S=n+"="+JSON.stringify(i),r.push(S)}}return r.join(",")},E.toHeaders=function(t){for(var r=Object.keys(t),e={},f=["Object","Request","Session","Status"],o=[{},{},{},{}],a={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3},v=0,h=r;v<h.length;v++){var l=h[v],s=a[l]!=null?a[l]:1;o[s][l]=t[l]}for(var n=0;n<o.length;n++){var i=E.serialize(o[n]);i&&(e["CMCD-"+f[n]]=i)}return e},E.toQuery=function(t){return"CMCD="+encodeURIComponent(E.serialize(t))},E.appendQueryToUri=function(t,r){if(!r)return t;var e=t.includes("?")?"&":"?";return""+t+e+r},E}()},"./src/controller/eme-controller.ts":function(G,F,T){"use strict";T.r(F);var M=T("./src/events.ts"),O=T("./src/errors.ts"),D=T("./src/utils/logger.ts"),b=T("./src/utils/mediakeys-helper.ts");function C(p,E){for(var m=0;m<E.length;m++){var u=E[m];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(p,u.key,u)}}function I(p,E,m){return E&&C(p.prototype,E),m&&C(p,m),p}var A=3,g=function(E,m,u){var t={audioCapabilities:[],videoCapabilities:[]};return E.forEach(function(r){t.audioCapabilities.push({contentType:'audio/mp4; codecs="'+r+'"',robustness:u.audioRobustness||""})}),m.forEach(function(r){t.videoCapabilities.push({contentType:'video/mp4; codecs="'+r+'"',robustness:u.videoRobustness||""})}),[t]},y=function(E,m,u,t){switch(E){case b.KeySystems.WIDEVINE:return g(m,u,t);default:throw new Error("Unknown key-system: "+E)}},L=function(){function p(m){this.hls=void 0,this._widevineLicenseUrl=void 0,this._licenseXhrSetup=void 0,this._licenseResponseCallback=void 0,this._emeEnabled=void 0,this._requestMediaKeySystemAccess=void 0,this._drmSystemOptions=void 0,this._config=void 0,this._mediaKeysList=[],this._media=null,this._hasSetMediaKeys=!1,this._requestLicenseFailureCount=0,this.mediaKeysPromise=null,this._onMediaEncrypted=this.onMediaEncrypted.bind(this),this.hls=m,this._config=m.config,this._widevineLicenseUrl=this._config.widevineLicenseUrl,this._licenseXhrSetup=this._config.licenseXhrSetup,this._licenseResponseCallback=this._config.licenseResponseCallback,this._emeEnabled=this._config.emeEnabled,this._requestMediaKeySystemAccess=this._config.requestMediaKeySystemAccessFunc,this._drmSystemOptions=this._config.drmSystemOptions,this._registerListeners()}var E=p.prototype;return E.destroy=function(){this._unregisterListeners(),this.hls=this._onMediaEncrypted=null,this._requestMediaKeySystemAccess=null},E._registerListeners=function(){this.hls.on(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(M.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(M.Events.MANIFEST_PARSED,this.onManifestParsed,this)},E._unregisterListeners=function(){this.hls.off(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(M.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(M.Events.MANIFEST_PARSED,this.onManifestParsed,this)},E.getLicenseServerUrl=function(u){switch(u){case b.KeySystems.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+u+'"')},E._attemptKeySystemAccess=function(u,t,r){var e=this,f=y(u,t,r,this._drmSystemOptions);D.logger.log("Requesting encrypted media key-system access");var o=this.requestMediaKeySystemAccess(u,f);this.mediaKeysPromise=o.then(function(a){return e._onMediaKeySystemAccessObtained(u,a)}),o.catch(function(a){D.logger.error('Failed to obtain key-system "'+u+'" access:',a)})},E._onMediaKeySystemAccessObtained=function(u,t){var r=this;D.logger.log('Access for key-system "'+u+'" obtained');var e={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:t,mediaKeySystemDomain:u};this._mediaKeysList.push(e);var f=Promise.resolve().then(function(){return t.createMediaKeys()}).then(function(o){return e.mediaKeys=o,D.logger.log('Media-keys created for key-system "'+u+'"'),r._onMediaKeysCreated(),o});return f.catch(function(o){D.logger.error("Failed to create media-keys:",o)}),f},E._onMediaKeysCreated=function(){var u=this;this._mediaKeysList.forEach(function(t){t.mediaKeysSession||(t.mediaKeysSession=t.mediaKeys.createSession(),u._onNewMediaKeySession(t.mediaKeysSession))})},E._onNewMediaKeySession=function(u){var t=this;D.logger.log("New key-system session "+u.sessionId),u.addEventListener("message",function(r){t._onKeySessionMessage(u,r.message)},!1)},E._onKeySessionMessage=function(u,t){D.logger.log("Got EME message event, creating license request"),this._requestLicense(t,function(r){D.logger.log("Received license data (length: "+(r&&r.byteLength)+"), updating key-session"),u.update(r)})},E.onMediaEncrypted=function(u){var t=this;if(D.logger.log('Media is encrypted using "'+u.initDataType+'" init data type'),!this.mediaKeysPromise){D.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),this.hls.trigger(M.Events.ERROR,{type:O.ErrorTypes.KEY_SYSTEM_ERROR,details:O.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});return}var r=function(f){!t._media||(t._attemptSetMediaKeys(f),t._generateRequestWithPreferredKeySession(u.initDataType,u.initData))};this.mediaKeysPromise.then(r).catch(r)},E._attemptSetMediaKeys=function(u){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var t=this._mediaKeysList[0];if(!t||!t.mediaKeys){D.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),this.hls.trigger(M.Events.ERROR,{type:O.ErrorTypes.KEY_SYSTEM_ERROR,details:O.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});return}D.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(t.mediaKeys),this._hasSetMediaKeys=!0}},E._generateRequestWithPreferredKeySession=function(u,t){var r=this,e=this._mediaKeysList[0];if(!e){D.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),this.hls.trigger(M.Events.ERROR,{type:O.ErrorTypes.KEY_SYSTEM_ERROR,details:O.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});return}if(e.mediaKeysSessionInitialized){D.logger.warn("Key-Session already initialized but requested again");return}var f=e.mediaKeysSession;if(!f){D.logger.error("Fatal: Media is encrypted but no key-session existing"),this.hls.trigger(M.Events.ERROR,{type:O.ErrorTypes.KEY_SYSTEM_ERROR,details:O.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0});return}if(!t){D.logger.warn("Fatal: initData required for generating a key session is null"),this.hls.trigger(M.Events.ERROR,{type:O.ErrorTypes.KEY_SYSTEM_ERROR,details:O.ErrorDetails.KEY_SYSTEM_NO_INIT_DATA,fatal:!0});return}D.logger.log('Generating key-session request for "'+u+'" init data type'),e.mediaKeysSessionInitialized=!0,f.generateRequest(u,t).then(function(){D.logger.debug("Key-session generation succeeded")}).catch(function(o){D.logger.error("Error generating key-session request:",o),r.hls.trigger(M.Events.ERROR,{type:O.ErrorTypes.KEY_SYSTEM_ERROR,details:O.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})})},E._createLicenseXhr=function(u,t,r){var e=new XMLHttpRequest;e.responseType="arraybuffer",e.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,e,u,t,r);var f=this._licenseXhrSetup;if(f)try{f.call(this.hls,e,u),f=void 0}catch(o){D.logger.error(o)}try{e.readyState||e.open("POST",u,!0),f&&f.call(this.hls,e,u)}catch(o){throw new Error("issue setting up KeySystem license XHR "+o)}return e},E._onLicenseRequestReadyStageChange=function(u,t,r,e){switch(u.readyState){case 4:if(u.status===200){this._requestLicenseFailureCount=0,D.logger.log("License request succeeded");var f=u.response,o=this._licenseResponseCallback;if(o)try{f=o.call(this.hls,u,t)}catch(v){D.logger.error(v)}e(f)}else{if(D.logger.error("License Request XHR failed ("+t+"). Status: "+u.status+" ("+u.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount>A){this.hls.trigger(M.Events.ERROR,{type:O.ErrorTypes.KEY_SYSTEM_ERROR,details:O.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});return}var a=A-this._requestLicenseFailureCount+1;D.logger.warn("Retrying license request, "+a+" attempts left"),this._requestLicense(r,e)}break}},E._generateLicenseRequestChallenge=function(u,t){switch(u.mediaKeySystemDomain){case b.KeySystems.WIDEVINE:return t}throw new Error("unsupported key-system: "+u.mediaKeySystemDomain)},E._requestLicense=function(u,t){D.logger.log("Requesting content license for key-system");var r=this._mediaKeysList[0];if(!r){D.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),this.hls.trigger(M.Events.ERROR,{type:O.ErrorTypes.KEY_SYSTEM_ERROR,details:O.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});return}try{var e=this.getLicenseServerUrl(r.mediaKeySystemDomain),f=this._createLicenseXhr(e,u,t);D.logger.log("Sending license request to URL: "+e);var o=this._generateLicenseRequestChallenge(r,u);f.send(o)}catch(a){D.logger.error("Failure requesting DRM license: "+a),this.hls.trigger(M.Events.ERROR,{type:O.ErrorTypes.KEY_SYSTEM_ERROR,details:O.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},E.onMediaAttached=function(u,t){if(!!this._emeEnabled){var r=t.media;this._media=r,r.addEventListener("encrypted",this._onMediaEncrypted)}},E.onMediaDetached=function(){var u=this._media,t=this._mediaKeysList;!u||(u.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(t.map(function(r){if(r.mediaKeysSession)return r.mediaKeysSession.close().catch(function(){})})).then(function(){return u.setMediaKeys(null)}).catch(function(){}))},E.onManifestParsed=function(u,t){if(!!this._emeEnabled){var r=t.levels.map(function(f){return f.audioCodec}).filter(function(f){return!!f}),e=t.levels.map(function(f){return f.videoCodec}).filter(function(f){return!!f});this._attemptKeySystemAccess(b.KeySystems.WIDEVINE,r,e)}},I(p,[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}]),p}();F.default=L},"./src/controller/fps-controller.ts":function(G,F,T){"use strict";T.r(F);var M=T("./src/events.ts"),O=T("./src/utils/logger.ts"),D=function(){function b(I){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=I,this.registerListeners()}var C=b.prototype;return C.setStreamController=function(A){this.streamController=A},C.registerListeners=function(){this.hls.on(M.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},C.unregisterListeners=function(){this.hls.off(M.Events.MEDIA_ATTACHING,this.onMediaAttaching)},C.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},C.onMediaAttaching=function(A,g){var y=this.hls.config;if(y.capLevelOnFPSDrop){var L=g.media instanceof self.HTMLVideoElement?g.media:null;this.media=L,L&&typeof L.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),y.fpsDroppedMonitoringPeriod)}},C.checkFPS=function(A,g,y){var L=performance.now();if(g){if(this.lastTime){var p=L-this.lastTime,E=y-this.lastDroppedFrames,m=g-this.lastDecodedFrames,u=1e3*E/p,t=this.hls;if(t.trigger(M.Events.FPS_DROP,{currentDropped:E,currentDecoded:m,totalDroppedFrames:y}),u>0&&E>t.config.fpsDroppedMonitoringThreshold*m){var r=t.currentLevel;O.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+r),r>0&&(t.autoLevelCapping===-1||t.autoLevelCapping>=r)&&(r=r-1,t.trigger(M.Events.FPS_DROP_LEVEL_CAPPING,{level:r,droppedLevel:t.currentLevel}),t.autoLevelCapping=r,this.streamController.nextLevelSwitch())}}this.lastTime=L,this.lastDroppedFrames=y,this.lastDecodedFrames=g}},C.checkFPSInterval=function(){var A=this.media;if(A)if(this.isVideoPlaybackQualityAvailable){var g=A.getVideoPlaybackQuality();this.checkFPS(A,g.totalVideoFrames,g.droppedVideoFrames)}else this.checkFPS(A,A.webkitDecodedFrameCount,A.webkitDroppedFrameCount)},b}();F.default=D},"./src/controller/fragment-finders.ts":function(G,F,T){"use strict";T.r(F),T.d(F,"findFragmentByPDT",function(){return D}),T.d(F,"findFragmentByPTS",function(){return b}),T.d(F,"fragmentWithinToleranceTest",function(){return C}),T.d(F,"pdtWithinToleranceTest",function(){return I}),T.d(F,"findFragWithCC",function(){return A});var M=T("./src/polyfills/number.ts"),O=T("./src/utils/binary-search.ts");function D(g,y,L){if(y===null||!Array.isArray(g)||!g.length||!Object(M.isFiniteNumber)(y))return null;var p=g[0].programDateTime;if(y<(p||0))return null;var E=g[g.length-1].endProgramDateTime;if(y>=(E||0))return null;L=L||0;for(var m=0;m<g.length;++m){var u=g[m];if(I(y,L,u))return u}return null}function b(g,y,L,p){L===void 0&&(L=0),p===void 0&&(p=0);var E=null;if(g?E=y[g.sn-y[0].sn+1]||null:L===0&&y[0].start===0&&(E=y[0]),E&&C(L,p,E)===0)return E;var m=O.default.search(y,C.bind(null,L,p));return m||E}function C(g,y,L){g===void 0&&(g=0),y===void 0&&(y=0);var p=Math.min(y,L.duration+(L.deltaPTS?L.deltaPTS:0));return L.start+L.duration-p<=g?1:L.start-p>g&&L.start?-1:0}function I(g,y,L){var p=Math.min(y,L.duration+(L.deltaPTS?L.deltaPTS:0))*1e3,E=L.endProgramDateTime||0;return E-p>g}function A(g,y){return O.default.search(g,function(L){return L.cc<y?1:L.cc>y?-1:0})}},"./src/controller/fragment-tracker.ts":function(G,F,T){"use strict";T.r(F),T.d(F,"FragmentState",function(){return D}),T.d(F,"FragmentTracker",function(){return b});var M=T("./src/events.ts"),O=T("./src/types/loader.ts"),D;(function(A){A.NOT_LOADED="NOT_LOADED",A.BACKTRACKED="BACKTRACKED",A.APPENDING="APPENDING",A.PARTIAL="PARTIAL",A.OK="OK"})(D||(D={}));var b=function(){function A(y){this.activeFragment=null,this.activeParts=null,this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=y,this._registerListeners()}var g=A.prototype;return g._registerListeners=function(){var L=this.hls;L.on(M.Events.BUFFER_APPENDED,this.onBufferAppended,this),L.on(M.Events.FRAG_BUFFERED,this.onFragBuffered,this),L.on(M.Events.FRAG_LOADED,this.onFragLoaded,this)},g._unregisterListeners=function(){var L=this.hls;L.off(M.Events.BUFFER_APPENDED,this.onBufferAppended,this),L.off(M.Events.FRAG_BUFFERED,this.onFragBuffered,this),L.off(M.Events.FRAG_LOADED,this.onFragLoaded,this)},g.destroy=function(){this._unregisterListeners(),this.fragments=this.timeRanges=null},g.getAppendedFrag=function(L,p){if(p===O.PlaylistLevelType.MAIN){var E=this.activeFragment,m=this.activeParts;if(!E)return null;if(m)for(var u=m.length;u--;){var t=m[u],r=t?t.end:E.appendedPTS;if(t.start<=L&&r!==void 0&&L<=r)return u>9&&(this.activeParts=m.slice(u-9)),t}else if(E.start<=L&&E.appendedPTS!==void 0&&L<=E.appendedPTS)return E}return this.getBufferedFrag(L,p)},g.getBufferedFrag=function(L,p){for(var E=this.fragments,m=Object.keys(E),u=m.length;u--;){var t=E[m[u]];if((t==null?void 0:t.body.type)===p&&t.buffered){var r=t.body;if(r.start<=L&&L<=r.end)return r}}return null},g.detectEvictedFragments=function(L,p,E){var m=this;Object.keys(this.fragments).forEach(function(u){var t=m.fragments[u];if(!!t){if(!t.buffered){t.body.type===E&&m.removeFragment(t.body);return}var r=t.range[L];!r||r.time.some(function(e){var f=!m.isTimeBuffered(e.startPTS,e.endPTS,p);return f&&m.removeFragment(t.body),f})}})},g.detectPartialFragments=function(L){var p=this,E=this.timeRanges,m=L.frag,u=L.part;if(!(!E||m.sn==="initSegment")){var t=I(m),r=this.fragments[t];!r||(Object.keys(E).forEach(function(e){var f=m.elementaryStreams[e];if(!!f){var o=E[e],a=u!==null||f.partial===!0;r.range[e]=p.getBufferedTimes(m,u,a,o)}}),r.backtrack=r.loaded=null,Object.keys(r.range).length?r.buffered=!0:this.removeFragment(r.body))}},g.fragBuffered=function(L){var p=I(L),E=this.fragments[p];E&&(E.backtrack=E.loaded=null,E.buffered=!0)},g.getBufferedTimes=function(L,p,E,m){for(var u={time:[],partial:E},t=p?p.start:L.start,r=p?p.end:L.end,e=L.minEndPTS||r,f=L.maxStartPTS||t,o=0;o<m.length;o++){var a=m.start(o)-this.bufferPadding,v=m.end(o)+this.bufferPadding;if(f>=a&&e<=v){u.time.push({startPTS:Math.max(t,m.start(o)),endPTS:Math.min(r,m.end(o))});break}else if(t<v&&r>a)u.partial=!0,u.time.push({startPTS:Math.max(t,m.start(o)),endPTS:Math.min(r,m.end(o))});else if(r<=a)break}return u},g.getPartialFragment=function(L){var p=null,E,m,u,t=0,r=this.bufferPadding,e=this.fragments;return Object.keys(e).forEach(function(f){var o=e[f];!o||C(o)&&(m=o.body.start-r,u=o.body.end+r,L>=m&&L<=u&&(E=Math.min(L-m,u-L),t<=E&&(p=o.body,t=E)))}),p},g.getState=function(L){var p=I(L),E=this.fragments[p];return E?E.buffered?C(E)?D.PARTIAL:D.OK:E.backtrack?D.BACKTRACKED:D.APPENDING:D.NOT_LOADED},g.backtrack=function(L,p){var E=I(L),m=this.fragments[E];if(!m||m.backtrack)return null;var u=m.backtrack=p||m.loaded;return m.loaded=null,u},g.getBacktrackData=function(L){var p=I(L),E=this.fragments[p];if(E){var m,u=E.backtrack;if(u!=null&&(m=u.payload)!==null&&m!==void 0&&m.byteLength)return u;this.removeFragment(L)}return null},g.isTimeBuffered=function(L,p,E){for(var m,u,t=0;t<E.length;t++){if(m=E.start(t)-this.bufferPadding,u=E.end(t)+this.bufferPadding,L>=m&&p<=u)return!0;if(p<=m)return!1}return!1},g.onFragLoaded=function(L,p){var E=p.frag,m=p.part;if(!(E.sn==="initSegment"||E.bitrateTest||m)){var u=I(E);this.fragments[u]={body:E,loaded:p,backtrack:null,buffered:!1,range:Object.create(null)}}},g.onBufferAppended=function(L,p){var E=this,m=p.frag,u=p.part,t=p.timeRanges;if(m.type===O.PlaylistLevelType.MAIN)if(this.activeFragment=m,u){var r=this.activeParts;r||(this.activeParts=r=[]),r.push(u)}else this.activeParts=null;this.timeRanges=t,Object.keys(t).forEach(function(e){var f=t[e];if(E.detectEvictedFragments(e,f),!u)for(var o=0;o<f.length;o++)m.appendedPTS=Math.max(f.end(o),m.appendedPTS||0)})},g.onFragBuffered=function(L,p){this.detectPartialFragments(p)},g.hasFragment=function(L){var p=I(L);return!!this.fragments[p]},g.removeFragmentsInRange=function(L,p,E){var m=this;Object.keys(this.fragments).forEach(function(u){var t=m.fragments[u];if(!!t&&t.buffered){var r=t.body;r.type===E&&r.start<p&&r.end>L&&m.removeFragment(r)}})},g.removeFragment=function(L){var p=I(L);L.stats.loaded=0,L.clearElementaryStreamInfo(),delete this.fragments[p]},g.removeAllFragments=function(){this.fragments=Object.create(null),this.activeFragment=null,this.activeParts=null},A}();function C(A){var g,y;return A.buffered&&(((g=A.range.video)===null||g===void 0?void 0:g.partial)||((y=A.range.audio)===null||y===void 0?void 0:y.partial))}function I(A){return A.type+"_"+A.level+"_"+A.urlId+"_"+A.sn}},"./src/controller/gap-controller.ts":function(G,F,T){"use strict";T.r(F),T.d(F,"STALL_MINIMUM_DURATION_MS",function(){return C}),T.d(F,"MAX_START_GAP_JUMP",function(){return I}),T.d(F,"SKIP_BUFFER_HOLE_STEP_SECONDS",function(){return A}),T.d(F,"SKIP_BUFFER_RANGE_START",function(){return g}),T.d(F,"default",function(){return y});var M=T("./src/utils/buffer-helper.ts"),O=T("./src/errors.ts"),D=T("./src/events.ts"),b=T("./src/utils/logger.ts"),C=250,I=2,A=.1,g=.05,y=function(){function L(E,m,u,t){this.config=void 0,this.media=void 0,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=E,this.media=m,this.fragmentTracker=u,this.hls=t}var p=L.prototype;return p.destroy=function(){this.hls=this.fragmentTracker=this.media=null},p.poll=function(m){var u=this.config,t=this.media,r=this.stalled,e=t.currentTime,f=t.seeking,o=this.seeking&&!f,a=!this.seeking&&f;if(this.seeking=f,e!==m){if(this.moved=!0,r!==null){if(this.stallReported){var v=self.performance.now()-r;b.logger.warn("playback not stuck anymore @"+e+", after "+Math.round(v)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}return}if((a||o)&&(this.stalled=null),!(t.paused||t.ended||t.playbackRate===0||!M.BufferHelper.getBuffered(t).length)){var h=M.BufferHelper.bufferInfo(t,e,0),l=h.len>0,s=h.nextStart||0;if(!(!l&&!s)){if(f){var n=h.len>I,i=!s||s-e>I&&!this.fragmentTracker.getPartialFragment(e);if(n||i)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var d,c=Math.max(s,h.start||0)-e,S=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,R=S==null||(d=S.details)===null||d===void 0?void 0:d.live,P=R?S.details.targetduration*2:I;if(c>0&&c<=P){this._trySkipBufferHole(null);return}}var B=self.performance.now();if(r===null){this.stalled=B;return}var x=B-r;!f&&x>=C&&this._reportStall(h.len);var U=M.BufferHelper.bufferInfo(t,e,u.maxBufferHole);this._tryFixBufferStall(U,x)}}},p._tryFixBufferStall=function(m,u){var t=this.config,r=this.fragmentTracker,e=this.media,f=e.currentTime,o=r.getPartialFragment(f);if(o){var a=this._trySkipBufferHole(o);if(a)return}m.len>t.maxBufferHole&&u>t.highBufferWatchdogPeriod*1e3&&(b.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())},p._reportStall=function(m){var u=this.hls,t=this.media,r=this.stallReported;r||(this.stallReported=!0,b.logger.warn("Playback stalling at @"+t.currentTime+" due to low buffer (buffer="+m+")"),u.trigger(D.Events.ERROR,{type:O.ErrorTypes.MEDIA_ERROR,details:O.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:m}))},p._trySkipBufferHole=function(m){for(var u=this.config,t=this.hls,r=this.media,e=r.currentTime,f=0,o=M.BufferHelper.getBuffered(r),a=0;a<o.length;a++){var v=o.start(a);if(e+u.maxBufferHole>=f&&e<v){var h=Math.max(v+g,r.currentTime+A);return b.logger.warn("skipping hole, adjusting currentTime from "+e+" to "+h),this.moved=!0,this.stalled=null,r.currentTime=h,m&&t.trigger(D.Events.ERROR,{type:O.ErrorTypes.MEDIA_ERROR,details:O.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+e+" to "+h,frag:m}),h}f=o.end(a)}return 0},p._tryNudgeBuffer=function(){var m=this.config,u=this.hls,t=this.media,r=t.currentTime,e=(this.nudgeRetry||0)+1;if(this.nudgeRetry=e,e<m.nudgeMaxRetry){var f=r+e*m.nudgeOffset;b.logger.warn("Nudging 'currentTime' from "+r+" to "+f),t.currentTime=f,u.trigger(D.Events.ERROR,{type:O.ErrorTypes.MEDIA_ERROR,details:O.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else b.logger.error("Playhead still not moving while enough data buffered @"+r+" after "+m.nudgeMaxRetry+" nudges"),u.trigger(D.Events.ERROR,{type:O.ErrorTypes.MEDIA_ERROR,details:O.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})},L}()},"./src/controller/id3-track-controller.ts":function(G,F,T){"use strict";T.r(F);var M=T("./src/events.ts"),O=T("./src/utils/texttrack-utils.ts"),D=T("./src/demux/id3.ts"),b=.25,C=function(){function I(g){this.hls=void 0,this.id3Track=null,this.media=null,this.hls=g,this._registerListeners()}var A=I.prototype;return A.destroy=function(){this._unregisterListeners()},A._registerListeners=function(){var y=this.hls;y.on(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),y.on(M.Events.MEDIA_DETACHING,this.onMediaDetaching,this),y.on(M.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),y.on(M.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},A._unregisterListeners=function(){var y=this.hls;y.off(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),y.off(M.Events.MEDIA_DETACHING,this.onMediaDetaching,this),y.off(M.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),y.off(M.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},A.onMediaAttached=function(y,L){this.media=L.media},A.onMediaDetaching=function(){!this.id3Track||(Object(O.clearCurrentCues)(this.id3Track),this.id3Track=null,this.media=null)},A.getID3Track=function(y){if(!!this.media){for(var L=0;L<y.length;L++){var p=y[L];if(p.kind==="metadata"&&p.label==="id3")return Object(O.sendAddTrackEvent)(p,this.media),p}return this.media.addTextTrack("metadata","id3")}},A.onFragParsingMetadata=function(y,L){if(!!this.media){var p=L.frag,E=L.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(var m=self.WebKitDataCue||self.VTTCue||self.TextTrackCue,u=0;u<E.length;u++){var t=D.getID3Frames(E[u].data);if(t){var r=E[u].pts,e=u<E.length-1?E[u+1].pts:p.end,f=e-r;f<=0&&(e=r+b);for(var o=0;o<t.length;o++){var a=t[o];if(!D.isTimeStampFrame(a)){var v=new m(r,e,"");v.value=a,this.id3Track.addCue(v)}}}}}},A.onBufferFlushing=function(y,L){var p=L.startOffset,E=L.endOffset,m=L.type;if(!m||m==="audio"){var u=this.id3Track;u&&Object(O.removeCuesInRange)(u,p,E)}},I}();F.default=C},"./src/controller/latency-controller.ts":function(G,F,T){"use strict";T.r(F),T.d(F,"default",function(){return I});var M=T("./src/errors.ts"),O=T("./src/events.ts"),D=T("./src/utils/logger.ts");function b(A,g){for(var y=0;y<g.length;y++){var L=g[y];L.enumerable=L.enumerable||!1,L.configurable=!0,"value"in L&&(L.writable=!0),Object.defineProperty(A,L.key,L)}}function C(A,g,y){return g&&b(A.prototype,g),y&&b(A,y),A}var I=function(){function A(y){var L=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return L.timeupdate()},this.hls=y,this.config=y.config,this.registerListeners()}var g=A.prototype;return g.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},g.registerListeners=function(){this.hls.on(O.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(O.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(O.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(O.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(O.Events.ERROR,this.onError,this)},g.unregisterListeners=function(){this.hls.off(O.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(O.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(O.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(O.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(O.Events.ERROR,this.onError)},g.onMediaAttached=function(L,p){this.media=p.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},g.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},g.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},g.onLevelUpdated=function(L,p){var E=p.details;this.levelDetails=E,E.advanced&&this.timeupdate(),!E.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},g.onError=function(L,p){p.details===M.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,D.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},g.timeupdate=function(){var L=this.media,p=this.levelDetails;if(!(!L||!p)){this.currentTime=L.currentTime;var E=this.computeLatency();if(E!==null){this._latency=E;var m=this.config,u=m.lowLatencyMode,t=m.maxLiveSyncPlaybackRate;if(!(!u||t===1)){var r=this.targetLatency;if(r!==null){var e=E-r,f=Math.min(this.maxLatency,r+p.targetduration),o=e<f;if(p.live&&o&&e>.05&&this.forwardBufferLength>1){var a=Math.min(2,Math.max(1,t)),v=Math.round(2/(1+Math.exp(-.75*e-this.edgeStalled))*20)/20;L.playbackRate=Math.min(a,Math.max(1,v))}else L.playbackRate!==1&&L.playbackRate!==0&&(L.playbackRate=1)}}}}},g.estimateLiveEdge=function(){var L=this.levelDetails;return L===null?null:L.edge+L.age},g.computeLatency=function(){var L=this.estimateLiveEdge();return L===null?null:L-this.currentTime},C(A,[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var L=this.config,p=this.levelDetails;return L.liveMaxLatencyDuration!==void 0?L.liveMaxLatencyDuration:p?L.liveMaxLatencyDurationCount*p.targetduration:0}},{key:"targetLatency",get:function(){var L=this.levelDetails;if(L===null)return null;var p=L.holdBack,E=L.partHoldBack,m=L.targetduration,u=this.config,t=u.liveSyncDuration,r=u.liveSyncDurationCount,e=u.lowLatencyMode,f=this.hls.userConfig,o=e&&E||p;(f.liveSyncDuration||f.liveSyncDurationCount||o===0)&&(o=t!==void 0?t:r*m);var a=m,v=1;return o+Math.min(this.stallCount*v,a)}},{key:"liveSyncPosition",get:function(){var L=this.estimateLiveEdge(),p=this.targetLatency,E=this.levelDetails;if(L===null||p===null||E===null)return null;var m=E.edge,u=L-p-this.edgeStalled,t=m-E.totalduration,r=m-(this.config.lowLatencyMode&&E.partTarget||E.targetduration);return Math.min(Math.max(t,u),r)}},{key:"drift",get:function(){var L=this.levelDetails;return L===null?1:L.drift}},{key:"edgeStalled",get:function(){var L=this.levelDetails;if(L===null)return 0;var p=(this.config.lowLatencyMode&&L.partTarget||L.targetduration)*3;return Math.max(L.age-p,0)}},{key:"forwardBufferLength",get:function(){var L=this.media,p=this.levelDetails;if(!L||!p)return 0;var E=L.buffered.length;return E?L.buffered.end(E-1):p.edge-this.currentTime}}]),A}()},"./src/controller/level-controller.ts":function(G,F,T){"use strict";T.r(F),T.d(F,"default",function(){return u});var M=T("./src/types/level.ts"),O=T("./src/events.ts"),D=T("./src/errors.ts"),b=T("./src/utils/codecs.ts"),C=T("./src/controller/level-helper.ts"),I=T("./src/controller/base-playlist-controller.ts"),A=T("./src/types/loader.ts");function g(){return g=Object.assign||function(t){for(var r=1;r<arguments.length;r++){var e=arguments[r];for(var f in e)Object.prototype.hasOwnProperty.call(e,f)&&(t[f]=e[f])}return t},g.apply(this,arguments)}function y(t,r){for(var e=0;e<r.length;e++){var f=r[e];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(t,f.key,f)}}function L(t,r,e){return r&&y(t.prototype,r),e&&y(t,e),t}function p(t,r){t.prototype=Object.create(r.prototype),t.prototype.constructor=t,E(t,r)}function E(t,r){return E=Object.setPrototypeOf||function(f,o){return f.__proto__=o,f},E(t,r)}var m=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),u=function(t){p(r,t);function r(f){var o;return o=t.call(this,f,"[level-controller]")||this,o._levels=[],o._firstLevel=-1,o._startLevel=void 0,o.currentLevelIndex=-1,o.manualLevelIndex=-1,o.onParsedComplete=void 0,o._registerListeners(),o}var e=r.prototype;return e._registerListeners=function(){var o=this.hls;o.on(O.Events.MANIFEST_LOADED,this.onManifestLoaded,this),o.on(O.Events.LEVEL_LOADED,this.onLevelLoaded,this),o.on(O.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),o.on(O.Events.FRAG_LOADED,this.onFragLoaded,this),o.on(O.Events.ERROR,this.onError,this)},e._unregisterListeners=function(){var o=this.hls;o.off(O.Events.MANIFEST_LOADED,this.onManifestLoaded,this),o.off(O.Events.LEVEL_LOADED,this.onLevelLoaded,this),o.off(O.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),o.off(O.Events.FRAG_LOADED,this.onFragLoaded,this),o.off(O.Events.ERROR,this.onError,this)},e.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,t.prototype.destroy.call(this)},e.startLoad=function(){var o=this._levels;o.forEach(function(a){a.loadError=0}),t.prototype.startLoad.call(this)},e.onManifestLoaded=function(o,a){var v=[],h=[],l=[],s,n={},i,d=!1,c=!1,S=!1;if(a.levels.forEach(function(x){var U=x.attrs;d=d||!!(x.width&&x.height),c=c||!!x.videoCodec,S=S||!!x.audioCodec,m&&x.audioCodec&&x.audioCodec.indexOf("mp4a.40.34")!==-1&&(x.audioCodec=void 0);var k=x.bitrate+"-"+x.attrs.RESOLUTION+"-"+x.attrs.CODECS;i=n[k],i?i.url.push(x.url):(i=new M.Level(x),n[k]=i,v.push(i)),U&&(U.AUDIO&&Object(C.addGroupId)(i,"audio",U.AUDIO),U.SUBTITLES&&Object(C.addGroupId)(i,"text",U.SUBTITLES))}),(d||c)&&S&&(v=v.filter(function(x){var U=x.videoCodec,k=x.width,N=x.height;return!!U||!!(k&&N)})),v=v.filter(function(x){var U=x.audioCodec,k=x.videoCodec;return(!U||Object(b.isCodecSupportedInMp4)(U,"audio"))&&(!k||Object(b.isCodecSupportedInMp4)(k,"video"))}),a.audioTracks&&(h=a.audioTracks.filter(function(x){return!x.audioCodec||Object(b.isCodecSupportedInMp4)(x.audioCodec,"audio")}),Object(C.assignTrackIdsByGroup)(h)),a.subtitles&&(l=a.subtitles,Object(C.assignTrackIdsByGroup)(l)),v.length>0){s=v[0].bitrate,v.sort(function(x,U){return x.bitrate-U.bitrate}),this._levels=v;for(var R=0;R<v.length;R++)if(v[R].bitrate===s){this._firstLevel=R,this.log("manifest loaded, "+v.length+" level(s) found, first bitrate: "+s);break}var P=S&&!c,B={levels:v,audioTracks:h,subtitleTracks:l,firstLevel:this._firstLevel,stats:a.stats,audio:S,video:c,altAudio:!P&&h.some(function(x){return!!x.url})};this.hls.trigger(O.Events.MANIFEST_PARSED,B),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(O.Events.ERROR,{type:D.ErrorTypes.MEDIA_ERROR,details:D.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:a.url,reason:"no level with compatible codecs found in manifest"})},e.onError=function(o,a){if(t.prototype.onError.call(this,o,a),!a.fatal){var v=a.context,h=this._levels[this.currentLevelIndex];if(v&&(v.type===A.PlaylistContextType.AUDIO_TRACK&&h.audioGroupIds&&v.groupId===h.audioGroupIds[h.urlId]||v.type===A.PlaylistContextType.SUBTITLE_TRACK&&h.textGroupIds&&v.groupId===h.textGroupIds[h.urlId])){this.redundantFailover(this.currentLevelIndex);return}var l=!1,s=!0,n;switch(a.details){case D.ErrorDetails.FRAG_LOAD_ERROR:case D.ErrorDetails.FRAG_LOAD_TIMEOUT:case D.ErrorDetails.KEY_LOAD_ERROR:case D.ErrorDetails.KEY_LOAD_TIMEOUT:if(a.frag){var i=this._levels[a.frag.level];i?(i.fragmentError++,i.fragmentError>this.hls.config.fragLoadingMaxRetry&&(n=a.frag.level)):n=a.frag.level}break;case D.ErrorDetails.LEVEL_LOAD_ERROR:case D.ErrorDetails.LEVEL_LOAD_TIMEOUT:v&&(v.deliveryDirectives&&(s=!1),n=v.level),l=!0;break;case D.ErrorDetails.REMUX_ALLOC_ERROR:n=a.level,l=!0;break}n!==void 0&&this.recoverLevel(a,n,l,s)}},e.recoverLevel=function(o,a,v,h){var l=o.details,s=this._levels[a];if(s.loadError++,v){var n=this.retryLoadingOrFail(o);if(n)o.levelRetry=!0;else{this.currentLevelIndex=-1;return}}if(h){var i=s.url.length;if(i>1&&s.loadError<i)o.levelRetry=!0,this.redundantFailover(a);else if(this.manualLevelIndex===-1){var d=a===0?this._levels.length-1:a-1;this.currentLevelIndex!==d&&this._levels[d].loadError===0&&(this.warn(l+": switch to "+d),o.levelRetry=!0,this.hls.nextAutoLevel=d)}}},e.redundantFailover=function(o){var a=this._levels[o],v=a.url.length;if(v>1){var h=(a.urlId+1)%v;this.warn("Switching to redundant URL-id "+h),this._levels.forEach(function(l){l.urlId=h}),this.level=o}},e.onFragLoaded=function(o,a){var v=a.frag;if(v!==void 0&&v.type===A.PlaylistLevelType.MAIN){var h=this._levels[v.level];h!==void 0&&(h.fragmentError=0,h.loadError=0)}},e.onLevelLoaded=function(o,a){var v,h=a.level,l=a.details,s=this._levels[h];if(!s){var n;this.warn("Invalid level index "+h),(n=a.deliveryDirectives)!==null&&n!==void 0&&n.skip&&(l.deltaUpdateFailed=!0);return}h===this.currentLevelIndex?(s.fragmentError===0&&(s.loadError=0,this.retryCount=0),this.playlistLoaded(h,a,s.details)):(v=a.deliveryDirectives)!==null&&v!==void 0&&v.skip&&(l.deltaUpdateFailed=!0)},e.onAudioTrackSwitched=function(o,a){var v=this.hls.levels[this.currentLevelIndex];if(!!v&&v.audioGroupIds){for(var h=-1,l=this.hls.audioTracks[a.id].groupId,s=0;s<v.audioGroupIds.length;s++)if(v.audioGroupIds[s]===l){h=s;break}h!==v.urlId&&(v.urlId=h,this.startLoad())}},e.loadPlaylist=function(o){var a=this.currentLevelIndex,v=this._levels[a];if(this.canLoad&&v&&v.url.length>0){var h=v.urlId,l=v.url[h];if(o)try{l=o.addDirectives(l)}catch(s){this.warn("Could not construct new URL with HLS Delivery Directives: "+s)}this.log("Attempt loading level index "+a+(o?" at sn "+o.msn+" part "+o.part:"")+" with URL-id "+h+" "+l),this.clearTimer(),this.hls.trigger(O.Events.LEVEL_LOADING,{url:l,level:a,id:h,deliveryDirectives:o||null})}},e.removeLevel=function(o,a){var v=function(s,n){return n!==a},h=this._levels.filter(function(l,s){return s!==o?!0:l.url.length>1&&a!==void 0?(l.url=l.url.filter(v),l.audioGroupIds&&(l.audioGroupIds=l.audioGroupIds.filter(v)),l.textGroupIds&&(l.textGroupIds=l.textGroupIds.filter(v)),l.urlId=0,!0):!1}).map(function(l,s){var n=l.details;return n!=null&&n.fragments&&n.fragments.forEach(function(i){i.level=s}),l});this._levels=h,this.hls.trigger(O.Events.LEVELS_UPDATED,{levels:h})},L(r,[{key:"levels",get:function(){return this._levels.length===0?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(o){var a,v=this._levels;if(v.length!==0&&!(this.currentLevelIndex===o&&(a=v[o])!==null&&a!==void 0&&a.details)){if(o<0||o>=v.length){var h=o<0;if(this.hls.trigger(O.Events.ERROR,{type:D.ErrorTypes.OTHER_ERROR,details:D.ErrorDetails.LEVEL_SWITCH_ERROR,level:o,fatal:h,reason:"invalid level idx"}),h)return;o=Math.min(o,v.length-1)}this.clearTimer();var l=this.currentLevelIndex,s=v[l],n=v[o];this.log("switching to level "+o+" from "+l),this.currentLevelIndex=o;var i=g({},n,{level:o,maxBitrate:n.maxBitrate,uri:n.uri,urlId:n.urlId});delete i._urlId,this.hls.trigger(O.Events.LEVEL_SWITCHING,i);var d=n.details;if(!d||d.live){var c=this.switchParams(n.uri,s==null?void 0:s.details);this.loadPlaylist(c)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(o){this.manualLevelIndex=o,this._startLevel===void 0&&(this._startLevel=o),o!==-1&&(this.level=o)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(o){this._firstLevel=o}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var o=this.hls.config.startLevel;return o!==void 0?o:this._firstLevel}else return this._startLevel},set:function(o){this._startLevel=o}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(o){this.level=o,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=o)}}]),r}(I.default)},"./src/controller/level-helper.ts":function(G,F,T){"use strict";T.r(F),T.d(F,"addGroupId",function(){return D}),T.d(F,"assignTrackIdsByGroup",function(){return b}),T.d(F,"updatePTS",function(){return C}),T.d(F,"updateFragPTSDTS",function(){return A}),T.d(F,"mergeDetails",function(){return g}),T.d(F,"mapPartIntersection",function(){return y}),T.d(F,"mapFragmentIntersection",function(){return L}),T.d(F,"adjustSliding",function(){return p}),T.d(F,"addSliding",function(){return E}),T.d(F,"computeReloadInterval",function(){return m}),T.d(F,"getFragmentWithSN",function(){return u}),T.d(F,"getPartWith",function(){return t});var M=T("./src/polyfills/number.ts"),O=T("./src/utils/logger.ts");function D(r,e,f){switch(e){case"audio":r.audioGroupIds||(r.audioGroupIds=[]),r.audioGroupIds.push(f);break;case"text":r.textGroupIds||(r.textGroupIds=[]),r.textGroupIds.push(f);break}}function b(r){var e={};r.forEach(function(f){var o=f.groupId||"";f.id=e[o]=e[o]||0,e[o]++})}function C(r,e,f){var o=r[e],a=r[f];I(o,a)}function I(r,e){var f=e.startPTS;if(Object(M.isFiniteNumber)(f)){var o=0,a;e.sn>r.sn?(o=f-r.start,a=r):(o=r.start-f,a=e),a.duration!==o&&(a.duration=o)}else if(e.sn>r.sn){var v=r.cc===e.cc;v&&r.minEndPTS?e.start=r.start+(r.minEndPTS-r.start):e.start=r.start+r.duration}else e.start=Math.max(r.start-e.duration,0)}function A(r,e,f,o,a,v){var h=o-f;h<=0&&(O.logger.warn("Fragment should have a positive duration",e),o=f+e.duration,v=a+e.duration);var l=f,s=o,n=e.startPTS,i=e.endPTS;if(Object(M.isFiniteNumber)(n)){var d=Math.abs(n-f);Object(M.isFiniteNumber)(e.deltaPTS)?e.deltaPTS=Math.max(d,e.deltaPTS):e.deltaPTS=d,l=Math.max(f,n),f=Math.min(f,n),a=Math.min(a,e.startDTS),s=Math.min(o,i),o=Math.max(o,i),v=Math.max(v,e.endDTS)}e.duration=o-f;var c=f-e.start;e.appendedPTS=o,e.start=e.startPTS=f,e.maxStartPTS=l,e.startDTS=a,e.endPTS=o,e.minEndPTS=s,e.endDTS=v;var S=e.sn;if(!r||S<r.startSN||S>r.endSN)return 0;var R,P=S-r.startSN,B=r.fragments;for(B[P]=e,R=P;R>0;R--)I(B[R],B[R-1]);for(R=P;R<B.length-1;R++)I(B[R],B[R+1]);return r.fragmentHint&&I(B[B.length-1],r.fragmentHint),r.PTSKnown=r.alignedSliding=!0,c}function g(r,e){for(var f=null,o=r.fragments,a=o.length-1;a>=0;a--){var v=o[a].initSegment;if(v){f=v;break}}r.fragmentHint&&delete r.fragmentHint.endPTS;var h=0,l;if(L(r,e,function(R,P){R.relurl&&(h=R.cc-P.cc),Object(M.isFiniteNumber)(R.startPTS)&&Object(M.isFiniteNumber)(R.endPTS)&&(P.start=P.startPTS=R.startPTS,P.startDTS=R.startDTS,P.appendedPTS=R.appendedPTS,P.maxStartPTS=R.maxStartPTS,P.endPTS=R.endPTS,P.endDTS=R.endDTS,P.minEndPTS=R.minEndPTS,P.duration=R.endPTS-R.startPTS,P.duration&&(l=P),e.PTSKnown=e.alignedSliding=!0),P.elementaryStreams=R.elementaryStreams,P.loader=R.loader,P.stats=R.stats,P.urlId=R.urlId,R.initSegment&&(P.initSegment=R.initSegment,f=R.initSegment)}),f){var s=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments;s.forEach(function(R){var P;(!R.initSegment||R.initSegment.relurl===((P=f)===null||P===void 0?void 0:P.relurl))&&(R.initSegment=f)})}if(e.skippedSegments&&(e.deltaUpdateFailed=e.fragments.some(function(R){return!R}),e.deltaUpdateFailed)){O.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var n=e.skippedSegments;n--;)e.fragments.shift();e.startSN=e.fragments[0].sn,e.startCC=e.fragments[0].cc}var i=e.fragments;if(h){O.logger.warn("discontinuity sliding from playlist, take drift into account");for(var d=0;d<i.length;d++)i[d].cc+=h}e.skippedSegments&&(e.startCC=e.fragments[0].cc),y(r.partList,e.partList,function(R,P){P.elementaryStreams=R.elementaryStreams,P.stats=R.stats}),l?A(e,l,l.startPTS,l.endPTS,l.startDTS,l.endDTS):p(r,e),i.length&&(e.totalduration=e.edge-i[0].start),e.driftStartTime=r.driftStartTime,e.driftStart=r.driftStart;var c=e.advancedDateTime;if(e.advanced&&c){var S=e.edge;e.driftStart||(e.driftStartTime=c,e.driftStart=S),e.driftEndTime=c,e.driftEnd=S}else e.driftEndTime=r.driftEndTime,e.driftEnd=r.driftEnd,e.advancedDateTime=r.advancedDateTime}function y(r,e,f){if(r&&e)for(var o=0,a=0,v=r.length;a<=v;a++){var h=r[a],l=e[a+o];h&&l&&h.index===l.index&&h.fragment.sn===l.fragment.sn?f(h,l):o--}}function L(r,e,f){for(var o=e.skippedSegments,a=Math.max(r.startSN,e.startSN)-e.startSN,v=(r.fragmentHint?1:0)+(o?e.endSN:Math.min(r.endSN,e.endSN))-e.startSN,h=e.startSN-r.startSN,l=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,s=r.fragmentHint?r.fragments.concat(r.fragmentHint):r.fragments,n=a;n<=v;n++){var i=s[h+n],d=l[n];o&&!d&&n<o&&(d=e.fragments[n]=i),i&&d&&f(i,d)}}function p(r,e){var f=e.startSN+e.skippedSegments-r.startSN,o=r.fragments;f<0||f>=o.length||E(e,o[f].start)}function E(r,e){if(e){for(var f=r.fragments,o=r.skippedSegments;o<f.length;o++)f[o].start+=e;r.fragmentHint&&(r.fragmentHint.start+=e)}}function m(r,e){var f=1e3*r.levelTargetDuration,o=f/2,a=r.age,v=a>0&&a<f*3,h=e.loading.end-e.loading.start,l,s=r.availabilityDelay;if(r.updated===!1)if(v){var n=333*r.misses;l=Math.max(Math.min(o,h*2),n),r.availabilityDelay=(r.availabilityDelay||0)+l}else l=o;else v?(s=Math.min(s||f/2,a),r.availabilityDelay=s,l=s+f-a):l=f-h;return Math.round(l)}function u(r,e,f){if(!r||!r.details)return null;var o=r.details,a=o.fragments[e-o.startSN];return a||(a=o.fragmentHint,a&&a.sn===e)?a:e<o.startSN&&f&&f.sn===e?f:null}function t(r,e,f){if(!r||!r.details)return null;var o=r.details.partList;if(o)for(var a=o.length;a--;){var v=o[a];if(v.index===f&&v.fragment.sn===e)return v}return null}},"./src/controller/stream-controller.ts":function(G,F,T){"use strict";T.r(F),T.d(F,"default",function(){return o});var M=T("./src/polyfills/number.ts"),O=T("./src/controller/base-stream-controller.ts"),D=T("./src/is-supported.ts"),b=T("./src/events.ts"),C=T("./src/utils/buffer-helper.ts"),I=T("./src/controller/fragment-tracker.ts"),A=T("./src/types/loader.ts"),g=T("./src/loader/fragment.ts"),y=T("./src/demux/transmuxer-interface.ts"),L=T("./src/types/transmuxer.ts"),p=T("./src/controller/gap-controller.ts"),E=T("./src/errors.ts"),m=T("./src/utils/logger.ts");function u(a,v){for(var h=0;h<v.length;h++){var l=v[h];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(a,l.key,l)}}function t(a,v,h){return v&&u(a.prototype,v),h&&u(a,h),a}function r(a,v){a.prototype=Object.create(v.prototype),a.prototype.constructor=a,e(a,v)}function e(a,v){return e=Object.setPrototypeOf||function(l,s){return l.__proto__=s,l},e(a,v)}var f=100,o=function(a){r(v,a);function v(l,s){var n;return n=a.call(this,l,s,"[stream-controller]")||this,n.audioCodecSwap=!1,n.gapController=null,n.level=-1,n._forceStartLoad=!1,n.altAudio=!1,n.audioOnly=!1,n.fragPlaying=null,n.onvplaying=null,n.onvseeked=null,n.fragLastKbps=0,n.stalled=!1,n.couldBacktrack=!1,n.audioCodecSwitch=!1,n.videoBuffer=null,n._registerListeners(),n}var h=v.prototype;return h._registerListeners=function(){var s=this.hls;s.on(b.Events.MEDIA_ATTACHED,this.onMediaAttached,this),s.on(b.Events.MEDIA_DETACHING,this.onMediaDetaching,this),s.on(b.Events.MANIFEST_LOADING,this.onManifestLoading,this),s.on(b.Events.MANIFEST_PARSED,this.onManifestParsed,this),s.on(b.Events.LEVEL_LOADING,this.onLevelLoading,this),s.on(b.Events.LEVEL_LOADED,this.onLevelLoaded,this),s.on(b.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),s.on(b.Events.ERROR,this.onError,this),s.on(b.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),s.on(b.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),s.on(b.Events.BUFFER_CREATED,this.onBufferCreated,this),s.on(b.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),s.on(b.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),s.on(b.Events.FRAG_BUFFERED,this.onFragBuffered,this)},h._unregisterListeners=function(){var s=this.hls;s.off(b.Events.MEDIA_ATTACHED,this.onMediaAttached,this),s.off(b.Events.MEDIA_DETACHING,this.onMediaDetaching,this),s.off(b.Events.MANIFEST_LOADING,this.onManifestLoading,this),s.off(b.Events.MANIFEST_PARSED,this.onManifestParsed,this),s.off(b.Events.LEVEL_LOADED,this.onLevelLoaded,this),s.off(b.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),s.off(b.Events.ERROR,this.onError,this),s.off(b.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),s.off(b.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),s.off(b.Events.BUFFER_CREATED,this.onBufferCreated,this),s.off(b.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),s.off(b.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),s.off(b.Events.FRAG_BUFFERED,this.onFragBuffered,this)},h.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},h.startLoad=function(s){if(this.levels){var n=this.lastCurrentTime,i=this.hls;if(this.stopLoad(),this.setInterval(f),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var d=i.startLevel;d===-1&&(i.config.testBandwidth?(d=0,this.bitrateTest=!0):d=i.nextAutoLevel),this.level=i.nextLoadLevel=d,this.loadedmetadata=!1}n>0&&s===-1&&(this.log("Override startPosition with lastCurrentTime @"+n.toFixed(3)),s=n),this.state=O.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=s,this.tick()}else this._forceStartLoad=!0,this.state=O.State.STOPPED},h.stopLoad=function(){this._forceStartLoad=!1,a.prototype.stopLoad.call(this)},h.doTick=function(){switch(this.state){case O.State.IDLE:this.doTickIdle();break;case O.State.WAITING_LEVEL:{var s,n=this.levels,i=this.level,d=n==null||(s=n[i])===null||s===void 0?void 0:s.details;if(d&&(!d.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(d))break;this.state=O.State.IDLE;break}break}case O.State.FRAG_LOADING_WAITING_RETRY:{var c,S=self.performance.now(),R=this.retryDate;(!R||S>=R||(c=this.media)!==null&&c!==void 0&&c.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.state=O.State.IDLE)}break;default:break}this.onTickEnd()},h.onTickEnd=function(){a.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},h.doTickIdle=function(){var s,n,i=this.hls,d=this.levelLastLoaded,c=this.levels,S=this.media,R=i.config,P=i.nextLoadLevel;if(!(d===null||!S&&(this.startFragRequested||!R.startFragPrefetch))&&!(this.altAudio&&this.audioOnly)&&!(!c||!c[P])){var B=c[P];this.level=i.nextLoadLevel=P;var x=B.details;if(!x||this.state===O.State.WAITING_LEVEL||x.live&&this.levelLastLoaded!==P){this.state=O.State.WAITING_LEVEL;return}var U=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:S,A.PlaylistLevelType.MAIN);if(U!==null){var k=U.len,N=this.getMaxBufferLength(B.maxBitrate);if(!(k>=N)){if(this._streamEnded(U,x)){var K={};this.altAudio&&(K.type="video"),this.hls.trigger(b.Events.BUFFER_EOS,K),this.state=O.State.ENDED;return}var W=U.end,w=this.getNextFragment(W,x);if(this.couldBacktrack&&!this.fragPrevious&&w&&w.sn!=="initSegment"){var H=w.sn-x.startSN;H>1&&(w=x.fragments[H-1],this.fragmentTracker.removeFragment(w))}if(w&&this.fragmentTracker.getState(w)===I.FragmentState.OK&&this.nextLoadPosition>W){var V=this.audioOnly&&!this.altAudio?g.ElementaryStreamTypes.AUDIO:g.ElementaryStreamTypes.VIDEO;this.afterBufferFlushed(S,V,A.PlaylistLevelType.MAIN),w=this.getNextFragment(this.nextLoadPosition,x)}!w||(w.initSegment&&!w.initSegment.data&&!this.bitrateTest&&(w=w.initSegment),((s=w.decryptdata)===null||s===void 0?void 0:s.keyFormat)==="identity"&&!((n=w.decryptdata)!==null&&n!==void 0&&n.key)?this.loadKey(w,x):this.loadFragment(w,x,W))}}}},h.loadFragment=function(s,n,i){var d,c=this.fragmentTracker.getState(s);if(this.fragCurrent=s,c===I.FragmentState.BACKTRACKED){var S=this.fragmentTracker.getBacktrackData(s);if(S){this._handleFragmentLoadProgress(S),this._handleFragmentLoadComplete(S);return}else c=I.FragmentState.NOT_LOADED}c===I.FragmentState.NOT_LOADED||c===I.FragmentState.PARTIAL?s.sn==="initSegment"?this._loadInitSegment(s):this.bitrateTest?(s.bitrateTest=!0,this.log("Fragment "+s.sn+" of level "+s.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(s)):(this.startFragRequested=!0,a.prototype.loadFragment.call(this,s,n,i)):c===I.FragmentState.APPENDING?this.reduceMaxBufferLength(s.duration)&&this.fragmentTracker.removeFragment(s):((d=this.media)===null||d===void 0?void 0:d.buffered.length)===0&&this.fragmentTracker.removeAllFragments()},h.getAppendedFrag=function(s){var n=this.fragmentTracker.getAppendedFrag(s,A.PlaylistLevelType.MAIN);return n&&"fragment"in n?n.fragment:n},h.getBufferedFrag=function(s){return this.fragmentTracker.getBufferedFrag(s,A.PlaylistLevelType.MAIN)},h.followingBufferedFrag=function(s){return s?this.getBufferedFrag(s.end+.5):null},h.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},h.nextLevelSwitch=function(){var s=this.levels,n=this.media;if(n!=null&&n.readyState){var i,d=this.getAppendedFrag(n.currentTime);if(d&&d.start>1&&this.flushMainBuffer(0,d.start-1),!n.paused&&s){var c=this.hls.nextLoadLevel,S=s[c],R=this.fragLastKbps;R&&this.fragCurrent?i=this.fragCurrent.duration*S.maxBitrate/(1e3*R)+1:i=0}else i=0;var P=this.getBufferedFrag(n.currentTime+i);if(P){var B=this.followingBufferedFrag(P);if(B){this.abortCurrentFrag();var x=B.maxStartPTS?B.maxStartPTS:B.start,U=B.duration,k=Math.max(P.end,x+Math.min(Math.max(U-this.config.maxFragLookUpTolerance,U*.5),U*.75));this.flushMainBuffer(k,Number.POSITIVE_INFINITY)}}}},h.abortCurrentFrag=function(){var s=this.fragCurrent;this.fragCurrent=null,s!=null&&s.loader&&s.loader.abort(),this.state===O.State.KEY_LOADING&&(this.state=O.State.IDLE),this.nextLoadPosition=this.getLoadPosition()},h.flushMainBuffer=function(s,n){a.prototype.flushMainBuffer.call(this,s,n,this.altAudio?"video":null)},h.onMediaAttached=function(s,n){a.prototype.onMediaAttached.call(this,s,n);var i=n.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),i.addEventListener("playing",this.onvplaying),i.addEventListener("seeked",this.onvseeked),this.gapController=new p.default(this.config,i,this.fragmentTracker,this.hls)},h.onMediaDetaching=function(){var s=this.media;s&&(s.removeEventListener("playing",this.onvplaying),s.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),a.prototype.onMediaDetaching.call(this)},h.onMediaPlaying=function(){this.tick()},h.onMediaSeeked=function(){var s=this.media,n=s?s.currentTime:null;Object(M.isFiniteNumber)(n)&&this.log("Media seeked to "+n.toFixed(3)),this.tick()},h.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(b.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=this.stalled=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null},h.onManifestParsed=function(s,n){var i=!1,d=!1,c;n.levels.forEach(function(S){c=S.audioCodec,c&&(c.indexOf("mp4a.40.2")!==-1&&(i=!0),c.indexOf("mp4a.40.5")!==-1&&(d=!0))}),this.audioCodecSwitch=i&&d&&!Object(D.changeTypeSupported)(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=n.levels,this.startFragRequested=!1},h.onLevelLoading=function(s,n){var i=this.levels;if(!(!i||this.state!==O.State.IDLE)){var d=i[n.level];(!d.details||d.details.live&&this.levelLastLoaded!==n.level||this.waitForCdnTuneIn(d.details))&&(this.state=O.State.WAITING_LEVEL)}},h.onLevelLoaded=function(s,n){var i,d=this.levels,c=n.level,S=n.details,R=S.totalduration;if(!d){this.warn("Levels were reset while loading level "+c);return}this.log("Level "+c+" loaded ["+S.startSN+","+S.endSN+"], cc ["+S.startCC+", "+S.endCC+"] duration:"+R);var P=this.fragCurrent;P&&(this.state===O.State.FRAG_LOADING||this.state===O.State.FRAG_LOADING_WAITING_RETRY)&&P.level!==n.level&&P.loader&&(this.state=O.State.IDLE,P.loader.abort());var B=d[c],x=0;if(S.live||(i=B.details)!==null&&i!==void 0&&i.live){if(S.fragments[0]||(S.deltaUpdateFailed=!0),S.deltaUpdateFailed)return;x=this.alignPlaylists(S,B.details)}if(B.details=S,this.levelLastLoaded=c,this.hls.trigger(b.Events.LEVEL_UPDATED,{details:S,level:c}),this.state===O.State.WAITING_LEVEL){if(this.waitForCdnTuneIn(S))return;this.state=O.State.IDLE}this.startFragRequested?S.live&&this.synchronizeToLiveEdge(S):this.setStartPosition(S,x),this.tick()},h._handleFragmentLoadProgress=function(s){var n,i=s.frag,d=s.part,c=s.payload,S=this.levels;if(!S){this.warn("Levels were reset while fragment load was in progress. Fragment "+i.sn+" of level "+i.level+" will not be buffered");return}var R=S[i.level],P=R.details;if(!P){this.warn("Dropping fragment "+i.sn+" of level "+i.level+" after level details were reset");return}var B=R.videoCodec,x=P.PTSKnown||!P.live,U=(n=i.initSegment)===null||n===void 0?void 0:n.data,k=this._getAudioCodec(R),N=this.transmuxer=this.transmuxer||new y.default(this.hls,A.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),K=d?d.index:-1,W=K!==-1,w=new L.ChunkMetadata(i.level,i.sn,i.stats.chunkCount,c.byteLength,K,W),H=this.initPTS[i.cc];N.push(c,U,k,B,i,d,P.totalduration,x,w,H)},h.onAudioTrackSwitching=function(s,n){var i=this.altAudio,d=!!n.url,c=n.id;if(!d){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var S=this.fragCurrent;S!=null&&S.loader&&(this.log("Switching to main audio track, cancel main fragment load"),S.loader.abort()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var R=this.hls;i&&R.trigger(b.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),R.trigger(b.Events.AUDIO_TRACK_SWITCHED,{id:c})}},h.onAudioTrackSwitched=function(s,n){var i=n.id,d=!!this.hls.audioTracks[i].url;if(d){var c=this.videoBuffer;c&&this.mediaBuffer!==c&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=c)}this.altAudio=d,this.tick()},h.onBufferCreated=function(s,n){var i=n.tracks,d,c,S=!1;for(var R in i){var P=i[R];if(P.id==="main"){if(c=R,d=P,R==="video"){var B=i[R];B&&(this.videoBuffer=B.buffer)}}else S=!0}S&&d?(this.log("Alternate track found, use "+c+".buffered to schedule main fragment loading"),this.mediaBuffer=d.buffer):this.mediaBuffer=this.media},h.onFragBuffered=function(s,n){var i=n.frag,d=n.part;if(!(i&&i.type!==A.PlaylistLevelType.MAIN)){if(this.fragContextChanged(i)){this.warn("Fragment "+i.sn+(d?" p: "+d.index:"")+" of level "+i.level+" finished buffering, but was aborted. state: "+this.state),this.state===O.State.PARSED&&(this.state=O.State.IDLE);return}var c=d?d.stats:i.stats;this.fragLastKbps=Math.round(8*c.total/(c.buffering.end-c.loading.first)),i.sn!=="initSegment"&&(this.fragPrevious=i),this.fragBufferedComplete(i,d)}},h.onError=function(s,n){switch(n.details){case E.ErrorDetails.FRAG_LOAD_ERROR:case E.ErrorDetails.FRAG_LOAD_TIMEOUT:case E.ErrorDetails.KEY_LOAD_ERROR:case E.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(A.PlaylistLevelType.MAIN,n);break;case E.ErrorDetails.LEVEL_LOAD_ERROR:case E.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==O.State.ERROR&&(n.fatal?(this.warn(""+n.details),this.state=O.State.ERROR):!n.levelRetry&&this.state===O.State.WAITING_LEVEL&&(this.state=O.State.IDLE));break;case E.ErrorDetails.BUFFER_FULL_ERROR:if(n.parent==="main"&&(this.state===O.State.PARSING||this.state===O.State.PARSED)){var i=!0,d=this.getFwdBufferInfo(this.media,A.PlaylistLevelType.MAIN);d&&d.len>.5&&(i=!this.reduceMaxBufferLength(d.len)),i&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}break;default:break}},h.checkBuffer=function(){var s=this.media,n=this.gapController;if(!(!s||!n||!s.readyState)){var i=C.BufferHelper.getBuffered(s);!this.loadedmetadata&&i.length?(this.loadedmetadata=!0,this.seekToStartPos()):n.poll(this.lastCurrentTime),this.lastCurrentTime=s.currentTime}},h.onFragLoadEmergencyAborted=function(){this.state=O.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},h.onBufferFlushed=function(s,n){var i=n.type;if(i!==g.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){var d=(i===g.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(d,i,A.PlaylistLevelType.MAIN)}},h.onLevelsUpdated=function(s,n){this.levels=n.levels},h.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},h.seekToStartPos=function(){var s=this.media,n=s.currentTime,i=this.startPosition;if(i>=0&&n<i){if(s.seeking){m.logger.log("could not seek to "+i+", already seeking at "+n);return}var d=C.BufferHelper.getBuffered(s),c=d.length?d.start(0):0,S=c-i;S>0&&(S<this.config.maxBufferHole||S<this.config.maxFragLookUpTolerance)&&(m.logger.log("adjusting start position by "+S+" to match buffer start"),i+=S,this.startPosition=i),this.log("seek to target start position "+i+" from current time "+n),s.currentTime=i}},h._getAudioCodec=function(s){var n=this.config.defaultAudioCodec||s.audioCodec;return this.audioCodecSwap&&n&&(this.log("Swapping audio codec"),n.indexOf("mp4a.40.5")!==-1?n="mp4a.40.2":n="mp4a.40.5"),n},h._loadBitrateTestFrag=function(s){var n=this;this._doFragLoad(s).then(function(i){var d=n.hls;if(!(!i||d.nextLoadLevel||n.fragContextChanged(s))){n.fragLoadError=0,n.state=O.State.IDLE,n.startFragRequested=!1,n.bitrateTest=!1;var c=s.stats;c.parsing.start=c.parsing.end=c.buffering.start=c.buffering.end=self.performance.now(),d.trigger(b.Events.FRAG_LOADED,i)}})},h._handleTransmuxComplete=function(s){var n,i="main",d=this.hls,c=s.remuxResult,S=s.chunkMeta,R=this.getCurrentContext(S);if(!R){this.warn("The loading context changed while buffering fragment "+S.sn+" of level "+S.level+". This chunk will not be buffered."),this.resetLiveStartWhenNotLoaded(S.level);return}var P=R.frag,B=R.part,x=R.level,U=c.video,k=c.text,N=c.id3,K=c.initSegment,W=this.altAudio?void 0:c.audio;if(!this.fragContextChanged(P)){if(this.state=O.State.PARSING,K){K.tracks&&(this._bufferInitSegment(x,K.tracks,P,S),d.trigger(b.Events.FRAG_PARSING_INIT_SEGMENT,{frag:P,id:i,tracks:K.tracks}));var w=K.initPTS,H=K.timescale;Object(M.isFiniteNumber)(w)&&(this.initPTS[P.cc]=w,d.trigger(b.Events.INIT_PTS_FOUND,{frag:P,id:i,initPTS:w,timescale:H}))}if(U&&c.independent!==!1){if(x.details){var V=U.startPTS,j=U.endPTS,X=U.startDTS,Y=U.endDTS;if(B)B.elementaryStreams[U.type]={startPTS:V,endPTS:j,startDTS:X,endDTS:Y};else if(U.firstKeyFrame&&U.independent&&(this.couldBacktrack=!0),U.dropped&&U.independent){var $=this.getLoadPosition()+this.config.maxBufferHole;if($<V){this.backtrack(P);return}P.setElementaryStreamInfo(U.type,P.start,j,P.start,Y,!0)}P.setElementaryStreamInfo(U.type,V,j,X,Y),this.bufferFragmentData(U,P,B,S)}}else if(c.independent===!1){this.backtrack(P);return}if(W){var _=W.startPTS,z=W.endPTS,J=W.startDTS,Q=W.endDTS;B&&(B.elementaryStreams[g.ElementaryStreamTypes.AUDIO]={startPTS:_,endPTS:z,startDTS:J,endDTS:Q}),P.setElementaryStreamInfo(g.ElementaryStreamTypes.AUDIO,_,z,J,Q),this.bufferFragmentData(W,P,B,S)}if(N!=null&&(n=N.samples)!==null&&n!==void 0&&n.length){var et={frag:P,id:i,samples:N.samples};d.trigger(b.Events.FRAG_PARSING_METADATA,et)}if(k){var Z={frag:P,id:i,samples:k.samples};d.trigger(b.Events.FRAG_PARSING_USERDATA,Z)}}},h._bufferInitSegment=function(s,n,i,d){var c=this;if(this.state===O.State.PARSING){this.audioOnly=!!n.audio&&!n.video,this.altAudio&&!this.audioOnly&&delete n.audio;var S=n.audio,R=n.video,P=n.audiovideo;if(S){var B=s.audioCodec,x=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(B&&(B.indexOf("mp4a.40.5")!==-1?B="mp4a.40.2":B="mp4a.40.5"),S.metadata.channelCount!==1&&x.indexOf("firefox")===-1&&(B="mp4a.40.5")),x.indexOf("android")!==-1&&S.container!=="audio/mpeg"&&(B="mp4a.40.2",this.log("Android: force audio codec to "+B)),s.audioCodec&&s.audioCodec!==B&&this.log('Swapping manifest audio codec "'+s.audioCodec+'" for "'+B+'"'),S.levelCodec=B,S.id="main",this.log("Init audio buffer, container:"+S.container+", codecs[selected/level/parsed]=["+(B||"")+"/"+(s.audioCodec||"")+"/"+S.codec+"]")}R&&(R.levelCodec=s.videoCodec,R.id="main",this.log("Init video buffer, container:"+R.container+", codecs[level/parsed]=["+(s.videoCodec||"")+"/"+R.codec+"]")),P&&this.log("Init audiovideo buffer, container:"+P.container+", codecs[level/parsed]=["+(s.attrs.CODECS||"")+"/"+P.codec+"]"),this.hls.trigger(b.Events.BUFFER_CODECS,n),Object.keys(n).forEach(function(U){var k=n[U],N=k.initSegment;N!=null&&N.byteLength&&c.hls.trigger(b.Events.BUFFER_APPENDING,{type:U,data:N,frag:i,part:null,chunkMeta:d,parent:i.type})}),this.tick()}},h.backtrack=function(s){this.couldBacktrack=!0,this.resetTransmuxer(),this.flushBufferGap(s);var n=this.fragmentTracker.backtrack(s);this.fragPrevious=null,this.nextLoadPosition=s.start,n?this.resetFragmentLoading(s):this.state=O.State.BACKTRACKING},h.checkFragmentChanged=function(){var s=this.media,n=null;if(s&&s.readyState>1&&s.seeking===!1){var i=s.currentTime;if(C.BufferHelper.isBuffered(s,i)?n=this.getAppendedFrag(i):C.BufferHelper.isBuffered(s,i+.1)&&(n=this.getAppendedFrag(i+.1)),n){var d=this.fragPlaying,c=n.level;(!d||n.sn!==d.sn||d.level!==c||n.urlId!==d.urlId)&&(this.hls.trigger(b.Events.FRAG_CHANGED,{frag:n}),(!d||d.level!==c)&&this.hls.trigger(b.Events.LEVEL_SWITCHED,{level:c}),this.fragPlaying=n)}}},t(v,[{key:"nextLevel",get:function(){var s=this.nextBufferedFrag;return s?s.level:-1}},{key:"currentLevel",get:function(){var s=this.media;if(s){var n=this.getAppendedFrag(s.currentTime);if(n)return n.level}return-1}},{key:"nextBufferedFrag",get:function(){var s=this.media;if(s){var n=this.getAppendedFrag(s.currentTime);return this.followingBufferedFrag(n)}else return null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}]),v}(O.default)},"./src/controller/subtitle-stream-controller.ts":function(G,F,T){"use strict";T.r(F),T.d(F,"SubtitleStreamController",function(){return t});var M=T("./src/events.ts"),O=T("./src/utils/buffer-helper.ts"),D=T("./src/controller/fragment-finders.ts"),b=T("./src/utils/discontinuities.ts"),C=T("./src/controller/level-helper.ts"),I=T("./src/controller/fragment-tracker.ts"),A=T("./src/controller/base-stream-controller.ts"),g=T("./src/types/loader.ts"),y=T("./src/types/level.ts");function L(r,e){for(var f=0;f<e.length;f++){var o=e[f];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(r,o.key,o)}}function p(r,e,f){return e&&L(r.prototype,e),f&&L(r,f),r}function E(r,e){r.prototype=Object.create(e.prototype),r.prototype.constructor=r,m(r,e)}function m(r,e){return m=Object.setPrototypeOf||function(o,a){return o.__proto__=a,o},m(r,e)}var u=500,t=function(r){E(e,r);function e(o,a){var v;return v=r.call(this,o,a,"[subtitle-stream-controller]")||this,v.levels=[],v.currentTrackId=-1,v.tracksBuffered=[],v.mainDetails=null,v._registerListeners(),v}var f=e.prototype;return f.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},f._registerListeners=function(){var a=this.hls;a.on(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),a.on(M.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.on(M.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.on(M.Events.LEVEL_LOADED,this.onLevelLoaded,this),a.on(M.Events.ERROR,this.onError,this),a.on(M.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),a.on(M.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),a.on(M.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),a.on(M.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),a.on(M.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},f._unregisterListeners=function(){var a=this.hls;a.off(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),a.off(M.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.off(M.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.off(M.Events.LEVEL_LOADED,this.onLevelLoaded,this),a.off(M.Events.ERROR,this.onError,this),a.off(M.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),a.off(M.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),a.off(M.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),a.off(M.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),a.off(M.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},f.startLoad=function(){this.stopLoad(),this.state=A.State.IDLE,this.setInterval(u),this.tick()},f.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},f.onLevelLoaded=function(a,v){this.mainDetails=v.details},f.onSubtitleFragProcessed=function(a,v){var h=v.frag,l=v.success;if(this.fragPrevious=h,this.state=A.State.IDLE,!!l){var s=this.tracksBuffered[this.currentTrackId];if(!!s){for(var n,i=h.start,d=0;d<s.length;d++)if(i>=s[d].start&&i<=s[d].end){n=s[d];break}var c=h.start+h.duration;n?n.end=c:(n={start:i,end:c},s.push(n)),this.fragmentTracker.fragBuffered(h)}}},f.onBufferFlushing=function(a,v){var h=v.startOffset,l=v.endOffset;if(h===0&&l!==Number.POSITIVE_INFINITY){var s=this.currentTrackId,n=this.levels;if(!n.length||!n[s]||!n[s].details)return;var i=n[s].details,d=i.targetduration,c=l-d;if(c<=0)return;v.endOffsetSubtitles=Math.max(0,c),this.tracksBuffered.forEach(function(S){for(var R=0;R<S.length;){if(S[R].end<=c){S.shift();continue}else if(S[R].start<c)S[R].start=c;else break;R++}}),this.fragmentTracker.removeFragmentsInRange(h,c,g.PlaylistLevelType.SUBTITLE)}},f.onError=function(a,v){var h,l=v.frag;!l||l.type!==g.PlaylistLevelType.SUBTITLE||((h=this.fragCurrent)!==null&&h!==void 0&&h.loader&&this.fragCurrent.loader.abort(),this.state=A.State.IDLE)},f.onSubtitleTracksUpdated=function(a,v){var h=this,l=v.subtitleTracks;this.tracksBuffered=[],this.levels=l.map(function(s){return new y.Level(s)}),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach(function(s){h.tracksBuffered[s.id]=[]}),this.mediaBuffer=null},f.onSubtitleTrackSwitch=function(a,v){if(this.currentTrackId=v.id,!this.levels.length||this.currentTrackId===-1){this.clearInterval();return}var h=this.levels[this.currentTrackId];h!=null&&h.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,h&&this.setInterval(u)},f.onSubtitleTrackLoaded=function(a,v){var h,l=v.details,s=v.id,n=this.currentTrackId,i=this.levels;if(!!i.length){var d=i[n];if(!(s>=i.length||s!==n||!d)){if(this.mediaBuffer=this.mediaBufferTimeRanges,l.live||(h=d.details)!==null&&h!==void 0&&h.live){var c=this.mainDetails;if(l.deltaUpdateFailed||!c)return;var S=c.fragments[0];if(!d.details)l.hasProgramDateTime&&c.hasProgramDateTime?Object(b.alignMediaPlaylistByPDT)(l,c):S&&Object(C.addSliding)(l,S.start);else{var R=this.alignPlaylists(l,d.details);R===0&&S&&Object(C.addSliding)(l,S.start)}}if(d.details=l,this.levelLastLoaded=s,this.tick(),l.live&&!this.fragCurrent&&this.media&&this.state===A.State.IDLE){var P=Object(D.findFragmentByPTS)(null,l.fragments,this.media.currentTime,0);P||(this.warn("Subtitle playlist not aligned with playback"),d.details=void 0)}}}},f._handleFragmentLoadComplete=function(a){var v=a.frag,h=a.payload,l=v.decryptdata,s=this.hls;if(!this.fragContextChanged(v)&&h&&h.byteLength>0&&l&&l.key&&l.iv&&l.method==="AES-128"){var n=performance.now();this.decrypter.webCryptoDecrypt(new Uint8Array(h),l.key.buffer,l.iv.buffer).then(function(i){var d=performance.now();s.trigger(M.Events.FRAG_DECRYPTED,{frag:v,payload:i,stats:{tstart:n,tdecrypt:d}})})}},f.doTick=function(){if(!this.media){this.state=A.State.IDLE;return}if(this.state===A.State.IDLE){var a,v=this.currentTrackId,h=this.levels;if(!h.length||!h[v]||!h[v].details)return;var l=h[v].details,s=l.targetduration,n=this.config,i=this.media,d=O.BufferHelper.bufferedInfo(this.mediaBufferTimeRanges,i.currentTime-s,n.maxBufferHole),c=d.end,S=d.len,R=this.getMaxBufferLength()+s;if(S>R)return;console.assert(l,"Subtitle track details are defined on idle subtitle stream controller tick");var P=l.fragments,B=P.length,x=l.edge,U,k=this.fragPrevious;if(c<x){var N=n.maxFragLookUpTolerance;U=Object(D.findFragmentByPTS)(k,P,c,N),!U&&k&&k.start<P[0].start&&(U=P[0])}else U=P[B-1];(a=U)!==null&&a!==void 0&&a.encrypted?this.loadKey(U,l):U&&this.fragmentTracker.getState(U)===I.FragmentState.NOT_LOADED&&this.loadFragment(U,l,c)}},f.loadFragment=function(a,v,h){this.fragCurrent=a,r.prototype.loadFragment.call(this,a,v,h)},p(e,[{key:"mediaBufferTimeRanges",get:function(){return this.tracksBuffered[this.currentTrackId]||[]}}]),e}(A.default)},"./src/controller/subtitle-track-controller.ts":function(G,F,T){"use strict";T.r(F);var M=T("./src/events.ts"),O=T("./src/utils/texttrack-utils.ts"),D=T("./src/controller/base-playlist-controller.ts"),b=T("./src/types/loader.ts");function C(p,E){for(var m=0;m<E.length;m++){var u=E[m];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(p,u.key,u)}}function I(p,E,m){return E&&C(p.prototype,E),m&&C(p,m),p}function A(p,E){p.prototype=Object.create(E.prototype),p.prototype.constructor=p,g(p,E)}function g(p,E){return g=Object.setPrototypeOf||function(u,t){return u.__proto__=t,u},g(p,E)}var y=function(p){A(E,p);function E(u){var t;return t=p.call(this,u,"[subtitle-track-controller]")||this,t.media=null,t.tracks=[],t.groupId=null,t.tracksInGroup=[],t.trackId=-1,t.selectDefaultTrack=!0,t.queuedDefaultTrack=-1,t.trackChangeListener=function(){return t.onTextTracksChanged()},t.asyncPollTrackChange=function(){return t.pollTrackChange(0)},t.useTextTrackPolling=!1,t.subtitlePollingInterval=-1,t.subtitleDisplay=!0,t.registerListeners(),t}var m=E.prototype;return m.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,p.prototype.destroy.call(this)},m.registerListeners=function(){var t=this.hls;t.on(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(M.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(M.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(M.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.on(M.Events.LEVEL_LOADING,this.onLevelLoading,this),t.on(M.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(M.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.on(M.Events.ERROR,this.onError,this)},m.unregisterListeners=function(){var t=this.hls;t.off(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(M.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(M.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(M.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.off(M.Events.LEVEL_LOADING,this.onLevelLoading,this),t.off(M.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(M.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.off(M.Events.ERROR,this.onError,this)},m.onMediaAttached=function(t,r){this.media=r.media,!!this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},m.pollTrackChange=function(t){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,t)},m.onMediaDetaching=function(){if(!!this.media){self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId);var t=L(this.media.textTracks);t.forEach(function(r){Object(O.clearCurrentCues)(r)}),this.subtitleTrack=-1,this.media=null}},m.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},m.onManifestParsed=function(t,r){this.tracks=r.subtitleTracks},m.onSubtitleTrackLoaded=function(t,r){var e=r.id,f=r.details,o=this.trackId,a=this.tracksInGroup[o];if(!a){this.warn("Invalid subtitle track id "+e);return}var v=a.details;a.details=r.details,this.log("subtitle track "+e+" loaded ["+f.startSN+"-"+f.endSN+"]"),e===this.trackId&&(this.retryCount=0,this.playlistLoaded(e,r,v))},m.onLevelLoading=function(t,r){this.switchLevel(r.level)},m.onLevelSwitching=function(t,r){this.switchLevel(r.level)},m.switchLevel=function(t){var r=this.hls.levels[t];if(!!(r!=null&&r.textGroupIds)){var e=r.textGroupIds[r.urlId];if(this.groupId!==e){var f=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,o=this.tracks.filter(function(h){return!e||h.groupId===e});this.tracksInGroup=o;var a=this.findTrackId(f==null?void 0:f.name)||this.findTrackId();this.groupId=e;var v={subtitleTracks:o};this.log("Updating subtitle tracks, "+o.length+' track(s) found in "'+e+'" group-id'),this.hls.trigger(M.Events.SUBTITLE_TRACKS_UPDATED,v),a!==-1&&this.setSubtitleTrack(a,f)}}},m.findTrackId=function(t){for(var r=this.tracksInGroup,e=0;e<r.length;e++){var f=r[e];if((!this.selectDefaultTrack||f.default)&&(!t||t===f.name))return f.id}return-1},m.onError=function(t,r){p.prototype.onError.call(this,t,r),!(r.fatal||!r.context)&&r.context.type===b.PlaylistContextType.SUBTITLE_TRACK&&r.context.id===this.trackId&&r.context.groupId===this.groupId&&this.retryLoadingOrFail(r)},m.loadPlaylist=function(t){var r=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(r)){var e=r.id,f=r.groupId,o=r.url;if(t)try{o=t.addDirectives(o)}catch(a){this.warn("Could not construct new URL with HLS Delivery Directives: "+a)}this.log("Loading subtitle playlist for id "+e),this.hls.trigger(M.Events.SUBTITLE_TRACK_LOADING,{url:o,id:e,groupId:f,deliveryDirectives:t||null})}},m.toggleTrackModes=function(t){var r=this,e=this.media,f=this.subtitleDisplay,o=this.trackId;if(!!e){var a=L(e.textTracks),v=a.filter(function(s){return s.groupId===r.groupId});if(t===-1)[].slice.call(a).forEach(function(s){s.mode="disabled"});else{var h=v[o];h&&(h.mode="disabled")}var l=v[t];l&&(l.mode=f?"showing":"hidden")}},m.setSubtitleTrack=function(t,r){var e,f=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=t;return}if(this.trackId!==t&&this.toggleTrackModes(t),!(this.trackId===t&&(t===-1||(e=f[t])!==null&&e!==void 0&&e.details)||t<-1||t>=f.length)){this.clearTimer();var o=f[t];if(this.log("Switching to subtitle track "+t),this.trackId=t,o){var a=o.id,v=o.groupId,h=v===void 0?"":v,l=o.name,s=o.type,n=o.url;this.hls.trigger(M.Events.SUBTITLE_TRACK_SWITCH,{id:a,groupId:h,name:l,type:s,url:n});var i=this.switchParams(o.url,r==null?void 0:r.details);this.loadPlaylist(i)}else this.hls.trigger(M.Events.SUBTITLE_TRACK_SWITCH,{id:t})}},m.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!(!this.media||!this.hls.config.renderTextTracksNatively)){for(var t=-1,r=L(this.media.textTracks),e=0;e<r.length;e++)if(r[e].mode==="hidden")t=e;else if(r[e].mode==="showing"){t=e;break}this.subtitleTrack!==t&&(this.subtitleTrack=t)}},I(E,[{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(t){this.selectDefaultTrack=!1;var r=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(t,r)}}]),E}(D.default);function L(p){for(var E=[],m=0;m<p.length;m++){var u=p[m];u.kind==="subtitles"&&u.label&&E.push(p[m])}return E}F.default=y},"./src/controller/timeline-controller.ts":function(G,F,T){"use strict";T.r(F),T.d(F,"TimelineController",function(){return L});var M=T("./src/polyfills/number.ts"),O=T("./src/events.ts"),D=T("./src/utils/cea-608-parser.ts"),b=T("./src/utils/output-filter.ts"),C=T("./src/utils/webvtt-parser.ts"),I=T("./src/utils/texttrack-utils.ts"),A=T("./src/utils/imsc1-ttml-parser.ts"),g=T("./src/types/loader.ts"),y=T("./src/utils/logger.ts"),L=function(){function u(r){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=m(),this.captionsProperties=void 0,this.hls=r,this.config=r.config,this.Cues=r.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var e=new b.default(this,"textTrack1"),f=new b.default(this,"textTrack2"),o=new b.default(this,"textTrack3"),a=new b.default(this,"textTrack4");this.cea608Parser1=new D.default(1,e,f),this.cea608Parser2=new D.default(3,o,a)}r.on(O.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),r.on(O.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(O.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.on(O.Events.MANIFEST_LOADED,this.onManifestLoaded,this),r.on(O.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),r.on(O.Events.FRAG_LOADING,this.onFragLoading,this),r.on(O.Events.FRAG_LOADED,this.onFragLoaded,this),r.on(O.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),r.on(O.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),r.on(O.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),r.on(O.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),r.on(O.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}var t=u.prototype;return t.destroy=function(){var e=this.hls;e.off(O.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(O.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(O.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(O.Events.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(O.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(O.Events.FRAG_LOADING,this.onFragLoading,this),e.off(O.Events.FRAG_LOADED,this.onFragLoaded,this),e.off(O.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(O.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(O.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(O.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(O.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},t.addCues=function(e,f,o,a,v){for(var h=!1,l=v.length;l--;){var s=v[l],n=E(s[0],s[1],f,o);if(n>=0&&(s[0]=Math.min(s[0],f),s[1]=Math.max(s[1],o),h=!0,n/(o-f)>.5))return}if(h||v.push([f,o]),this.config.renderTextTracksNatively){var i=this.captionsTracks[e];this.Cues.newCue(i,f,o,a)}else{var d=this.Cues.newCue(null,f,o,a);this.hls.trigger(O.Events.CUES_PARSED,{type:"captions",cues:d,track:e})}},t.onInitPtsFound=function(e,f){var o=this,a=f.frag,v=f.id,h=f.initPTS,l=f.timescale,s=this.unparsedVttFrags;v==="main"&&(this.initPTS[a.cc]=h,this.timescale[a.cc]=l),s.length&&(this.unparsedVttFrags=[],s.forEach(function(n){o.onFragLoaded(O.Events.FRAG_LOADED,n)}))},t.getExistingTrack=function(e){var f=this.media;if(f)for(var o=0;o<f.textTracks.length;o++){var a=f.textTracks[o];if(a[e])return a}return null},t.createCaptionsTrack=function(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)},t.createNativeTrack=function(e){if(!this.captionsTracks[e]){var f=this.captionsProperties,o=this.captionsTracks,a=this.media,v=f[e],h=v.label,l=v.languageCode,s=this.getExistingTrack(e);if(s)o[e]=s,Object(I.clearCurrentCues)(o[e]),Object(I.sendAddTrackEvent)(o[e],a);else{var n=this.createTextTrack("captions",h,l);n&&(n[e]=!0,o[e]=n)}}},t.createNonNativeTrack=function(e){if(!this.nonNativeCaptionsTracks[e]){var f=this.captionsProperties[e];if(!!f){var o=f.label,a={_id:e,label:o,kind:"captions",default:f.media?!!f.media.default:!1,closedCaptions:f.media};this.nonNativeCaptionsTracks[e]=a,this.hls.trigger(O.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[a]})}}},t.createTextTrack=function(e,f,o){var a=this.media;if(!!a)return a.addTextTrack(e,f,o)},t.onMediaAttaching=function(e,f){this.media=f.media,this._cleanTracks()},t.onMediaDetaching=function(){var e=this.captionsTracks;Object.keys(e).forEach(function(f){Object(I.clearCurrentCues)(e[f]),delete e[f]}),this.nonNativeCaptionsTracks={}},t.onManifestLoading=function(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=m(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},t._cleanTracks=function(){var e=this.media;if(!!e){var f=e.textTracks;if(f)for(var o=0;o<f.length;o++)Object(I.clearCurrentCues)(f[o])}},t.onSubtitleTracksUpdated=function(e,f){var o=this;this.textTracks=[];var a=f.subtitleTracks||[],v=a.some(function(n){return n.textCodec===A.IMSC1_CODEC});if(this.config.enableWebVTT||v&&this.config.enableIMSC1){var h=this.tracks&&a&&this.tracks.length===a.length;if(this.tracks=a||[],this.config.renderTextTracksNatively){var l=this.media?this.media.textTracks:[];this.tracks.forEach(function(n,i){var d;if(i<l.length){for(var c=null,S=0;S<l.length;S++)if(p(l[S],n)){c=l[S];break}c&&(d=c)}d?Object(I.clearCurrentCues)(d):(d=o.createTextTrack("subtitles",n.name,n.lang),d&&(d.mode="disabled")),d&&(d.groupId=n.groupId,o.textTracks.push(d))})}else if(!h&&this.tracks&&this.tracks.length){var s=this.tracks.map(function(n){return{label:n.name,kind:n.type.toLowerCase(),default:n.default,subtitleTrack:n}});this.hls.trigger(O.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:s})}}},t.onManifestLoaded=function(e,f){var o=this;this.config.enableCEA708Captions&&f.captions&&f.captions.forEach(function(a){var v=/(?:CC|SERVICE)([1-4])/.exec(a.instreamId);if(!!v){var h="textTrack"+v[1],l=o.captionsProperties[h];!l||(l.label=a.name,a.lang&&(l.languageCode=a.lang),l.media=a)}})},t.onFragLoading=function(e,f){var o=this.cea608Parser1,a=this.cea608Parser2,v=this.lastSn,h=this.lastPartIndex;if(!(!this.enabled||!(o&&a))&&f.frag.type===g.PlaylistLevelType.MAIN){var l,s,n=f.frag.sn,i=(l=f==null||(s=f.part)===null||s===void 0?void 0:s.index)!=null?l:-1;n===v+1||n===v&&i===h+1||(o.reset(),a.reset()),this.lastSn=n,this.lastPartIndex=i}},t.onFragLoaded=function(e,f){var o=f.frag,a=f.payload,v=this.initPTS,h=this.unparsedVttFrags;if(o.type===g.PlaylistLevelType.SUBTITLE)if(a.byteLength){if(!Object(M.isFiniteNumber)(v[o.cc])){h.push(f),v.length&&this.hls.trigger(O.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:o,error:new Error("Missing initial subtitle PTS")});return}var l=o.decryptdata,s="stats"in f;if(l==null||l.key==null||l.method!=="AES-128"||s){var n=this.tracks[o.level],i=this.vttCCs;i[o.cc]||(i[o.cc]={start:o.start,prevCC:this.prevCC,new:!0},this.prevCC=o.cc),n&&n.textCodec===A.IMSC1_CODEC?this._parseIMSC1(o,a):this._parseVTTs(o,a,i)}}else this.hls.trigger(O.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:o,error:new Error("Empty subtitle payload")})},t._parseIMSC1=function(e,f){var o=this,a=this.hls;Object(A.parseIMSC1)(f,this.initPTS[e.cc],this.timescale[e.cc],function(v){o._appendCues(v,e.level),a.trigger(O.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},function(v){y.logger.log("Failed to parse IMSC1: "+v),a.trigger(O.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:v})})},t._parseVTTs=function(e,f,o){var a=this,v=this.hls;Object(C.parseWebVTT)(f,this.initPTS[e.cc],this.timescale[e.cc],o,e.cc,e.start,function(h){a._appendCues(h,e.level),v.trigger(O.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},function(h){a._fallbackToIMSC1(e,f),y.logger.log("Failed to parse VTT cue: "+h),v.trigger(O.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:h})})},t._fallbackToIMSC1=function(e,f){var o=this,a=this.tracks[e.level];a.textCodec||Object(A.parseIMSC1)(f,this.initPTS[e.cc],this.timescale[e.cc],function(){a.textCodec=A.IMSC1_CODEC,o._parseIMSC1(e,f)},function(){a.textCodec="wvtt"})},t._appendCues=function(e,f){var o=this.hls;if(this.config.renderTextTracksNatively){var a=this.textTracks[f];if(a.mode==="disabled")return;e.forEach(function(l){return Object(I.addCueToTrack)(a,l)})}else{var v=this.tracks[f],h=v.default?"default":"subtitles"+f;o.trigger(O.Events.CUES_PARSED,{type:"subtitles",cues:e,track:h})}},t.onFragDecrypted=function(e,f){var o=f.frag;if(o.type===g.PlaylistLevelType.SUBTITLE){if(!Object(M.isFiniteNumber)(this.initPTS[o.cc])){this.unparsedVttFrags.push(f);return}this.onFragLoaded(O.Events.FRAG_LOADED,f)}},t.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},t.onFragParsingUserdata=function(e,f){var o=this.cea608Parser1,a=this.cea608Parser2;if(!(!this.enabled||!(o&&a)))for(var v=0;v<f.samples.length;v++){var h=f.samples[v].bytes;if(h){var l=this.extractCea608Data(h);o.addData(f.samples[v].pts,l[0]),a.addData(f.samples[v].pts,l[1])}}},t.onBufferFlushing=function(e,f){var o=f.startOffset,a=f.endOffset,v=f.endOffsetSubtitles,h=f.type,l=this.media;if(!(!l||l.currentTime<a)){if(!h||h==="video"){var s=this.captionsTracks;Object.keys(s).forEach(function(i){return Object(I.removeCuesInRange)(s[i],o,a)})}if(this.config.renderTextTracksNatively&&o===0&&v!==void 0){var n=this.textTracks;Object.keys(n).forEach(function(i){return Object(I.removeCuesInRange)(n[i],o,v)})}}},t.extractCea608Data=function(e){for(var f=e[0]&31,o=2,a=[[],[]],v=0;v<f;v++){var h=e[o++],l=127&e[o++],s=127&e[o++],n=(4&h)!==0,i=3&h;l===0&&s===0||n&&(i===0||i===1)&&(a[i].push(l),a[i].push(s))}return a},u}();function p(u,t){return u&&u.label===t.name&&!(u.textTrack1||u.textTrack2)}function E(u,t,r,e){return Math.min(t,e)-Math.max(u,r)}function m(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}}}},"./src/crypt/aes-crypto.ts":function(G,F,T){"use strict";T.r(F),T.d(F,"default",function(){return M});var M=function(){function O(b,C){this.subtle=void 0,this.aesIV=void 0,this.subtle=b,this.aesIV=C}var D=O.prototype;return D.decrypt=function(C,I){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},I,C)},O}()},"./src/crypt/aes-decryptor.ts":function(G,F,T){"use strict";T.r(F),T.d(F,"removePadding",function(){return O}),T.d(F,"default",function(){return D});var M=T("./src/utils/typed-array.ts");function O(b){var C=b.byteLength,I=C&&new DataView(b.buffer).getUint8(C-1);return I?Object(M.sliceUint8)(b,0,C-I):b}var D=function(){function b(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var C=b.prototype;return C.uint8ArrayToUint32Array_=function(A){for(var g=new DataView(A),y=new Uint32Array(4),L=0;L<4;L++)y[L]=g.getUint32(L*4);return y},C.initTable=function(){var A=this.sBox,g=this.invSBox,y=this.subMix,L=y[0],p=y[1],E=y[2],m=y[3],u=this.invSubMix,t=u[0],r=u[1],e=u[2],f=u[3],o=new Uint32Array(256),a=0,v=0,h=0;for(h=0;h<256;h++)h<128?o[h]=h<<1:o[h]=h<<1^283;for(h=0;h<256;h++){var l=v^v<<1^v<<2^v<<3^v<<4;l=l>>>8^l&255^99,A[a]=l,g[l]=a;var s=o[a],n=o[s],i=o[n],d=o[l]*257^l*16843008;L[a]=d<<24|d>>>8,p[a]=d<<16|d>>>16,E[a]=d<<8|d>>>24,m[a]=d,d=i*16843009^n*65537^s*257^a*16843008,t[l]=d<<24|d>>>8,r[l]=d<<16|d>>>16,e[l]=d<<8|d>>>24,f[l]=d,a?(a=s^o[o[o[i^s]]],v^=o[o[v]]):a=v=1}},C.expandKey=function(A){for(var g=this.uint8ArrayToUint32Array_(A),y=!0,L=0;L<g.length&&y;)y=g[L]===this.key[L],L++;if(!y){this.key=g;var p=this.keySize=g.length;if(p!==4&&p!==6&&p!==8)throw new Error("Invalid aes key size="+p);var E=this.ksRows=(p+6+1)*4,m,u,t=this.keySchedule=new Uint32Array(E),r=this.invKeySchedule=new Uint32Array(E),e=this.sBox,f=this.rcon,o=this.invSubMix,a=o[0],v=o[1],h=o[2],l=o[3],s,n;for(m=0;m<E;m++){if(m<p){s=t[m]=g[m];continue}n=s,m%p===0?(n=n<<8|n>>>24,n=e[n>>>24]<<24|e[n>>>16&255]<<16|e[n>>>8&255]<<8|e[n&255],n^=f[m/p|0]<<24):p>6&&m%p===4&&(n=e[n>>>24]<<24|e[n>>>16&255]<<16|e[n>>>8&255]<<8|e[n&255]),t[m]=s=(t[m-p]^n)>>>0}for(u=0;u<E;u++)m=E-u,u&3?n=t[m]:n=t[m-4],u<4||m<=4?r[u]=n:r[u]=a[e[n>>>24]]^v[e[n>>>16&255]]^h[e[n>>>8&255]]^l[e[n&255]],r[u]=r[u]>>>0}},C.networkToHostOrderSwap=function(A){return A<<24|(A&65280)<<8|(A&16711680)>>8|A>>>24},C.decrypt=function(A,g,y){for(var L=this.keySize+6,p=this.invKeySchedule,E=this.invSBox,m=this.invSubMix,u=m[0],t=m[1],r=m[2],e=m[3],f=this.uint8ArrayToUint32Array_(y),o=f[0],a=f[1],v=f[2],h=f[3],l=new Int32Array(A),s=new Int32Array(l.length),n,i,d,c,S,R,P,B,x,U,k,N,K,W,w=this.networkToHostOrderSwap;g<l.length;){for(x=w(l[g]),U=w(l[g+1]),k=w(l[g+2]),N=w(l[g+3]),S=x^p[0],R=N^p[1],P=k^p[2],B=U^p[3],K=4,W=1;W<L;W++)n=u[S>>>24]^t[R>>16&255]^r[P>>8&255]^e[B&255]^p[K],i=u[R>>>24]^t[P>>16&255]^r[B>>8&255]^e[S&255]^p[K+1],d=u[P>>>24]^t[B>>16&255]^r[S>>8&255]^e[R&255]^p[K+2],c=u[B>>>24]^t[S>>16&255]^r[R>>8&255]^e[P&255]^p[K+3],S=n,R=i,P=d,B=c,K=K+4;n=E[S>>>24]<<24^E[R>>16&255]<<16^E[P>>8&255]<<8^E[B&255]^p[K],i=E[R>>>24]<<24^E[P>>16&255]<<16^E[B>>8&255]<<8^E[S&255]^p[K+1],d=E[P>>>24]<<24^E[B>>16&255]<<16^E[S>>8&255]<<8^E[R&255]^p[K+2],c=E[B>>>24]<<24^E[S>>16&255]<<16^E[R>>8&255]<<8^E[P&255]^p[K+3],s[g]=w(n^o),s[g+1]=w(c^a),s[g+2]=w(d^v),s[g+3]=w(i^h),o=x,a=U,v=k,h=N,g=g+4}return s.buffer},b}()},"./src/crypt/decrypter.ts":function(G,F,T){"use strict";T.r(F),T.d(F,"default",function(){return g});var M=T("./src/crypt/aes-crypto.ts"),O=T("./src/crypt/fast-aes-key.ts"),D=T("./src/crypt/aes-decryptor.ts"),b=T("./src/utils/logger.ts"),C=T("./src/utils/mp4-tools.ts"),I=T("./src/utils/typed-array.ts"),A=16,g=function(){function y(p,E,m){var u=m===void 0?{}:m,t=u.removePKCS7Padding,r=t===void 0?!0:t;if(this.logEnabled=!0,this.observer=void 0,this.config=void 0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.observer=p,this.config=E,this.removePKCS7Padding=r,r)try{var e=self.crypto;e&&(this.subtle=e.subtle||e.webkitSubtle)}catch{}this.subtle===null&&(this.config.enableSoftwareAES=!0)}var L=y.prototype;return L.destroy=function(){this.observer=null},L.isSync=function(){return this.config.enableSoftwareAES},L.flush=function(){var E=this.currentResult;if(!E){this.reset();return}var m=new Uint8Array(E);return this.reset(),this.removePKCS7Padding?Object(D.removePadding)(m):m},L.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},L.decrypt=function(E,m,u,t){if(this.config.enableSoftwareAES){this.softwareDecrypt(new Uint8Array(E),m,u);var r=this.flush();r&&t(r.buffer)}else this.webCryptoDecrypt(new Uint8Array(E),m,u).then(t)},L.softwareDecrypt=function(E,m,u){var t=this.currentIV,r=this.currentResult,e=this.remainderData;this.logOnce("JS AES decrypt"),e&&(E=Object(C.appendUint8Array)(e,E),this.remainderData=null);var f=this.getValidChunk(E);if(!f.length)return null;t&&(u=t);var o=this.softwareDecrypter;o||(o=this.softwareDecrypter=new D.default),o.expandKey(m);var a=r;return this.currentResult=o.decrypt(f.buffer,0,u),this.currentIV=Object(I.sliceUint8)(f,-16).buffer,a||null},L.webCryptoDecrypt=function(E,m,u){var t=this,r=this.subtle;return(this.key!==m||!this.fastAesKey)&&(this.key=m,this.fastAesKey=new O.default(r,m)),this.fastAesKey.expandKey().then(function(e){if(!r)return Promise.reject(new Error("web crypto not initialized"));var f=new M.default(r,u);return f.decrypt(E.buffer,e)}).catch(function(e){return t.onWebCryptoError(e,E,m,u)})},L.onWebCryptoError=function(E,m,u,t){return b.logger.warn("[decrypter.ts]: WebCrypto Error, disable WebCrypto API:",E),this.config.enableSoftwareAES=!0,this.logEnabled=!0,this.softwareDecrypt(m,u,t)},L.getValidChunk=function(E){var m=E,u=E.length-E.length%A;return u!==E.length&&(m=Object(I.sliceUint8)(E,0,u),this.remainderData=Object(I.sliceUint8)(E,u)),m},L.logOnce=function(E){!this.logEnabled||(b.logger.log("[decrypter.ts]: "+E),this.logEnabled=!1)},y}()},"./src/crypt/fast-aes-key.ts":function(G,F,T){"use strict";T.r(F),T.d(F,"default",function(){return M});var M=function(){function O(b,C){this.subtle=void 0,this.key=void 0,this.subtle=b,this.key=C}var D=O.prototype;return D.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},O}()},"./src/demux/aacdemuxer.ts":function(G,F,T){"use strict";T.r(F);var M=T("./src/demux/base-audio-demuxer.ts"),O=T("./src/demux/adts.ts"),D=T("./src/utils/logger.ts"),b=T("./src/demux/id3.ts");function C(g,y){g.prototype=Object.create(y.prototype),g.prototype.constructor=g,I(g,y)}function I(g,y){return I=Object.setPrototypeOf||function(p,E){return p.__proto__=E,p},I(g,y)}var A=function(g){C(y,g);function y(p,E){var m;return m=g.call(this)||this,m.observer=void 0,m.config=void 0,m.observer=p,m.config=E,m}var L=y.prototype;return L.resetInitSegment=function(E,m,u){g.prototype.resetInitSegment.call(this,E,m,u),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,isAAC:!0,samples:[],manifestCodec:E,duration:u,inputTimeScale:9e4,dropped:0}},y.probe=function(E){if(!E)return!1;for(var m=b.getID3Data(E,0)||[],u=m.length,t=E.length;u<t;u++)if(O.probe(E,u))return D.logger.log("ADTS sync word found !"),!0;return!1},L.canParse=function(E,m){return O.canParse(E,m)},L.appendFrame=function(E,m,u){O.initTrackConfig(E,this.observer,m,u,E.manifestCodec);var t=O.appendFrame(E,m,u,this.initPTS,this.frameIndex);if(t&&t.missing===0)return t},y}(M.default);A.minProbeByteLength=9,F.default=A},"./src/demux/adts.ts":function(G,F,T){"use strict";T.r(F),T.d(F,"getAudioConfig",function(){return b}),T.d(F,"isHeaderPattern",function(){return C}),T.d(F,"getHeaderLength",function(){return I}),T.d(F,"getFullFrameLength",function(){return A}),T.d(F,"canGetFrameLength",function(){return g}),T.d(F,"isHeader",function(){return y}),T.d(F,"canParse",function(){return L}),T.d(F,"probe",function(){return p}),T.d(F,"initTrackConfig",function(){return E}),T.d(F,"getFrameDuration",function(){return m}),T.d(F,"parseFrameHeader",function(){return u}),T.d(F,"appendFrame",function(){return t});var M=T("./src/utils/logger.ts"),O=T("./src/errors.ts"),D=T("./src/events.ts");function b(r,e,f,o){var a,v,h,l,s=navigator.userAgent.toLowerCase(),n=o,i=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];a=((e[f+2]&192)>>>6)+1;var d=(e[f+2]&60)>>>2;if(d>i.length-1){r.trigger(D.Events.ERROR,{type:O.ErrorTypes.MEDIA_ERROR,details:O.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+d});return}return h=(e[f+2]&1)<<2,h|=(e[f+3]&192)>>>6,M.logger.log("manifest codec:"+o+", ADTS type:"+a+", samplingIndex:"+d),/firefox/i.test(s)?d>=6?(a=5,l=new Array(4),v=d-3):(a=2,l=new Array(2),v=d):s.indexOf("android")!==-1?(a=2,l=new Array(2),v=d):(a=5,l=new Array(4),o&&(o.indexOf("mp4a.40.29")!==-1||o.indexOf("mp4a.40.5")!==-1)||!o&&d>=6?v=d-3:((o&&o.indexOf("mp4a.40.2")!==-1&&(d>=6&&h===1||/vivaldi/i.test(s))||!o&&h===1)&&(a=2,l=new Array(2)),v=d)),l[0]=a<<3,l[0]|=(d&14)>>1,l[1]|=(d&1)<<7,l[1]|=h<<3,a===5&&(l[1]|=(v&14)>>1,l[2]=(v&1)<<7,l[2]|=2<<2,l[3]=0),{config:l,samplerate:i[d],channelCount:h,codec:"mp4a.40."+a,manifestCodec:n}}function C(r,e){return r[e]===255&&(r[e+1]&246)===240}function I(r,e){return r[e+1]&1?7:9}function A(r,e){return(r[e+3]&3)<<11|r[e+4]<<3|(r[e+5]&224)>>>5}function g(r,e){return e+5<r.length}function y(r,e){return e+1<r.length&&C(r,e)}function L(r,e){return g(r,e)&&C(r,e)&&A(r,e)<=r.length-e}function p(r,e){if(y(r,e)){var f=I(r,e);if(e+f>=r.length)return!1;var o=A(r,e);if(o<=f)return!1;var a=e+o;return a===r.length||y(r,a)}return!1}function E(r,e,f,o,a){if(!r.samplerate){var v=b(e,f,o,a);if(!v)return;r.config=v.config,r.samplerate=v.samplerate,r.channelCount=v.channelCount,r.codec=v.codec,r.manifestCodec=v.manifestCodec,M.logger.log("parsed codec:"+r.codec+", rate:"+v.samplerate+", channels:"+v.channelCount)}}function m(r){return 1024*9e4/r}function u(r,e,f,o,a){var v=I(r,e),h=A(r,e);if(h-=v,h>0){var l=f+o*a;return{headerLength:v,frameLength:h,stamp:l}}}function t(r,e,f,o,a){var v=m(r.samplerate),h=u(e,f,o,a,v);if(h){var l=h.frameLength,s=h.headerLength,n=h.stamp,i=s+l,d=Math.max(0,f+i-e.length),c;d?(c=new Uint8Array(i-s),c.set(e.subarray(f+s,e.length),0)):c=e.subarray(f+s,f+i);var S={unit:c,pts:n};return d||r.samples.push(S),{sample:S,length:i,missing:d}}}},"./src/demux/base-audio-demuxer.ts":function(G,F,T){"use strict";T.r(F),T.d(F,"initPTSFn",function(){return A});var M=T("./src/polyfills/number.ts"),O=T("./src/demux/id3.ts"),D=T("./src/demux/dummy-demuxed-track.ts"),b=T("./src/utils/mp4-tools.ts"),C=T("./src/utils/typed-array.ts"),I=function(){function g(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.initPTS=null}var y=g.prototype;return y.resetInitSegment=function(p,E,m){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},y.resetTimeStamp=function(){},y.resetContiguity=function(){},y.canParse=function(p,E){return!1},y.appendFrame=function(p,E,m){},y.demux=function(p,E){this.cachedData&&(p=Object(b.appendUint8Array)(this.cachedData,p),this.cachedData=null);var m=O.getID3Data(p,0),u=m?m.length:0,t,r,e=this._audioTrack,f=this._id3Track,o=m?O.getTimeStamp(m):void 0,a=p.length;for((this.frameIndex===0||this.initPTS===null)&&(this.initPTS=A(o,E)),m&&m.length>0&&f.samples.push({pts:this.initPTS,dts:this.initPTS,data:m}),r=this.initPTS;u<a;){if(this.canParse(p,u)){var v=this.appendFrame(e,p,u);v?(this.frameIndex++,r=v.sample.pts,u+=v.length,t=u):u=a}else O.canParse(p,u)?(m=O.getID3Data(p,u),f.samples.push({pts:r,dts:r,data:m}),u+=m.length,t=u):u++;if(u===a&&t!==a){var h=Object(C.sliceUint8)(p,t);this.cachedData?this.cachedData=Object(b.appendUint8Array)(this.cachedData,h):this.cachedData=h}}return{audioTrack:e,avcTrack:Object(D.dummyTrack)(),id3Track:f,textTrack:Object(D.dummyTrack)()}},y.demuxSampleAes=function(p,E,m){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},y.flush=function(p){var E=this.cachedData;return E&&(this.cachedData=null,this.demux(E,0)),this.frameIndex=0,{audioTrack:this._audioTrack,avcTrack:Object(D.dummyTrack)(),id3Track:this._id3Track,textTrack:Object(D.dummyTrack)()}},y.destroy=function(){},g}(),A=function(y,L){return Object(M.isFiniteNumber)(y)?y*90:L*9e4};F.default=I},"./src/demux/chunk-cache.ts":function(G,F,T){"use strict";T.r(F),T.d(F,"default",function(){return M});var M=function(){function D(){this.chunks=[],this.dataLength=0}var b=D.prototype;return b.push=function(I){this.chunks.push(I),this.dataLength+=I.length},b.flush=function(){var I=this.chunks,A=this.dataLength,g;if(I.length)I.length===1?g=I[0]:g=O(I,A);else return new Uint8Array(0);return this.reset(),g},b.reset=function(){this.chunks.length=0,this.dataLength=0},D}();function O(D,b){for(var C=new Uint8Array(b),I=0,A=0;A<D.length;A++){var g=D[A];C.set(g,I),I+=g.length}return C}},"./src/demux/dummy-demuxed-track.ts":function(G,F,T){"use strict";T.r(F),T.d(F,"dummyTrack",function(){return M});function M(){return{type:"",id:-1,pid:-1,inputTimeScale:9e4,sequenceNumber:-1,samples:[],dropped:0}}},"./src/demux/exp-golomb.ts":function(G,F,T){"use strict";T.r(F);var M=T("./src/utils/logger.ts"),O=function(){function D(C){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=C,this.bytesAvailable=C.byteLength,this.word=0,this.bitsAvailable=0}var b=D.prototype;return b.loadWord=function(){var I=this.data,A=this.bytesAvailable,g=I.byteLength-A,y=new Uint8Array(4),L=Math.min(4,A);if(L===0)throw new Error("no bytes available");y.set(I.subarray(g,g+L)),this.word=new DataView(y.buffer).getUint32(0),this.bitsAvailable=L*8,this.bytesAvailable-=L},b.skipBits=function(I){var A;this.bitsAvailable>I?(this.word<<=I,this.bitsAvailable-=I):(I-=this.bitsAvailable,A=I>>3,I-=A>>3,this.bytesAvailable-=A,this.loadWord(),this.word<<=I,this.bitsAvailable-=I)},b.readBits=function(I){var A=Math.min(this.bitsAvailable,I),g=this.word>>>32-A;return I>32&&M.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=A,this.bitsAvailable>0?this.word<<=A:this.bytesAvailable>0&&this.loadWord(),A=I-A,A>0&&this.bitsAvailable?g<<A|this.readBits(A):g},b.skipLZ=function(){var I;for(I=0;I<this.bitsAvailable;++I)if((this.word&2147483648>>>I)!==0)return this.word<<=I,this.bitsAvailable-=I,I;return this.loadWord(),I+this.skipLZ()},b.skipUEG=function(){this.skipBits(1+this.skipLZ())},b.skipEG=function(){this.skipBits(1+this.skipLZ())},b.readUEG=function(){var I=this.skipLZ();return this.readBits(I+1)-1},b.readEG=function(){var I=this.readUEG();return 1&I?1+I>>>1:-1*(I>>>1)},b.readBoolean=function(){return this.readBits(1)===1},b.readUByte=function(){return this.readBits(8)},b.readUShort=function(){return this.readBits(16)},b.readUInt=function(){return this.readBits(32)},b.skipScalingList=function(I){for(var A=8,g=8,y,L=0;L<I;L++)g!==0&&(y=this.readEG(),g=(A+y+256)%256),A=g===0?A:g},b.readSPS=function(){var I=0,A=0,g=0,y=0,L,p,E,m=this.readUByte.bind(this),u=this.readBits.bind(this),t=this.readUEG.bind(this),r=this.readBoolean.bind(this),e=this.skipBits.bind(this),f=this.skipEG.bind(this),o=this.skipUEG.bind(this),a=this.skipScalingList.bind(this);m();var v=m();if(u(5),e(3),m(),o(),v===100||v===110||v===122||v===244||v===44||v===83||v===86||v===118||v===128){var h=t();if(h===3&&e(1),o(),o(),e(1),r())for(p=h!==3?8:12,E=0;E<p;E++)r()&&(E<6?a(16):a(64))}o();var l=t();if(l===0)t();else if(l===1)for(e(1),f(),f(),L=t(),E=0;E<L;E++)f();o(),e(1);var s=t(),n=t(),i=u(1);i===0&&e(1),e(1),r()&&(I=t(),A=t(),g=t(),y=t());var d=[1,1];if(r()&&r()){var c=m();switch(c){case 1:d=[1,1];break;case 2:d=[12,11];break;case 3:d=[10,11];break;case 4:d=[16,11];break;case 5:d=[40,33];break;case 6:d=[24,11];break;case 7:d=[20,11];break;case 8:d=[32,11];break;case 9:d=[80,33];break;case 10:d=[18,11];break;case 11:d=[15,11];break;case 12:d=[64,33];break;case 13:d=[160,99];break;case 14:d=[4,3];break;case 15:d=[3,2];break;case 16:d=[2,1];break;case 255:{d=[m()<<8|m(),m()<<8|m()];break}}}return{width:Math.ceil((s+1)*16-I*2-A*2),height:(2-i)*(n+1)*16-(i?2:4)*(g+y),pixelRatio:d}},b.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},D}();F.default=O},"./src/demux/id3.ts":function(G,F,T){"use strict";T.r(F),T.d(F,"isHeader",function(){return M}),T.d(F,"isFooter",function(){return O}),T.d(F,"getID3Data",function(){return D}),T.d(F,"canParse",function(){return C}),T.d(F,"getTimeStamp",function(){return I}),T.d(F,"isTimeStampFrame",function(){return A}),T.d(F,"getID3Frames",function(){return y}),T.d(F,"decodeFrame",function(){return L}),T.d(F,"utf8ArrayToStr",function(){return t}),T.d(F,"testables",function(){return r});var M=function(a,v){return v+10<=a.length&&a[v]===73&&a[v+1]===68&&a[v+2]===51&&a[v+3]<255&&a[v+4]<255&&a[v+6]<128&&a[v+7]<128&&a[v+8]<128&&a[v+9]<128},O=function(a,v){return v+10<=a.length&&a[v]===51&&a[v+1]===68&&a[v+2]===73&&a[v+3]<255&&a[v+4]<255&&a[v+6]<128&&a[v+7]<128&&a[v+8]<128&&a[v+9]<128},D=function(a,v){for(var h=v,l=0;M(a,v);){l+=10;var s=b(a,v+6);l+=s,O(a,v+10)&&(l+=10),v+=l}if(l>0)return a.subarray(h,h+l)},b=function(a,v){var h=0;return h=(a[v]&127)<<21,h|=(a[v+1]&127)<<14,h|=(a[v+2]&127)<<7,h|=a[v+3]&127,h},C=function(a,v){return M(a,v)&&b(a,v+6)+10<=a.length-v},I=function(a){for(var v=y(a),h=0;h<v.length;h++){var l=v[h];if(A(l))return u(l)}},A=function(a){return a&&a.key==="PRIV"&&a.info==="com.apple.streaming.transportStreamTimestamp"},g=function(a){var v=String.fromCharCode(a[0],a[1],a[2],a[3]),h=b(a,4),l=10;return{type:v,size:h,data:a.subarray(l,l+h)}},y=function(a){for(var v=0,h=[];M(a,v);){var l=b(a,v+6);v+=10;for(var s=v+l;v+8<s;){var n=g(a.subarray(v)),i=L(n);i&&h.push(i),v+=n.size+10}O(a,v)&&(v+=10)}return h},L=function(a){return a.type==="PRIV"?p(a):a.type[0]==="W"?m(a):E(a)},p=function(a){if(!(a.size<2)){var v=t(a.data,!0),h=new Uint8Array(a.data.subarray(v.length+1));return{key:a.type,info:v,data:h.buffer}}},E=function(a){if(!(a.size<2)){if(a.type==="TXXX"){var v=1,h=t(a.data.subarray(v),!0);v+=h.length+1;var l=t(a.data.subarray(v));return{key:a.type,info:h,data:l}}var s=t(a.data.subarray(1));return{key:a.type,data:s}}},m=function(a){if(a.type==="WXXX"){if(a.size<2)return;var v=1,h=t(a.data.subarray(v),!0);v+=h.length+1;var l=t(a.data.subarray(v));return{key:a.type,info:h,data:l}}var s=t(a.data);return{key:a.type,data:s}},u=function(a){if(a.data.byteLength===8){var v=new Uint8Array(a.data),h=v[3]&1,l=(v[4]<<23)+(v[5]<<15)+(v[6]<<7)+v[7];return l/=45,h&&(l+=4772185884e-2),Math.round(l)}},t=function(a,v){v===void 0&&(v=!1);var h=f();if(h){var l=h.decode(a);if(v){var s=l.indexOf("\0");return s!==-1?l.substring(0,s):l}return l.replace(/\0/g,"")}for(var n=a.length,i,d,c,S="",R=0;R<n;){if(i=a[R++],i===0&&v)return S;if(i===0||i===3)continue;switch(i>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:S+=String.fromCharCode(i);break;case 12:case 13:d=a[R++],S+=String.fromCharCode((i&31)<<6|d&63);break;case 14:d=a[R++],c=a[R++],S+=String.fromCharCode((i&15)<<12|(d&63)<<6|(c&63)<<0);break;default:}}return S},r={decodeTextFrame:E},e;function f(){return!e&&typeof self.TextDecoder<"u"&&(e=new self.TextDecoder("utf-8")),e}},"./src/demux/mp3demuxer.ts":function(G,F,T){"use strict";T.r(F);var M=T("./src/demux/base-audio-demuxer.ts"),O=T("./src/demux/id3.ts"),D=T("./src/utils/logger.ts"),b=T("./src/demux/mpegaudio.ts");function C(g,y){g.prototype=Object.create(y.prototype),g.prototype.constructor=g,I(g,y)}function I(g,y){return I=Object.setPrototypeOf||function(p,E){return p.__proto__=E,p},I(g,y)}var A=function(g){C(y,g);function y(){return g.apply(this,arguments)||this}var L=y.prototype;return L.resetInitSegment=function(E,m,u){g.prototype.resetInitSegment.call(this,E,m,u),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,isAAC:!1,samples:[],manifestCodec:E,duration:u,inputTimeScale:9e4,dropped:0}},y.probe=function(E){if(!E)return!1;for(var m=O.getID3Data(E,0)||[],u=m.length,t=E.length;u<t;u++)if(b.probe(E,u))return D.logger.log("MPEG Audio sync word found !"),!0;return!1},L.canParse=function(E,m){return b.canParse(E,m)},L.appendFrame=function(E,m,u){if(this.initPTS!==null)return b.appendFrame(E,m,u,this.initPTS,this.frameIndex)},y}(M.default);A.minProbeByteLength=4,F.default=A},"./src/demux/mp4demuxer.ts":function(G,F,T){"use strict";T.r(F);var M=T("./src/utils/mp4-tools.ts"),O=T("./src/demux/dummy-demuxed-track.ts"),D=function(){function b(I,A){this.remainderData=null,this.config=void 0,this.config=A}var C=b.prototype;return C.resetTimeStamp=function(){},C.resetInitSegment=function(){},C.resetContiguity=function(){},b.probe=function(A){return Object(M.findBox)({data:A,start:0,end:Math.min(A.length,16384)},["moof"]).length>0},C.demux=function(A){var g=A,y=Object(O.dummyTrack)();if(this.config.progressive){this.remainderData&&(g=Object(M.appendUint8Array)(this.remainderData,A));var L=Object(M.segmentValidRange)(g);this.remainderData=L.remainder,y.samples=L.valid||new Uint8Array}else y.samples=g;return{audioTrack:Object(O.dummyTrack)(),avcTrack:y,id3Track:Object(O.dummyTrack)(),textTrack:Object(O.dummyTrack)()}},C.flush=function(){var A=Object(O.dummyTrack)();return A.samples=this.remainderData||new Uint8Array,this.remainderData=null,{audioTrack:Object(O.dummyTrack)(),avcTrack:A,id3Track:Object(O.dummyTrack)(),textTrack:Object(O.dummyTrack)()}},C.demuxSampleAes=function(A,g,y){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},C.destroy=function(){},b}();D.minProbeByteLength=1024,F.default=D},"./src/demux/mpegaudio.ts":function(G,F,T){"use strict";T.r(F),T.d(F,"appendFrame",function(){return I}),T.d(F,"parseHeader",function(){return A}),T.d(F,"isHeaderPattern",function(){return g}),T.d(F,"isHeader",function(){return y}),T.d(F,"canParse",function(){return L}),T.d(F,"probe",function(){return p});var M=null,O=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],D=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],b=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],C=[0,1,1,4];function I(E,m,u,t,r){if(!(u+24>m.length)){var e=A(m,u);if(e&&u+e.frameLength<=m.length){var f=e.samplesPerFrame*9e4/e.sampleRate,o=t+r*f,a={unit:m.subarray(u,u+e.frameLength),pts:o,dts:o};return E.config=[],E.channelCount=e.channelCount,E.samplerate=e.sampleRate,E.samples.push(a),{sample:a,length:e.frameLength,missing:0}}}}function A(E,m){var u=E[m+1]>>3&3,t=E[m+1]>>1&3,r=E[m+2]>>4&15,e=E[m+2]>>2&3;if(u!==1&&r!==0&&r!==15&&e!==3){var f=E[m+2]>>1&1,o=E[m+3]>>6,a=u===3?3-t:t===3?3:4,v=O[a*14+r-1]*1e3,h=u===3?0:u===2?1:2,l=D[h*3+e],s=o===3?1:2,n=b[u][t],i=C[t],d=n*8*i,c=Math.floor(n*v/l+f)*i;if(M===null){var S=navigator.userAgent||"",R=S.match(/Chrome\/(\d+)/i);M=R?parseInt(R[1]):0}var P=!!M&&M<=87;return P&&t===2&&v>=224e3&&o===0&&(E[m+3]=E[m+3]|128),{sampleRate:l,channelCount:s,frameLength:c,samplesPerFrame:d}}}function g(E,m){return E[m]===255&&(E[m+1]&224)===224&&(E[m+1]&6)!==0}function y(E,m){return m+1<E.length&&g(E,m)}function L(E,m){var u=4;return g(E,m)&&u<=E.length-m}function p(E,m){if(m+1<E.length&&g(E,m)){var u=4,t=A(E,m),r=u;t!=null&&t.frameLength&&(r=t.frameLength);var e=m+r;return e===E.length||y(E,e)}return!1}},"./src/demux/sample-aes.ts":function(G,F,T){"use strict";T.r(F);var M=T("./src/crypt/decrypter.ts"),O=T("./src/demux/tsdemuxer.ts"),D=function(){function b(I,A,g){this.keyData=void 0,this.decrypter=void 0,this.keyData=g,this.decrypter=new M.default(I,A,{removePKCS7Padding:!1})}var C=b.prototype;return C.decryptBuffer=function(A,g){this.decrypter.decrypt(A,this.keyData.key.buffer,this.keyData.iv.buffer,g)},C.decryptAacSample=function(A,g,y,L){var p=A[g].unit,E=p.subarray(16,p.length-p.length%16),m=E.buffer.slice(E.byteOffset,E.byteOffset+E.length),u=this;this.decryptBuffer(m,function(t){var r=new Uint8Array(t);p.set(r,16),L||u.decryptAacSamples(A,g+1,y)})},C.decryptAacSamples=function(A,g,y){for(;;g++){if(g>=A.length){y();return}if(!(A[g].unit.length<32)){var L=this.decrypter.isSync();if(this.decryptAacSample(A,g,y,L),!L)return}}},C.getAvcEncryptedData=function(A){for(var g=Math.floor((A.length-48)/160)*16+16,y=new Int8Array(g),L=0,p=32;p<A.length-16;p+=160,L+=16)y.set(A.subarray(p,p+16),L);return y},C.getAvcDecryptedUnit=function(A,g){for(var y=new Uint8Array(g),L=0,p=32;p<A.length-16;p+=160,L+=16)A.set(y.subarray(L,L+16),p);return A},C.decryptAvcSample=function(A,g,y,L,p,E){var m=Object(O.discardEPB)(p.data),u=this.getAvcEncryptedData(m),t=this;this.decryptBuffer(u.buffer,function(r){p.data=t.getAvcDecryptedUnit(m,r),E||t.decryptAvcSamples(A,g,y+1,L)})},C.decryptAvcSamples=function(A,g,y,L){if(A instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;g++,y=0){if(g>=A.length){L();return}for(var p=A[g].units;!(y>=p.length);y++){var E=p[y];if(!(E.data.length<=48||E.type!==1&&E.type!==5)){var m=this.decrypter.isSync();if(this.decryptAvcSample(A,g,y,L,E,m),!m)return}}}},b}();F.default=D},"./src/demux/transmuxer-interface.ts":function(G,F,T){"use strict";T.r(F),T.d(F,"default",function(){return p});var M=T("./node_modules/webworkify-webpack/index.js"),O=T.n(M),D=T("./src/events.ts"),b=T("./src/demux/transmuxer.ts"),C=T("./src/utils/logger.ts"),I=T("./src/errors.ts"),A=T("./src/utils/mediasource-helper.ts"),g=T("./node_modules/eventemitter3/index.js"),y=T.n(g),L=Object(A.getMediaSource)()||{isTypeSupported:function(){return!1}},p=function(){function E(u,t,r,e){var f=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.hls=u,this.id=t,this.onTransmuxComplete=r,this.onFlush=e;var o=u.config,a=function(n,i){i=i||{},i.frag=f.frag,i.id=f.id,u.trigger(n,i)};this.observer=new g.EventEmitter,this.observer.on(D.Events.FRAG_DECRYPTED,a),this.observer.on(D.Events.ERROR,a);var v={mp4:L.isTypeSupported("video/mp4"),mpeg:L.isTypeSupported("audio/mpeg"),mp3:L.isTypeSupported('audio/mp4; codecs="mp3"')},h=navigator.vendor;if(o.enableWorker&&typeof Worker<"u"){C.logger.log("demuxing in webworker");var l;try{l=this.worker=M("./src/demux/transmuxer-worker.ts"),this.onwmsg=this.onWorkerMessage.bind(this),l.addEventListener("message",this.onwmsg),l.onerror=function(s){u.trigger(D.Events.ERROR,{type:I.ErrorTypes.OTHER_ERROR,details:I.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",error:new Error(s.message+"  ("+s.filename+":"+s.lineno+")")})},l.postMessage({cmd:"init",typeSupported:v,vendor:h,id:t,config:JSON.stringify(o)})}catch(s){C.logger.warn("Error in worker:",s),C.logger.error("Error while initializing DemuxerWorker, fallback to inline"),l&&self.URL.revokeObjectURL(l.objectURL),this.transmuxer=new b.default(this.observer,v,o,h,t),this.worker=null}}else this.transmuxer=new b.default(this.observer,v,o,h,t)}var m=E.prototype;return m.destroy=function(){var t=this.worker;if(t)t.removeEventListener("message",this.onwmsg),t.terminate(),this.worker=null;else{var r=this.transmuxer;r&&(r.destroy(),this.transmuxer=null)}var e=this.observer;e&&e.removeAllListeners(),this.observer=null},m.push=function(t,r,e,f,o,a,v,h,l,s){var n,i,d=this;l.transmuxing.start=self.performance.now();var c=this.transmuxer,S=this.worker,R=a?a.start:o.start,P=o.decryptdata,B=this.frag,x=!(B&&o.cc===B.cc),U=!(B&&l.level===B.level),k=B?l.sn-B.sn:-1,N=this.part?l.part-this.part.index:1,K=!U&&(k===1||k===0&&N===1),W=self.performance.now();(U||k||o.stats.parsing.start===0)&&(o.stats.parsing.start=W),a&&(N||!K)&&(a.stats.parsing.start=W);var w=!(B&&((n=o.initSegment)===null||n===void 0?void 0:n.url)===((i=B.initSegment)===null||i===void 0?void 0:i.url)),H=new b.TransmuxState(x,K,h,U,R,w);if(!K||x||w){C.logger.log("[transmuxer-interface, "+o.type+"]: Starting new transmux session for sn: "+l.sn+" p: "+l.part+" level: "+l.level+" id: "+l.id+`
        discontinuity: `+x+`
        trackSwitch: `+U+`
        contiguous: `+K+`
        accurateTimeOffset: `+h+`
        timeOffset: `+R+`
        initSegmentChange: `+w);var V=new b.TransmuxConfig(e,f,r,v,s);this.configureTransmuxer(V)}if(this.frag=o,this.part=a,S)S.postMessage({cmd:"demux",data:t,decryptdata:P,chunkMeta:l,state:H},t instanceof ArrayBuffer?[t]:[]);else if(c){var j=c.push(t,P,l,H);Object(b.isPromise)(j)?j.then(function(X){d.handleTransmuxComplete(X)}):this.handleTransmuxComplete(j)}},m.flush=function(t){var r=this;t.transmuxing.start=self.performance.now();var e=this.transmuxer,f=this.worker;if(f)f.postMessage({cmd:"flush",chunkMeta:t});else if(e){var o=e.flush(t);Object(b.isPromise)(o)?o.then(function(a){r.handleFlushResult(a,t)}):this.handleFlushResult(o,t)}},m.handleFlushResult=function(t,r){var e=this;t.forEach(function(f){e.handleTransmuxComplete(f)}),this.onFlush(r)},m.onWorkerMessage=function(t){var r=t.data,e=this.hls;switch(r.event){case"init":{self.URL.revokeObjectURL(this.worker.objectURL);break}case"transmuxComplete":{this.handleTransmuxComplete(r.data);break}case"flush":{this.onFlush(r.data);break}default:{r.data=r.data||{},r.data.frag=this.frag,r.data.id=this.id,e.trigger(r.event,r.data);break}}},m.configureTransmuxer=function(t){var r=this.worker,e=this.transmuxer;r?r.postMessage({cmd:"configure",config:t}):e&&e.configure(t)},m.handleTransmuxComplete=function(t){t.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(t)},E}()},"./src/demux/transmuxer-worker.ts":function(G,F,T){"use strict";T.r(F),T.d(F,"default",function(){return I});var M=T("./src/demux/transmuxer.ts"),O=T("./src/events.ts"),D=T("./src/utils/logger.ts"),b=T("./node_modules/eventemitter3/index.js"),C=T.n(b);function I(p){var E=new b.EventEmitter,m=function(t,r){p.postMessage({event:t,data:r})};E.on(O.Events.FRAG_DECRYPTED,m),E.on(O.Events.ERROR,m),p.addEventListener("message",function(u){var t=u.data;switch(t.cmd){case"init":{var r=JSON.parse(t.config);p.transmuxer=new M.default(E,t.typeSupported,r,t.vendor,t.id),Object(D.enableLogs)(r.debug),m("init",null);break}case"configure":{p.transmuxer.configure(t.config);break}case"demux":{var e=p.transmuxer.push(t.data,t.decryptdata,t.chunkMeta,t.state);Object(M.isPromise)(e)?e.then(function(a){A(p,a)}):A(p,e);break}case"flush":{var f=t.chunkMeta,o=p.transmuxer.flush(f);Object(M.isPromise)(o)?o.then(function(a){y(p,a,f)}):y(p,o,f);break}default:break}})}function A(p,E){if(!L(E.remuxResult)){var m=[],u=E.remuxResult,t=u.audio,r=u.video;t&&g(m,t),r&&g(m,r),p.postMessage({event:"transmuxComplete",data:E},m)}}function g(p,E){E.data1&&p.push(E.data1.buffer),E.data2&&p.push(E.data2.buffer)}function y(p,E,m){E.forEach(function(u){A(p,u)}),p.postMessage({event:"flush",data:m})}function L(p){return!p.audio&&!p.video&&!p.text&&!p.id3&&!p.initSegment}},"./src/demux/transmuxer.ts":function(G,F,T){"use strict";T.r(F),T.d(F,"default",function(){return r}),T.d(F,"isPromise",function(){return o}),T.d(F,"TransmuxConfig",function(){return a}),T.d(F,"TransmuxState",function(){return v});var M=T("./src/events.ts"),O=T("./src/errors.ts"),D=T("./src/crypt/decrypter.ts"),b=T("./src/demux/aacdemuxer.ts"),C=T("./src/demux/mp4demuxer.ts"),I=T("./src/demux/tsdemuxer.ts"),A=T("./src/demux/mp3demuxer.ts"),g=T("./src/remux/mp4-remuxer.ts"),y=T("./src/remux/passthrough-remuxer.ts"),L=T("./src/demux/chunk-cache.ts"),p=T("./src/utils/mp4-tools.ts"),E=T("./src/utils/logger.ts"),m;try{m=self.performance.now.bind(self.performance)}catch{E.logger.debug("Unable to use Performance API on this environment"),m=self.Date.now}var u=[{demux:I.default,remux:g.default},{demux:C.default,remux:y.default},{demux:b.default,remux:g.default},{demux:A.default,remux:g.default}],t=1024;u.forEach(function(h){var l=h.demux;t=Math.max(t,l.minProbeByteLength)});var r=function(){function h(s,n,i,d,c){this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.cache=new L.default,this.observer=s,this.typeSupported=n,this.config=i,this.vendor=d,this.id=c}var l=h.prototype;return l.configure=function(n){this.transmuxConfig=n,this.decrypter&&this.decrypter.reset()},l.push=function(n,i,d,c){var S=this,R=d.transmuxing;R.executeStart=m();var P=new Uint8Array(n),B=this.cache,x=this.config,U=this.currentTransmuxState,k=this.transmuxConfig;c&&(this.currentTransmuxState=c);var N=e(P,i);if(N&&N.method==="AES-128"){var K=this.getDecrypter();if(x.enableSoftwareAES){var W=K.softwareDecrypt(P,N.key.buffer,N.iv.buffer);if(!W)return R.executeEnd=m(),f(d);P=new Uint8Array(W)}else return this.decryptionPromise=K.webCryptoDecrypt(P,N.key.buffer,N.iv.buffer).then(function(at){var rt=S.push(at,null,d);return S.decryptionPromise=null,rt}),this.decryptionPromise}var w=c||U,H=w.contiguous,V=w.discontinuity,j=w.trackSwitch,X=w.accurateTimeOffset,Y=w.timeOffset,$=w.initSegmentChange,_=k.audioCodec,z=k.videoCodec,J=k.defaultInitPts,Q=k.duration,et=k.initSegmentData;if((V||j||$)&&this.resetInitSegment(et,_,z,Q),(V||$)&&this.resetInitialTimestamp(J),H||this.resetContiguity(),this.needsProbing(P,V,j)){if(B.dataLength){var Z=B.flush();P=Object(p.appendUint8Array)(Z,P)}this.configureTransmuxer(P,k)}var it=this.transmux(P,N,Y,X,d),tt=this.currentTransmuxState;return tt.contiguous=!0,tt.discontinuity=!1,tt.trackSwitch=!1,R.executeEnd=m(),it},l.flush=function(n){var i=this,d=n.transmuxing;d.executeStart=m();var c=this.decrypter,S=this.cache,R=this.currentTransmuxState,P=this.decryptionPromise;if(P)return P.then(function(){return i.flush(n)});var B=[],x=R.timeOffset;if(c){var U=c.flush();U&&B.push(this.push(U,null,n))}var k=S.dataLength;S.reset();var N=this.demuxer,K=this.remuxer;if(!N||!K)return k>=t&&this.observer.emit(M.Events.ERROR,M.Events.ERROR,{type:O.ErrorTypes.MEDIA_ERROR,details:O.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),d.executeEnd=m(),[f(n)];var W=N.flush(x);return o(W)?W.then(function(w){return i.flushRemux(B,w,n),B}):(this.flushRemux(B,W,n),B)},l.flushRemux=function(n,i,d){var c=i.audioTrack,S=i.avcTrack,R=i.id3Track,P=i.textTrack,B=this.currentTransmuxState,x=B.accurateTimeOffset,U=B.timeOffset;E.logger.log("[transmuxer.ts]: Flushed fragment "+d.sn+(d.part>-1?" p: "+d.part:"")+" of level "+d.level);var k=this.remuxer.remux(c,S,R,P,U,x,!0,this.id);n.push({remuxResult:k,chunkMeta:d}),d.transmuxing.executeEnd=m()},l.resetInitialTimestamp=function(n){var i=this.demuxer,d=this.remuxer;!i||!d||(i.resetTimeStamp(n),d.resetTimeStamp(n))},l.resetContiguity=function(){var n=this.demuxer,i=this.remuxer;!n||!i||(n.resetContiguity(),i.resetNextTimestamp())},l.resetInitSegment=function(n,i,d,c){var S=this.demuxer,R=this.remuxer;!S||!R||(S.resetInitSegment(i,d,c),R.resetInitSegment(n,i,d))},l.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},l.transmux=function(n,i,d,c,S){var R;return i&&i.method==="SAMPLE-AES"?R=this.transmuxSampleAes(n,i,d,c,S):R=this.transmuxUnencrypted(n,d,c,S),R},l.transmuxUnencrypted=function(n,i,d,c){var S=this.demuxer.demux(n,i,!1,!this.config.progressive),R=S.audioTrack,P=S.avcTrack,B=S.id3Track,x=S.textTrack,U=this.remuxer.remux(R,P,B,x,i,d,!1,this.id);return{remuxResult:U,chunkMeta:c}},l.transmuxSampleAes=function(n,i,d,c,S){var R=this;return this.demuxer.demuxSampleAes(n,i,d).then(function(P){var B=R.remuxer.remux(P.audioTrack,P.avcTrack,P.id3Track,P.textTrack,d,c,!1,R.id);return{remuxResult:B,chunkMeta:S}})},l.configureTransmuxer=function(n,i){for(var d=this.config,c=this.observer,S=this.typeSupported,R=this.vendor,P=i.audioCodec,B=i.defaultInitPts,x=i.duration,U=i.initSegmentData,k=i.videoCodec,N,K=0,W=u.length;K<W;K++)if(u[K].demux.probe(n)){N=u[K];break}N||(E.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),N={demux:C.default,remux:y.default});var w=this.demuxer,H=this.remuxer,V=N.remux,j=N.demux;(!H||!(H instanceof V))&&(this.remuxer=new V(c,d,S,R)),(!w||!(w instanceof j))&&(this.demuxer=new j(c,d,S),this.probe=j.probe),this.resetInitSegment(U,P,k,x),this.resetInitialTimestamp(B)},l.needsProbing=function(n,i,d){return!this.demuxer||!this.remuxer||i||d},l.getDecrypter=function(){var n=this.decrypter;return n||(n=this.decrypter=new D.default(this.observer,this.config)),n},h}();function e(h,l){var s=null;return h.byteLength>0&&l!=null&&l.key!=null&&l.iv!==null&&l.method!=null&&(s=l),s}var f=function(l){return{remuxResult:{},chunkMeta:l}};function o(h){return"then"in h&&h.then instanceof Function}var a=function(l,s,n,i,d){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=l,this.videoCodec=s,this.initSegmentData=n,this.duration=i,this.defaultInitPts=d},v=function(l,s,n,i,d,c){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=l,this.contiguous=s,this.accurateTimeOffset=n,this.trackSwitch=i,this.timeOffset=d,this.initSegmentChange=c}},"./src/demux/tsdemuxer.ts":function(G,F,T){"use strict";T.r(F),T.d(F,"discardEPB",function(){return f});var M=T("./src/demux/adts.ts"),O=T("./src/demux/mpegaudio.ts"),D=T("./src/demux/exp-golomb.ts"),b=T("./src/demux/id3.ts"),C=T("./src/demux/sample-aes.ts"),I=T("./src/events.ts"),A=T("./src/utils/mp4-tools.ts"),g=T("./src/utils/logger.ts"),y=T("./src/errors.ts"),L={video:1,audio:2,id3:3,text:4},p=function(){function o(v,h,l){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this.aacLastPTS=null,this._initPTS=null,this._initDTS=null,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=v,this.config=h,this.typeSupported=l}o.probe=function(h){var l=o.syncOffset(h);return l<0?!1:(l&&g.logger.warn("MPEG2-TS detected but first sync word found @ offset "+l+", junk ahead ?"),!0)},o.syncOffset=function(h){for(var l=Math.min(1e3,h.length-564),s=0;s<l;){if(h[s]===71&&h[s+188]===71&&h[s+2*188]===71)return s;s++}return-1},o.createTrack=function(h,l){return{container:h==="video"||h==="audio"?"video/mp2t":void 0,type:h,id:L[h],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:h==="audio"?l:void 0}};var a=o.prototype;return a.resetInitSegment=function(h,l,s){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=o.createTrack("video",s),this._audioTrack=o.createTrack("audio",s),this._id3Track=o.createTrack("id3",s),this._txtTrack=o.createTrack("text",s),this._audioTrack.isAAC=!0,this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=h,this.videoCodec=l,this._duration=s},a.resetTimeStamp=function(){},a.resetContiguity=function(){var h=this._audioTrack,l=this._avcTrack,s=this._id3Track;h&&(h.pesData=null),l&&(l.pesData=null),s&&(s.pesData=null),this.aacOverFlow=null,this.aacLastPTS=null},a.demux=function(h,l,s,n){s===void 0&&(s=!1),n===void 0&&(n=!1),s||(this.sampleAes=null);var i,d=this._avcTrack,c=this._audioTrack,S=this._id3Track,R=d.pid,P=d.pesData,B=c.pid,x=S.pid,U=c.pesData,k=S.pesData,N=!1,K=this.pmtParsed,W=this._pmtId,w=h.length;if(this.remainderData&&(h=Object(A.appendUint8Array)(this.remainderData,h),w=h.length,this.remainderData=null),w<188&&!n)return this.remainderData=h,{audioTrack:c,avcTrack:d,id3Track:S,textTrack:this._txtTrack};var H=Math.max(0,o.syncOffset(h));w-=(w+H)%188,w<h.byteLength&&!n&&(this.remainderData=new Uint8Array(h.buffer,w,h.buffer.byteLength-w));for(var V=0,j=H;j<w;j+=188)if(h[j]===71){var X=!!(h[j+1]&64),Y=((h[j+1]&31)<<8)+h[j+2],$=(h[j+3]&48)>>4,_=void 0;if($>1){if(_=j+5+h[j+4],_===j+188)continue}else _=j+4;switch(Y){case R:X&&(P&&(i=t(P))&&this.parseAVCPES(i,!1),P={data:[],size:0}),P&&(P.data.push(h.subarray(_,j+188)),P.size+=j+188-_);break;case B:X&&(U&&(i=t(U))&&(c.isAAC?this.parseAACPES(i):this.parseMPEGPES(i)),U={data:[],size:0}),U&&(U.data.push(h.subarray(_,j+188)),U.size+=j+188-_);break;case x:X&&(k&&(i=t(k))&&this.parseID3PES(i),k={data:[],size:0}),k&&(k.data.push(h.subarray(_,j+188)),k.size+=j+188-_);break;case 0:X&&(_+=h[_]+1),W=this._pmtId=m(h,_);break;case W:{X&&(_+=h[_]+1);var z=u(h,_,this.typeSupported.mpeg===!0||this.typeSupported.mp3===!0,s);R=z.avc,R>0&&(d.pid=R),B=z.audio,B>0&&(c.pid=B,c.isAAC=z.isAAC),x=z.id3,x>0&&(S.pid=x),N&&!K&&(g.logger.log("reparse from beginning"),N=!1,j=H-188),K=this.pmtParsed=!0;break}case 17:case 8191:break;default:N=!0;break}}else V++;V>0&&this.observer.emit(I.Events.ERROR,I.Events.ERROR,{type:y.ErrorTypes.MEDIA_ERROR,details:y.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"Found "+V+" TS packet/s that do not start with 0x47"}),d.pesData=P,c.pesData=U,S.pesData=k;var J={audioTrack:c,avcTrack:d,id3Track:S,textTrack:this._txtTrack};return n&&this.extractRemainingSamples(J),J},a.flush=function(){var h=this.remainderData;this.remainderData=null;var l;return h?l=this.demux(h,-1,!1,!0):l={audioTrack:this._audioTrack,avcTrack:this._avcTrack,textTrack:this._txtTrack,id3Track:this._id3Track},this.extractRemainingSamples(l),this.sampleAes?this.decrypt(l,this.sampleAes):l},a.extractRemainingSamples=function(h){var l=h.audioTrack,s=h.avcTrack,n=h.id3Track,i=s.pesData,d=l.pesData,c=n.pesData,S;i&&(S=t(i))?(this.parseAVCPES(S,!0),s.pesData=null):s.pesData=i,d&&(S=t(d))?(l.isAAC?this.parseAACPES(S):this.parseMPEGPES(S),l.pesData=null):(d!=null&&d.size&&g.logger.log("last AAC PES packet truncated,might overlap between fragments"),l.pesData=d),c&&(S=t(c))?(this.parseID3PES(S),n.pesData=null):n.pesData=c},a.demuxSampleAes=function(h,l,s){var n=this.demux(h,s,!0,!this.config.progressive),i=this.sampleAes=new C.default(this.observer,this.config,l);return this.decrypt(n,i)},a.decrypt=function(h,l){return new Promise(function(s){var n=h.audioTrack,i=h.avcTrack;n.samples&&n.isAAC?l.decryptAacSamples(n.samples,0,function(){i.samples?l.decryptAvcSamples(i.samples,0,0,function(){s(h)}):s(h)}):i.samples&&l.decryptAvcSamples(i.samples,0,0,function(){s(h)})})},a.destroy=function(){this._initPTS=this._initDTS=null,this._duration=0},a.parseAVCPES=function(h,l){var s=this,n=this._avcTrack,i=this.parseAVCNALu(h.data),d=!1,c=this.avcSample,S,R=!1;h.data=null,c&&i.length&&!n.audFound&&(r(c,n),c=this.avcSample=E(!1,h.pts,h.dts,"")),i.forEach(function(P){switch(P.type){case 1:{S=!0,c||(c=s.avcSample=E(!0,h.pts,h.dts,"")),d&&(c.debug+="NDR "),c.frame=!0;var B=P.data;if(R&&B.length>4){var x=new D.default(B).readSliceType();(x===2||x===4||x===7||x===9)&&(c.key=!0)}break}case 5:S=!0,c||(c=s.avcSample=E(!0,h.pts,h.dts,"")),d&&(c.debug+="IDR "),c.key=!0,c.frame=!0;break;case 6:{S=!0,d&&c&&(c.debug+="SEI ");var U=new D.default(f(P.data));U.readUByte();for(var k=0,N=0,K=!1,W=0;!K&&U.bytesAvailable>1;){k=0;do W=U.readUByte(),k+=W;while(W===255);N=0;do W=U.readUByte(),N+=W;while(W===255);if(k===4&&U.bytesAvailable!==0){K=!0;var w=U.readUByte();if(w===181){var H=U.readUShort();if(H===49){var V=U.readUInt();if(V===1195456820){var j=U.readUByte();if(j===3){for(var X=U.readUByte(),Y=U.readUByte(),$=31&X,_=[X,Y],z=0;z<$;z++)_.push(U.readUByte()),_.push(U.readUByte()),_.push(U.readUByte());e(s._txtTrack.samples,{type:3,pts:h.pts,bytes:_})}}}}}else if(k===5&&U.bytesAvailable!==0){if(K=!0,N>16){for(var J=[],Q=0;Q<16;Q++)J.push(U.readUByte().toString(16)),(Q===3||Q===5||Q===7||Q===9)&&J.push("-");for(var et=N-16,Z=new Uint8Array(et),it=0;it<et;it++)Z[it]=U.readUByte();e(s._txtTrack.samples,{pts:h.pts,payloadType:k,uuid:J.join(""),userData:Object(b.utf8ArrayToStr)(Z),userDataBytes:Z})}}else if(N<U.bytesAvailable)for(var tt=0;tt<N;tt++)U.readUByte()}break}case 7:if(S=!0,R=!0,d&&c&&(c.debug+="SPS "),!n.sps){var at=new D.default(P.data),rt=at.readSPS();n.width=rt.width,n.height=rt.height,n.pixelRatio=rt.pixelRatio,n.sps=[P.data],n.duration=s._duration;for(var st=P.data.subarray(1,4),ut="avc1.",q=0;q<3;q++){var ot=st[q].toString(16);ot.length<2&&(ot="0"+ot),ut+=ot}n.codec=ut}break;case 8:S=!0,d&&c&&(c.debug+="PPS "),n.pps||(n.pps=[P.data]);break;case 9:S=!1,n.audFound=!0,c&&r(c,n),c=s.avcSample=E(!1,h.pts,h.dts,d?"AUD ":"");break;case 12:S=!1;break;default:S=!1,c&&(c.debug+="unknown NAL "+P.type+" ");break}if(c&&S){var vt=c.units;vt.push(P)}}),l&&c&&(r(c,n),this.avcSample=null)},a.getLastNalUnit=function(){var h,l=this.avcSample,s;if(!l||l.units.length===0){var n=this._avcTrack.samples;l=n[n.length-1]}if((h=l)!==null&&h!==void 0&&h.units){var i=l.units;s=i[i.length-1]}return s},a.parseAVCNALu=function(h){var l=h.byteLength,s=this._avcTrack,n=s.naluState||0,i=n,d=[],c=0,S,R,P,B=-1,x=0;for(n===-1&&(B=0,x=h[0]&31,n=0,c=1);c<l;){if(S=h[c++],!n){n=S?0:1;continue}if(n===1){n=S?0:2;continue}if(!S)n=3;else if(S===1){if(B>=0){var U={data:h.subarray(B,c-n-1),type:x};d.push(U)}else{var k=this.getLastNalUnit();if(k&&(i&&c<=4-i&&k.state&&(k.data=k.data.subarray(0,k.data.byteLength-i)),R=c-n-1,R>0)){var N=new Uint8Array(k.data.byteLength+R);N.set(k.data,0),N.set(h.subarray(0,R),k.data.byteLength),k.data=N,k.state=0}}c<l?(P=h[c]&31,B=c,x=P,n=0):n=-1}else n=0}if(B>=0&&n>=0){var K={data:h.subarray(B,l),type:x,state:n};d.push(K)}if(d.length===0){var W=this.getLastNalUnit();if(W){var w=new Uint8Array(W.data.byteLength+h.byteLength);w.set(W.data,0),w.set(h,W.data.byteLength),W.data=w}}return s.naluState=n,d},a.parseAACPES=function(h){var l=0,s=this._audioTrack,n=this.aacOverFlow,i=h.data;if(n){this.aacOverFlow=null;var d=n.sample.unit.byteLength,c=Math.min(n.missing,d),S=d-c;n.sample.unit.set(i.subarray(0,c),S),s.samples.push(n.sample),l=n.missing}var R,P;for(R=l,P=i.length;R<P-1&&!M.isHeader(i,R);R++);if(R!==l){var B,x;if(R<P-1?(B="AAC PES did not start with ADTS header,offset:"+R,x=!1):(B="no ADTS header found in AAC PES",x=!0),g.logger.warn("parsing error:"+B),this.observer.emit(I.Events.ERROR,I.Events.ERROR,{type:y.ErrorTypes.MEDIA_ERROR,details:y.ErrorDetails.FRAG_PARSING_ERROR,fatal:x,reason:B}),x)return}M.initTrackConfig(s,this.observer,i,R,this.audioCodec);var U;if(h.pts!==void 0)U=h.pts;else if(n){var k=M.getFrameDuration(s.samplerate);U=n.sample.pts+k}else{g.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}for(var N=0;R<P;)if(M.isHeader(i,R)){if(R+5<P){var K=M.appendFrame(s,i,R,U,N);if(K)if(K.missing)this.aacOverFlow=K;else{R+=K.length,N++;continue}}break}else R++},a.parseMPEGPES=function(h){var l=h.data,s=l.length,n=0,i=0,d=h.pts;if(d===void 0){g.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;i<s;)if(O.isHeader(l,i)){var c=O.appendFrame(this._audioTrack,l,i,d,n);if(c)i+=c.length,n++;else break}else i++},a.parseID3PES=function(h){if(h.pts===void 0){g.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}this._id3Track.samples.push(h)},o}();p.minProbeByteLength=188;function E(o,a,v,h){return{key:o,frame:!1,pts:a,dts:v,units:[],debug:h,length:0}}function m(o,a){return(o[a+10]&31)<<8|o[a+11]}function u(o,a,v,h){var l={audio:-1,avc:-1,id3:-1,isAAC:!0},s=(o[a+1]&15)<<8|o[a+2],n=a+3+s-4,i=(o[a+10]&15)<<8|o[a+11];for(a+=12+i;a<n;){var d=(o[a+1]&31)<<8|o[a+2];switch(o[a]){case 207:if(!h){g.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:l.audio===-1&&(l.audio=d);break;case 21:l.id3===-1&&(l.id3=d);break;case 219:if(!h){g.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:l.avc===-1&&(l.avc=d);break;case 3:case 4:v?l.audio===-1&&(l.audio=d,l.isAAC=!1):g.logger.log("MPEG audio found, not supported in this browser");break;case 36:g.logger.warn("Unsupported HEVC stream type found");break;default:break}a+=((o[a+3]&15)<<8|o[a+4])+5}return l}function t(o){var a=0,v,h,l,s,n,i=o.data;if(!o||o.size===0)return null;for(;i[0].length<19&&i.length>1;){var d=new Uint8Array(i[0].length+i[1].length);d.set(i[0]),d.set(i[1],i[0].length),i[0]=d,i.splice(1,1)}v=i[0];var c=(v[0]<<16)+(v[1]<<8)+v[2];if(c===1){if(h=(v[4]<<8)+v[5],h&&h>o.size-6)return null;var S=v[7];S&192&&(s=(v[9]&14)*536870912+(v[10]&255)*4194304+(v[11]&254)*16384+(v[12]&255)*128+(v[13]&254)/2,S&64?(n=(v[14]&14)*536870912+(v[15]&255)*4194304+(v[16]&254)*16384+(v[17]&255)*128+(v[18]&254)/2,s-n>60*9e4&&(g.logger.warn(Math.round((s-n)/9e4)+"s delta between PTS and DTS, align them"),s=n)):n=s),l=v[8];var R=l+9;if(o.size<=R)return null;o.size-=R;for(var P=new Uint8Array(o.size),B=0,x=i.length;B<x;B++){v=i[B];var U=v.byteLength;if(R)if(R>U){R-=U;continue}else v=v.subarray(R),U-=R,R=0;P.set(v,a),a+=U}return h&&(h-=l+3),{data:P,pts:s,dts:n,len:h}}return null}function r(o,a){if(o.units.length&&o.frame){if(o.pts===void 0){var v=a.samples,h=v.length;if(h){var l=v[h-1];o.pts=l.pts,o.dts=l.dts}else{a.dropped++;return}}a.samples.push(o)}o.debug.length&&g.logger.log(o.pts+"/"+o.dts+":"+o.debug)}function e(o,a){var v=o.length;if(v>0){if(a.pts>=o[v-1].pts)o.push(a);else for(var h=v-1;h>=0;h--)if(a.pts<o[h].pts){o.splice(h,0,a);break}}else o.push(a)}function f(o){for(var a=o.byteLength,v=[],h=1;h<a-2;)o[h]===0&&o[h+1]===0&&o[h+2]===3?(v.push(h+2),h+=2):h++;if(v.length===0)return o;var l=a-v.length,s=new Uint8Array(l),n=0;for(h=0;h<l;n++,h++)n===v[0]&&(n++,v.shift()),s[h]=o[n];return s}F.default=p},"./src/errors.ts":function(G,F,T){"use strict";T.r(F),T.d(F,"ErrorTypes",function(){return M}),T.d(F,"ErrorDetails",function(){return O});var M;(function(D){D.NETWORK_ERROR="networkError",D.MEDIA_ERROR="mediaError",D.KEY_SYSTEM_ERROR="keySystemError",D.MUX_ERROR="muxError",D.OTHER_ERROR="otherError"})(M||(M={}));var O;(function(D){D.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",D.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",D.KEY_SYSTEM_NO_SESSION="keySystemNoSession",D.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",D.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",D.MANIFEST_LOAD_ERROR="manifestLoadError",D.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",D.MANIFEST_PARSING_ERROR="manifestParsingError",D.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",D.LEVEL_EMPTY_ERROR="levelEmptyError",D.LEVEL_LOAD_ERROR="levelLoadError",D.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",D.LEVEL_SWITCH_ERROR="levelSwitchError",D.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",D.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",D.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",D.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",D.FRAG_LOAD_ERROR="fragLoadError",D.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",D.FRAG_DECRYPT_ERROR="fragDecryptError",D.FRAG_PARSING_ERROR="fragParsingError",D.REMUX_ALLOC_ERROR="remuxAllocError",D.KEY_LOAD_ERROR="keyLoadError",D.KEY_LOAD_TIMEOUT="keyLoadTimeOut",D.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",D.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",D.BUFFER_APPEND_ERROR="bufferAppendError",D.BUFFER_APPENDING_ERROR="bufferAppendingError",D.BUFFER_STALLED_ERROR="bufferStalledError",D.BUFFER_FULL_ERROR="bufferFullError",D.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",D.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",D.INTERNAL_EXCEPTION="internalException",D.INTERNAL_ABORTED="aborted",D.UNKNOWN="unknown"})(O||(O={}))},"./src/events.ts":function(G,F,T){"use strict";T.r(F),T.d(F,"Events",function(){return M});var M;(function(O){O.MEDIA_ATTACHING="hlsMediaAttaching",O.MEDIA_ATTACHED="hlsMediaAttached",O.MEDIA_DETACHING="hlsMediaDetaching",O.MEDIA_DETACHED="hlsMediaDetached",O.BUFFER_RESET="hlsBufferReset",O.BUFFER_CODECS="hlsBufferCodecs",O.BUFFER_CREATED="hlsBufferCreated",O.BUFFER_APPENDING="hlsBufferAppending",O.BUFFER_APPENDED="hlsBufferAppended",O.BUFFER_EOS="hlsBufferEos",O.BUFFER_FLUSHING="hlsBufferFlushing",O.BUFFER_FLUSHED="hlsBufferFlushed",O.MANIFEST_LOADING="hlsManifestLoading",O.MANIFEST_LOADED="hlsManifestLoaded",O.MANIFEST_PARSED="hlsManifestParsed",O.LEVEL_SWITCHING="hlsLevelSwitching",O.LEVEL_SWITCHED="hlsLevelSwitched",O.LEVEL_LOADING="hlsLevelLoading",O.LEVEL_LOADED="hlsLevelLoaded",O.LEVEL_UPDATED="hlsLevelUpdated",O.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",O.LEVELS_UPDATED="hlsLevelsUpdated",O.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",O.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",O.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",O.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",O.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",O.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",O.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",O.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",O.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",O.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",O.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",O.CUES_PARSED="hlsCuesParsed",O.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",O.INIT_PTS_FOUND="hlsInitPtsFound",O.FRAG_LOADING="hlsFragLoading",O.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",O.FRAG_LOADED="hlsFragLoaded",O.FRAG_DECRYPTED="hlsFragDecrypted",O.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",O.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",O.FRAG_PARSING_METADATA="hlsFragParsingMetadata",O.FRAG_PARSED="hlsFragParsed",O.FRAG_BUFFERED="hlsFragBuffered",O.FRAG_CHANGED="hlsFragChanged",O.FPS_DROP="hlsFpsDrop",O.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",O.ERROR="hlsError",O.DESTROYING="hlsDestroying",O.KEY_LOADING="hlsKeyLoading",O.KEY_LOADED="hlsKeyLoaded",O.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",O.BACK_BUFFER_REACHED="hlsBackBufferReached"})(M||(M={}))},"./src/hls.ts":function(G,F,T){"use strict";T.r(F),T.d(F,"default",function(){return o});var M=T("./node_modules/url-toolkit/src/url-toolkit.js"),O=T.n(M),D=T("./src/loader/playlist-loader.ts"),b=T("./src/loader/key-loader.ts"),C=T("./src/controller/id3-track-controller.ts"),I=T("./src/controller/latency-controller.ts"),A=T("./src/controller/level-controller.ts"),g=T("./src/controller/fragment-tracker.ts"),y=T("./src/controller/stream-controller.ts"),L=T("./src/is-supported.ts"),p=T("./src/utils/logger.ts"),E=T("./src/config.ts"),m=T("./node_modules/eventemitter3/index.js"),u=T.n(m),t=T("./src/events.ts"),r=T("./src/errors.ts");function e(a,v){for(var h=0;h<v.length;h++){var l=v[h];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(a,l.key,l)}}function f(a,v,h){return v&&e(a.prototype,v),h&&e(a,h),a}var o=function(){a.isSupported=function(){return Object(L.isSupported)()};function a(h){h===void 0&&(h={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new m.EventEmitter,this._autoLevelCapping=void 0,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null;var l=this.config=Object(E.mergeConfig)(a.DefaultConfig,h);this.userConfig=h,Object(p.enableLogs)(l.debug),this._autoLevelCapping=-1,l.progressive&&Object(E.enableStreamingMode)(l);var s=l.abrController,n=l.bufferController,i=l.capLevelController,d=l.fpsController,c=this.abrController=new s(this),S=this.bufferController=new n(this),R=this.capLevelController=new i(this),P=new d(this),B=new D.default(this),x=new b.default(this),U=new C.default(this),k=this.levelController=new A.default(this),N=new g.FragmentTracker(this),K=this.streamController=new y.default(this,N);R.setStreamController(K),P.setStreamController(K);var W=[k,K];this.networkControllers=W;var w=[B,x,c,S,R,P,U,N];this.audioTrackController=this.createController(l.audioTrackController,null,W),this.createController(l.audioStreamController,N,W),this.subtitleTrackController=this.createController(l.subtitleTrackController,null,W),this.createController(l.subtitleStreamController,N,W),this.createController(l.timelineController,null,w),this.emeController=this.createController(l.emeController,null,w),this.cmcdController=this.createController(l.cmcdController,null,w),this.latencyController=this.createController(I.default,null,w),this.coreComponents=w}var v=a.prototype;return v.createController=function(l,s,n){if(l){var i=s?new l(this,s):new l(this);return n&&n.push(i),i}return null},v.on=function(l,s,n){n===void 0&&(n=this),this._emitter.on(l,s,n)},v.once=function(l,s,n){n===void 0&&(n=this),this._emitter.once(l,s,n)},v.removeAllListeners=function(l){this._emitter.removeAllListeners(l)},v.off=function(l,s,n,i){n===void 0&&(n=this),this._emitter.off(l,s,n,i)},v.listeners=function(l){return this._emitter.listeners(l)},v.emit=function(l,s,n){return this._emitter.emit(l,s,n)},v.trigger=function(l,s){if(this.config.debug)return this.emit(l,l,s);try{return this.emit(l,l,s)}catch(n){p.logger.error("An internal error happened while handling event "+l+'. Error message: "'+n.message+'". Here is a stacktrace:',n),this.trigger(t.Events.ERROR,{type:r.ErrorTypes.OTHER_ERROR,details:r.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:l,error:n})}return!1},v.listenerCount=function(l){return this._emitter.listenerCount(l)},v.destroy=function(){p.logger.log("destroy"),this.trigger(t.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(l){return l.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(l){return l.destroy()}),this.coreComponents.length=0},v.attachMedia=function(l){p.logger.log("attachMedia"),this._media=l,this.trigger(t.Events.MEDIA_ATTACHING,{media:l})},v.detachMedia=function(){p.logger.log("detachMedia"),this.trigger(t.Events.MEDIA_DETACHING,void 0),this._media=null},v.loadSource=function(l){this.stopLoad();var s=this.media,n=this.url,i=this.url=M.buildAbsoluteURL(self.location.href,l,{alwaysNormalize:!0});p.logger.log("loadSource:"+i),s&&n&&n!==i&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(s)),this.trigger(t.Events.MANIFEST_LOADING,{url:l})},v.startLoad=function(l){l===void 0&&(l=-1),p.logger.log("startLoad("+l+")"),this.networkControllers.forEach(function(s){s.startLoad(l)})},v.stopLoad=function(){p.logger.log("stopLoad"),this.networkControllers.forEach(function(l){l.stopLoad()})},v.swapAudioCodec=function(){p.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},v.recoverMediaError=function(){p.logger.log("recoverMediaError");var l=this._media;this.detachMedia(),l&&this.attachMedia(l)},v.removeLevel=function(l,s){s===void 0&&(s=0),this.levelController.removeLevel(l,s)},f(a,[{key:"levels",get:function(){var l=this.levelController.levels;return l||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(l){p.logger.log("set currentLevel:"+l),this.loadLevel=l,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(l){p.logger.log("set nextLevel:"+l),this.levelController.manualLevel=l,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(l){p.logger.log("set loadLevel:"+l),this.levelController.manualLevel=l}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(l){this.levelController.nextLoadLevel=l}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(l){p.logger.log("set firstLevel:"+l),this.levelController.firstLevel=l}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(l){p.logger.log("set startLevel:"+l),l!==-1&&(l=Math.max(l,this.minAutoLevel)),this.levelController.startLevel=l}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(l){var s=!!l;s!==this.config.capLevelToPlayerSize&&(s?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=s)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(l){this._autoLevelCapping!==l&&(p.logger.log("set autoLevelCapping:"+l),this._autoLevelCapping=l)}},{key:"bandwidthEstimate",get:function(){var l=this.abrController.bwEstimator;return l?l.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var l=this.levels,s=this.config.minAutoBitrate;if(!l)return 0;for(var n=l.length,i=0;i<n;i++)if(l[i].maxBitrate>s)return i;return 0}},{key:"maxAutoLevel",get:function(){var l=this.levels,s=this.autoLevelCapping,n;return s===-1&&l&&l.length?n=l.length-1:n=s,n}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(l){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,l)}},{key:"audioTracks",get:function(){var l=this.audioTrackController;return l?l.audioTracks:[]}},{key:"audioTrack",get:function(){var l=this.audioTrackController;return l?l.audioTrack:-1},set:function(l){var s=this.audioTrackController;s&&(s.audioTrack=l)}},{key:"subtitleTracks",get:function(){var l=this.subtitleTrackController;return l?l.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var l=this.subtitleTrackController;return l?l.subtitleTrack:-1},set:function(l){var s=this.subtitleTrackController;s&&(s.subtitleTrack=l)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var l=this.subtitleTrackController;return l?l.subtitleDisplay:!1},set:function(l){var s=this.subtitleTrackController;s&&(s.subtitleDisplay=l)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(l){this.config.lowLatencyMode=l}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}],[{key:"version",get:function(){return"1.1.5"}},{key:"Events",get:function(){return t.Events}},{key:"ErrorTypes",get:function(){return r.ErrorTypes}},{key:"ErrorDetails",get:function(){return r.ErrorDetails}},{key:"DefaultConfig",get:function(){return a.defaultConfig?a.defaultConfig:E.hlsDefaultConfig},set:function(l){a.defaultConfig=l}}]),a}();o.defaultConfig=void 0},"./src/is-supported.ts":function(G,F,T){"use strict";T.r(F),T.d(F,"isSupported",function(){return D}),T.d(F,"changeTypeSupported",function(){return b});var M=T("./src/utils/mediasource-helper.ts");function O(){return self.SourceBuffer||self.WebKitSourceBuffer}function D(){var C=Object(M.getMediaSource)();if(!C)return!1;var I=O(),A=C&&typeof C.isTypeSupported=="function"&&C.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),g=!I||I.prototype&&typeof I.prototype.appendBuffer=="function"&&typeof I.prototype.remove=="function";return!!A&&!!g}function b(){var C,I=O();return typeof(I==null||(C=I.prototype)===null||C===void 0?void 0:C.changeType)=="function"}},"./src/loader/fragment-loader.ts":function(G,F,T){"use strict";T.r(F),T.d(F,"default",function(){return p}),T.d(F,"LoadError",function(){return m});var M=T("./src/polyfills/number.ts"),O=T("./src/errors.ts");function D(u,t){u.prototype=Object.create(t.prototype),u.prototype.constructor=u,g(u,t)}function b(u){var t=typeof Map=="function"?new Map:void 0;return b=function(e){if(e===null||!A(e))return e;if(typeof e!="function")throw new TypeError("Super expression must either be null or a function");if(typeof t<"u"){if(t.has(e))return t.get(e);t.set(e,f)}function f(){return C(e,arguments,y(this).constructor)}return f.prototype=Object.create(e.prototype,{constructor:{value:f,enumerable:!1,writable:!0,configurable:!0}}),g(f,e)},b(u)}function C(u,t,r){return I()?C=Reflect.construct:C=function(f,o,a){var v=[null];v.push.apply(v,o);var h=Function.bind.apply(f,v),l=new h;return a&&g(l,a.prototype),l},C.apply(null,arguments)}function I(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function A(u){return Function.toString.call(u).indexOf("[native code]")!==-1}function g(u,t){return g=Object.setPrototypeOf||function(e,f){return e.__proto__=f,e},g(u,t)}function y(u){return y=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},y(u)}var L=Math.pow(2,17),p=function(){function u(r){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=r}var t=u.prototype;return t.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},t.abort=function(){this.loader&&this.loader.abort()},t.load=function(e,f){var o=this,a=e.url;if(!a)return Promise.reject(new m({type:O.ErrorTypes.NETWORK_ERROR,details:O.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:e,networkDetails:null},"Fragment does not have a "+(a?"part list":"url")));this.abort();var v=this.config,h=v.fLoader,l=v.loader;return new Promise(function(s,n){o.loader&&o.loader.destroy();var i=o.loader=e.loader=h?new h(v):new l(v),d=E(e),c={timeout:v.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:v.fragLoadingMaxRetryTimeout,highWaterMark:L};e.stats=i.stats,i.load(d,c,{onSuccess:function(R,P,B,x){o.resetLoader(e,i),s({frag:e,part:null,payload:R.data,networkDetails:x})},onError:function(R,P,B){o.resetLoader(e,i),n(new m({type:O.ErrorTypes.NETWORK_ERROR,details:O.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:R,networkDetails:B}))},onAbort:function(R,P,B){o.resetLoader(e,i),n(new m({type:O.ErrorTypes.NETWORK_ERROR,details:O.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:e,networkDetails:B}))},onTimeout:function(R,P,B){o.resetLoader(e,i),n(new m({type:O.ErrorTypes.NETWORK_ERROR,details:O.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,networkDetails:B}))},onProgress:function(R,P,B,x){f&&f({frag:e,part:null,payload:B,networkDetails:x})}})})},t.loadPart=function(e,f,o){var a=this;this.abort();var v=this.config,h=v.fLoader,l=v.loader;return new Promise(function(s,n){a.loader&&a.loader.destroy();var i=a.loader=e.loader=h?new h(v):new l(v),d=E(e,f),c={timeout:v.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:v.fragLoadingMaxRetryTimeout,highWaterMark:L};f.stats=i.stats,i.load(d,c,{onSuccess:function(R,P,B,x){a.resetLoader(e,i),a.updateStatsFromPart(e,f);var U={frag:e,part:f,payload:R.data,networkDetails:x};o(U),s(U)},onError:function(R,P,B){a.resetLoader(e,i),n(new m({type:O.ErrorTypes.NETWORK_ERROR,details:O.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:f,response:R,networkDetails:B}))},onAbort:function(R,P,B){e.stats.aborted=f.stats.aborted,a.resetLoader(e,i),n(new m({type:O.ErrorTypes.NETWORK_ERROR,details:O.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:e,part:f,networkDetails:B}))},onTimeout:function(R,P,B){a.resetLoader(e,i),n(new m({type:O.ErrorTypes.NETWORK_ERROR,details:O.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:f,networkDetails:B}))}})})},t.updateStatsFromPart=function(e,f){var o=e.stats,a=f.stats,v=a.total;if(o.loaded+=a.loaded,v){var h=Math.round(e.duration/f.duration),l=Math.min(Math.round(o.loaded/v),h),s=h-l,n=s*Math.round(o.loaded/l);o.total=o.loaded+n}else o.total=Math.max(o.loaded,o.total);var i=o.loading,d=a.loading;i.start?i.first+=d.first-d.start:(i.start=d.start,i.first=d.first),i.end=d.end},t.resetLoader=function(e,f){e.loader=null,this.loader===f&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),f.destroy()},u}();function E(u,t){t===void 0&&(t=null);var r=t||u,e={frag:u,part:t,responseType:"arraybuffer",url:r.url,headers:{},rangeStart:0,rangeEnd:0},f=r.byteRangeStartOffset,o=r.byteRangeEndOffset;return Object(M.isFiniteNumber)(f)&&Object(M.isFiniteNumber)(o)&&(e.rangeStart=f,e.rangeEnd=o),e}var m=function(u){D(t,u);function t(r){for(var e,f=arguments.length,o=new Array(f>1?f-1:0),a=1;a<f;a++)o[a-1]=arguments[a];return e=u.call.apply(u,[this].concat(o))||this,e.data=void 0,e.data=r,e}return t}(b(Error))},"./src/loader/fragment.ts":function(G,F,T){"use strict";T.r(F),T.d(F,"ElementaryStreamTypes",function(){return p}),T.d(F,"BaseSegment",function(){return E}),T.d(F,"Fragment",function(){return m}),T.d(F,"Part",function(){return u});var M=T("./src/polyfills/number.ts"),O=T("./node_modules/url-toolkit/src/url-toolkit.js"),D=T.n(O),b=T("./src/utils/logger.ts"),C=T("./src/loader/level-key.ts"),I=T("./src/loader/load-stats.ts");function A(t,r){t.prototype=Object.create(r.prototype),t.prototype.constructor=t,g(t,r)}function g(t,r){return g=Object.setPrototypeOf||function(f,o){return f.__proto__=o,f},g(t,r)}function y(t,r){for(var e=0;e<r.length;e++){var f=r[e];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(t,f.key,f)}}function L(t,r,e){return r&&y(t.prototype,r),e&&y(t,e),t}var p;(function(t){t.AUDIO="audio",t.VIDEO="video",t.AUDIOVIDEO="audiovideo"})(p||(p={}));var E=function(){function t(e){var f;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=(f={},f[p.AUDIO]=null,f[p.VIDEO]=null,f[p.AUDIOVIDEO]=null,f),this.baseurl=e}var r=t.prototype;return r.setByteRange=function(f,o){var a=f.split("@",2),v=[];a.length===1?v[0]=o?o.byteRangeEndOffset:0:v[0]=parseInt(a[1]),v[1]=parseInt(a[0])+v[0],this._byteRange=v},L(t,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Object(O.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(f){this._url=f}}]),t}(),m=function(t){A(r,t);function r(f,o){var a;return a=t.call(this,o)||this,a._decryptdata=null,a.rawProgramDateTime=null,a.programDateTime=null,a.tagList=[],a.duration=0,a.sn=0,a.levelkey=void 0,a.type=void 0,a.loader=null,a.level=-1,a.cc=0,a.startPTS=void 0,a.endPTS=void 0,a.appendedPTS=void 0,a.startDTS=void 0,a.endDTS=void 0,a.start=0,a.deltaPTS=void 0,a.maxStartPTS=void 0,a.minEndPTS=void 0,a.stats=new I.LoadStats,a.urlId=0,a.data=void 0,a.bitrateTest=!1,a.title=null,a.initSegment=null,a.type=f,a}var e=r.prototype;return e.createInitializationVector=function(o){for(var a=new Uint8Array(16),v=12;v<16;v++)a[v]=o>>8*(15-v)&255;return a},e.setDecryptDataFromLevelKey=function(o,a){var v=o;return(o==null?void 0:o.method)==="AES-128"&&o.uri&&!o.iv&&(v=C.LevelKey.fromURI(o.uri),v.method=o.method,v.iv=this.createInitializationVector(a),v.keyFormat="identity"),v},e.setElementaryStreamInfo=function(o,a,v,h,l,s){s===void 0&&(s=!1);var n=this.elementaryStreams,i=n[o];if(!i){n[o]={startPTS:a,endPTS:v,startDTS:h,endDTS:l,partial:s};return}i.startPTS=Math.min(i.startPTS,a),i.endPTS=Math.max(i.endPTS,v),i.startDTS=Math.min(i.startDTS,h),i.endDTS=Math.max(i.endDTS,l)},e.clearElementaryStreamInfo=function(){var o=this.elementaryStreams;o[p.AUDIO]=null,o[p.VIDEO]=null,o[p.AUDIOVIDEO]=null},L(r,[{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var o=this.sn;typeof o!="number"&&(this.levelkey&&this.levelkey.method==="AES-128"&&!this.levelkey.iv&&b.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),o=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,o)}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null||!Object(M.isFiniteNumber)(this.programDateTime))return null;var o=Object(M.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+o*1e3}},{key:"encrypted",get:function(){var o;return!!((o=this.decryptdata)!==null&&o!==void 0&&o.keyFormat&&this.decryptdata.uri)}}]),r}(E),u=function(t){A(r,t);function r(e,f,o,a,v){var h;h=t.call(this,o)||this,h.fragOffset=0,h.duration=0,h.gap=!1,h.independent=!1,h.relurl=void 0,h.fragment=void 0,h.index=void 0,h.stats=new I.LoadStats,h.duration=e.decimalFloatingPoint("DURATION"),h.gap=e.bool("GAP"),h.independent=e.bool("INDEPENDENT"),h.relurl=e.enumeratedString("URI"),h.fragment=f,h.index=a;var l=e.enumeratedString("BYTERANGE");return l&&h.setByteRange(l,v),v&&(h.fragOffset=v.fragOffset+v.duration),h}return L(r,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var f=this.elementaryStreams;return!!(f.audio||f.video||f.audiovideo)}}]),r}(E)},"./src/loader/key-loader.ts":function(G,F,T){"use strict";T.r(F),T.d(F,"default",function(){return b});var M=T("./src/events.ts"),O=T("./src/errors.ts"),D=T("./src/utils/logger.ts"),b=function(){function C(A){this.hls=void 0,this.loaders={},this.decryptkey=null,this.decrypturl=null,this.hls=A,this._registerListeners()}var I=C.prototype;return I._registerListeners=function(){this.hls.on(M.Events.KEY_LOADING,this.onKeyLoading,this)},I._unregisterListeners=function(){this.hls.off(M.Events.KEY_LOADING,this.onKeyLoading)},I.destroy=function(){this._unregisterListeners();for(var g in this.loaders){var y=this.loaders[g];y&&y.destroy()}this.loaders={}},I.onKeyLoading=function(g,y){var L=y.frag,p=L.type,E=this.loaders[p];if(!L.decryptdata){D.logger.warn("Missing decryption data on fragment in onKeyLoading");return}var m=L.decryptdata.uri;if(m!==this.decrypturl||this.decryptkey===null){var u=this.hls.config;if(E&&(D.logger.warn("abort previous key loader for type:"+p),E.abort()),!m){D.logger.warn("key uri is falsy");return}var t=u.loader,r=L.loader=this.loaders[p]=new t(u);this.decrypturl=m,this.decryptkey=null;var e={url:m,frag:L,responseType:"arraybuffer"},f={timeout:u.fragLoadingTimeOut,maxRetry:0,retryDelay:u.fragLoadingRetryDelay,maxRetryDelay:u.fragLoadingMaxRetryTimeout,highWaterMark:0},o={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};r.load(e,f,o)}else this.decryptkey&&(L.decryptdata.key=this.decryptkey,this.hls.trigger(M.Events.KEY_LOADED,{frag:L}))},I.loadsuccess=function(g,y,L){var p=L.frag;if(!p.decryptdata){D.logger.error("after key load, decryptdata unset");return}this.decryptkey=p.decryptdata.key=new Uint8Array(g.data),p.loader=null,delete this.loaders[p.type],this.hls.trigger(M.Events.KEY_LOADED,{frag:p})},I.loaderror=function(g,y){var L=y.frag,p=L.loader;p&&p.abort(),delete this.loaders[L.type],this.hls.trigger(M.Events.ERROR,{type:O.ErrorTypes.NETWORK_ERROR,details:O.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:L,response:g})},I.loadtimeout=function(g,y){var L=y.frag,p=L.loader;p&&p.abort(),delete this.loaders[L.type],this.hls.trigger(M.Events.ERROR,{type:O.ErrorTypes.NETWORK_ERROR,details:O.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:L})},C}()},"./src/loader/level-details.ts":function(G,F,T){"use strict";T.r(F),T.d(F,"LevelDetails",function(){return C});var M=T("./src/polyfills/number.ts");function O(I,A){for(var g=0;g<A.length;g++){var y=A[g];y.enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(I,y.key,y)}}function D(I,A,g){return A&&O(I.prototype,A),g&&O(I,g),I}var b=10,C=function(){function I(g){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.fragments=[],this.url=g}var A=I.prototype;return A.reloaded=function(y){if(!y){this.advanced=!0,this.updated=!0;return}var L=this.lastPartSn-y.lastPartSn,p=this.lastPartIndex-y.lastPartIndex;this.updated=this.endSN!==y.endSN||!!p||!!L,this.advanced=this.endSN>y.endSN||L>0||L===0&&p>0,this.updated||this.advanced?this.misses=Math.floor(y.misses*.6):this.misses=y.misses+1,this.availabilityDelay=y.availabilityDelay},D(I,[{key:"hasProgramDateTime",get:function(){return this.fragments.length?Object(M.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime):!1}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||b}},{key:"drift",get:function(){var y=this.driftEndTime-this.driftStartTime;if(y>0){var L=this.driftEnd-this.driftStart;return L*1e3/y}return 1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var y;return(y=this.partList)!==null&&y!==void 0&&y.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var y;return(y=this.fragments)!==null&&y!==void 0&&y.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var y;return(y=this.partList)!==null&&y!==void 0&&y.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var y;return(y=this.partList)!==null&&y!==void 0&&y.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}]),I}()},"./src/loader/level-key.ts":function(G,F,T){"use strict";T.r(F),T.d(F,"LevelKey",function(){return C});var M=T("./node_modules/url-toolkit/src/url-toolkit.js"),O=T.n(M);function D(I,A){for(var g=0;g<A.length;g++){var y=A[g];y.enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(I,y.key,y)}}function b(I,A,g){return A&&D(I.prototype,A),g&&D(I,g),I}var C=function(){I.fromURL=function(g,y){return new I(g,y)},I.fromURI=function(g){return new I(g)};function I(A,g){this._uri=null,this.method=null,this.keyFormat=null,this.keyFormatVersions=null,this.keyID=null,this.key=null,this.iv=null,g?this._uri=Object(M.buildAbsoluteURL)(A,g,{alwaysNormalize:!0}):this._uri=A}return b(I,[{key:"uri",get:function(){return this._uri}}]),I}()},"./src/loader/load-stats.ts":function(G,F,T){"use strict";T.r(F),T.d(F,"LoadStats",function(){return M});var M=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},"./src/loader/m3u8-parser.ts":function(G,F,T){"use strict";T.r(F),T.d(F,"default",function(){return r});var M=T("./src/polyfills/number.ts"),O=T("./node_modules/url-toolkit/src/url-toolkit.js"),D=T.n(O),b=T("./src/loader/fragment.ts"),C=T("./src/loader/level-details.ts"),I=T("./src/loader/level-key.ts"),A=T("./src/utils/attr-list.ts"),g=T("./src/utils/logger.ts"),y=T("./src/utils/codecs.ts"),L=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+/g,p=/#EXT-X-MEDIA:(.*)/g,E=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),m=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(PLAYLIST-TYPE):(.+)/.source,/#EXT-X-(MEDIA-SEQUENCE): *(\d+)/.source,/#EXT-X-(SKIP):(.+)/.source,/#EXT-X-(TARGETDURATION): *(\d+)/.source,/#EXT-X-(KEY):(.+)/.source,/#EXT-X-(START):(.+)/.source,/#EXT-X-(ENDLIST)/.source,/#EXT-X-(DISCONTINUITY-SEQ)UENCE: *(\d+)/.source,/#EXT-X-(DIS)CONTINUITY/.source,/#EXT-X-(VERSION):(\d+)/.source,/#EXT-X-(MAP):(.+)/.source,/#EXT-X-(SERVER-CONTROL):(.+)/.source,/#EXT-X-(PART-INF):(.+)/.source,/#EXT-X-(GAP)/.source,/#EXT-X-(BITRATE):\s*(\d+)/.source,/#EXT-X-(PART):(.+)/.source,/#EXT-X-(PRELOAD-HINT):(.+)/.source,/#EXT-X-(RENDITION-REPORT):(.+)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),u=/\.(mp4|m4s|m4v|m4a)$/i;function t(v){var h,l;return u.test((h=(l=O.parseURL(v))===null||l===void 0?void 0:l.path)!=null?h:"")}var r=function(){function v(){}return v.findGroup=function(l,s){for(var n=0;n<l.length;n++){var i=l[n];if(i.id===s)return i}},v.convertAVC1ToAVCOTI=function(l){var s=l.split(".");if(s.length>2){var n=s.shift()+".";return n+=parseInt(s.shift()).toString(16),n+=("000"+parseInt(s.shift()).toString(16)).substr(-4),n}return l},v.resolve=function(l,s){return O.buildAbsoluteURL(s,l,{alwaysNormalize:!0})},v.parseMasterPlaylist=function(l,s){var n=[],i={},d=!1;L.lastIndex=0;for(var c;(c=L.exec(l))!=null;)if(c[1]){var S=new A.AttrList(c[1]),R={attrs:S,bitrate:S.decimalInteger("AVERAGE-BANDWIDTH")||S.decimalInteger("BANDWIDTH"),name:S.NAME,url:v.resolve(c[2],s)},P=S.decimalResolution("RESOLUTION");P&&(R.width=P.width,R.height=P.height),e((S.CODECS||"").split(/[ ,]+/).filter(function(x){return x}),R),R.videoCodec&&R.videoCodec.indexOf("avc1")!==-1&&(R.videoCodec=v.convertAVC1ToAVCOTI(R.videoCodec)),n.push(R)}else if(c[3]){var B=new A.AttrList(c[3]);B["DATA-ID"]&&(d=!0,i[B["DATA-ID"]]=B)}return{levels:n,sessionData:d?i:null}},v.parseMasterPlaylistMedia=function(l,s,n,i){i===void 0&&(i=[]);var d,c=[],S=0;for(p.lastIndex=0;(d=p.exec(l))!==null;){var R=new A.AttrList(d[1]);if(R.TYPE===n){var P={attrs:R,bitrate:0,id:S++,groupId:R["GROUP-ID"],instreamId:R["INSTREAM-ID"],name:R.NAME||R.LANGUAGE||"",type:n,default:R.bool("DEFAULT"),autoselect:R.bool("AUTOSELECT"),forced:R.bool("FORCED"),lang:R.LANGUAGE,url:R.URI?v.resolve(R.URI,s):""};if(i.length){var B=v.findGroup(i,P.groupId)||i[0];f(P,B,"audioCodec"),f(P,B,"textCodec")}c.push(P)}}return c},v.parseLevelPlaylist=function(l,s,n,i,d){var c=new C.LevelDetails(s),S=c.fragments,R=null,P=0,B=0,x=0,U=0,k=null,N=new b.Fragment(i,s),K,W,w,H=-1,V=!1;for(E.lastIndex=0,c.m3u8=l;(K=E.exec(l))!==null;){V&&(V=!1,N=new b.Fragment(i,s),N.start=x,N.sn=P,N.cc=U,N.level=n,R&&(N.initSegment=R,N.rawProgramDateTime=R.rawProgramDateTime));var j=K[1];if(j){N.duration=parseFloat(j);var X=(" "+K[2]).slice(1);N.title=X||null,N.tagList.push(X?["INF",j,X]:["INF",j])}else if(K[3])Object(M.isFiniteNumber)(N.duration)&&(N.start=x,w&&(N.levelkey=w),N.sn=P,N.level=n,N.cc=U,N.urlId=d,S.push(N),N.relurl=(" "+K[3]).slice(1),a(N,k),k=N,x+=N.duration,P++,B=0,V=!0);else if(K[4]){var Y=(" "+K[4]).slice(1);k?N.setByteRange(Y,k):N.setByteRange(Y)}else if(K[5])N.rawProgramDateTime=(" "+K[5]).slice(1),N.tagList.push(["PROGRAM-DATE-TIME",N.rawProgramDateTime]),H===-1&&(H=S.length);else{if(K=K[0].match(m),!K){g.logger.warn("No matches on slow regex match for level playlist!");continue}for(W=1;W<K.length&&!(typeof K[W]<"u");W++);var $=(" "+K[W]).slice(1),_=(" "+K[W+1]).slice(1),z=K[W+2]?(" "+K[W+2]).slice(1):"";switch($){case"PLAYLIST-TYPE":c.type=_.toUpperCase();break;case"MEDIA-SEQUENCE":P=c.startSN=parseInt(_);break;case"SKIP":{var J=new A.AttrList(_),Q=J.decimalInteger("SKIPPED-SEGMENTS");if(Object(M.isFiniteNumber)(Q)){c.skippedSegments=Q;for(var et=Q;et--;)S.unshift(null);P+=Q}var Z=J.enumeratedString("RECENTLY-REMOVED-DATERANGES");Z&&(c.recentlyRemovedDateranges=Z.split("	"));break}case"TARGETDURATION":c.targetduration=parseFloat(_);break;case"VERSION":c.version=parseInt(_);break;case"EXTM3U":break;case"ENDLIST":c.live=!1;break;case"#":(_||z)&&N.tagList.push(z?[_,z]:[_]);break;case"DIS":U++;case"GAP":N.tagList.push([$]);break;case"BITRATE":N.tagList.push([$,_]);break;case"DISCONTINUITY-SEQ":U=parseInt(_);break;case"KEY":{var it,tt=new A.AttrList(_),at=tt.enumeratedString("METHOD"),rt=tt.URI,st=tt.hexadecimalInteger("IV"),ut=tt.enumeratedString("KEYFORMATVERSIONS"),q=tt.enumeratedString("KEYID"),ot=(it=tt.enumeratedString("KEYFORMAT"))!=null?it:"identity",vt=["com.apple.streamingkeydelivery","com.microsoft.playready","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine"];if(vt.indexOf(ot)>-1){g.logger.warn("Keyformat "+ot+" is not supported from the manifest");continue}else if(ot!=="identity")continue;at&&(w=I.LevelKey.fromURL(s,rt),rt&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(at)>=0&&(w.method=at,w.keyFormat=ot,q&&(w.keyID=q),ut&&(w.keyFormatVersions=ut),w.iv=st));break}case"START":{var gt=new A.AttrList(_),ht=gt.decimalFloatingPoint("TIME-OFFSET");Object(M.isFiniteNumber)(ht)&&(c.startTimeOffset=ht);break}case"MAP":{var ct=new A.AttrList(_);N.relurl=ct.URI,ct.BYTERANGE&&N.setByteRange(ct.BYTERANGE),N.level=n,N.sn="initSegment",w&&(N.levelkey=w),N.initSegment=null,R=N,V=!0;break}case"SERVER-CONTROL":{var lt=new A.AttrList(_);c.canBlockReload=lt.bool("CAN-BLOCK-RELOAD"),c.canSkipUntil=lt.optionalFloat("CAN-SKIP-UNTIL",0),c.canSkipDateRanges=c.canSkipUntil>0&&lt.bool("CAN-SKIP-DATERANGES"),c.partHoldBack=lt.optionalFloat("PART-HOLD-BACK",0),c.holdBack=lt.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{var Tt=new A.AttrList(_);c.partTarget=Tt.decimalFloatingPoint("PART-TARGET");break}case"PART":{var nt=c.partList;nt||(nt=c.partList=[]);var dt=B>0?nt[nt.length-1]:void 0,Lt=B++,mt=new b.Part(new A.AttrList(_),N,s,Lt,dt);nt.push(mt),N.duration+=mt.duration;break}case"PRELOAD-HINT":{var Et=new A.AttrList(_);c.preloadHint=Et;break}case"RENDITION-REPORT":{var At=new A.AttrList(_);c.renditionReports=c.renditionReports||[],c.renditionReports.push(At);break}default:g.logger.warn("line parsed but not handled: "+K);break}}}k&&!k.relurl?(S.pop(),x-=k.duration,c.partList&&(c.fragmentHint=k)):c.partList&&(a(N,k),N.cc=U,c.fragmentHint=N);var pt=S.length,ft=S[0],yt=S[pt-1];if(x+=c.skippedSegments*c.targetduration,x>0&&pt&&yt){c.averagetargetduration=x/pt;var Dt=yt.sn;c.endSN=Dt!=="initSegment"?Dt:0,ft&&(c.startCC=ft.cc,ft.initSegment||c.fragments.every(function(St){return St.relurl&&t(St.relurl)})&&(g.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),N=new b.Fragment(i,s),N.relurl=yt.relurl,N.level=n,N.sn="initSegment",ft.initSegment=N,c.needSidxRanges=!0))}else c.endSN=0,c.startCC=0;return c.fragmentHint&&(x+=c.fragmentHint.duration),c.totalduration=x,c.endCC=U,H>0&&o(S,H),c},v}();function e(v,h){["video","audio","text"].forEach(function(l){var s=v.filter(function(i){return Object(y.isCodecType)(i,l)});if(s.length){var n=s.filter(function(i){return i.lastIndexOf("avc1",0)===0||i.lastIndexOf("mp4a",0)===0});h[l+"Codec"]=n.length>0?n[0]:s[0],v=v.filter(function(i){return s.indexOf(i)===-1})}}),h.unknownCodecs=v}function f(v,h,l){var s=h[l];s&&(v[l]=s)}function o(v,h){for(var l=v[h],s=h;s--;){var n=v[s];if(!n)return;n.programDateTime=l.programDateTime-n.duration*1e3,l=n}}function a(v,h){v.rawProgramDateTime?v.programDateTime=Date.parse(v.rawProgramDateTime):h!=null&&h.programDateTime&&(v.programDateTime=h.endProgramDateTime),Object(M.isFiniteNumber)(v.programDateTime)||(v.programDateTime=null,v.rawProgramDateTime=null)}},"./src/loader/playlist-loader.ts":function(G,F,T){"use strict";T.r(F);var M=T("./src/polyfills/number.ts"),O=T("./src/events.ts"),D=T("./src/errors.ts"),b=T("./src/utils/logger.ts"),C=T("./src/utils/mp4-tools.ts"),I=T("./src/loader/m3u8-parser.ts"),A=T("./src/types/loader.ts"),g=T("./src/utils/attr-list.ts");function y(E){var m=E.type;switch(m){case A.PlaylistContextType.AUDIO_TRACK:return A.PlaylistLevelType.AUDIO;case A.PlaylistContextType.SUBTITLE_TRACK:return A.PlaylistLevelType.SUBTITLE;default:return A.PlaylistLevelType.MAIN}}function L(E,m){var u=E.url;return(u===void 0||u.indexOf("data:")===0)&&(u=m.url),u}var p=function(){function E(u){this.hls=void 0,this.loaders=Object.create(null),this.hls=u,this.registerListeners()}var m=E.prototype;return m.registerListeners=function(){var t=this.hls;t.on(O.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(O.Events.LEVEL_LOADING,this.onLevelLoading,this),t.on(O.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),t.on(O.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},m.unregisterListeners=function(){var t=this.hls;t.off(O.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(O.Events.LEVEL_LOADING,this.onLevelLoading,this),t.off(O.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),t.off(O.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},m.createInternalLoader=function(t){var r=this.hls.config,e=r.pLoader,f=r.loader,o=e||f,a=new o(r);return t.loader=a,this.loaders[t.type]=a,a},m.getInternalLoader=function(t){return this.loaders[t.type]},m.resetInternalLoader=function(t){this.loaders[t]&&delete this.loaders[t]},m.destroyInternalLoaders=function(){for(var t in this.loaders){var r=this.loaders[t];r&&r.destroy(),this.resetInternalLoader(t)}},m.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},m.onManifestLoading=function(t,r){var e=r.url;this.load({id:null,groupId:null,level:0,responseType:"text",type:A.PlaylistContextType.MANIFEST,url:e,deliveryDirectives:null})},m.onLevelLoading=function(t,r){var e=r.id,f=r.level,o=r.url,a=r.deliveryDirectives;this.load({id:e,groupId:null,level:f,responseType:"text",type:A.PlaylistContextType.LEVEL,url:o,deliveryDirectives:a})},m.onAudioTrackLoading=function(t,r){var e=r.id,f=r.groupId,o=r.url,a=r.deliveryDirectives;this.load({id:e,groupId:f,level:null,responseType:"text",type:A.PlaylistContextType.AUDIO_TRACK,url:o,deliveryDirectives:a})},m.onSubtitleTrackLoading=function(t,r){var e=r.id,f=r.groupId,o=r.url,a=r.deliveryDirectives;this.load({id:e,groupId:f,level:null,responseType:"text",type:A.PlaylistContextType.SUBTITLE_TRACK,url:o,deliveryDirectives:a})},m.load=function(t){var r,e=this.hls.config,f=this.getInternalLoader(t);if(f){var o=f.context;if(o&&o.url===t.url){b.logger.trace("[playlist-loader]: playlist request ongoing");return}b.logger.log("[playlist-loader]: aborting previous loader for type: "+t.type),f.abort()}var a,v,h,l;switch(t.type){case A.PlaylistContextType.MANIFEST:a=e.manifestLoadingMaxRetry,v=e.manifestLoadingTimeOut,h=e.manifestLoadingRetryDelay,l=e.manifestLoadingMaxRetryTimeout;break;case A.PlaylistContextType.LEVEL:case A.PlaylistContextType.AUDIO_TRACK:case A.PlaylistContextType.SUBTITLE_TRACK:a=0,v=e.levelLoadingTimeOut;break;default:a=e.levelLoadingMaxRetry,v=e.levelLoadingTimeOut,h=e.levelLoadingRetryDelay,l=e.levelLoadingMaxRetryTimeout;break}if(f=this.createInternalLoader(t),(r=t.deliveryDirectives)!==null&&r!==void 0&&r.part){var s;if(t.type===A.PlaylistContextType.LEVEL&&t.level!==null?s=this.hls.levels[t.level].details:t.type===A.PlaylistContextType.AUDIO_TRACK&&t.id!==null?s=this.hls.audioTracks[t.id].details:t.type===A.PlaylistContextType.SUBTITLE_TRACK&&t.id!==null&&(s=this.hls.subtitleTracks[t.id].details),s){var n=s.partTarget,i=s.targetduration;n&&i&&(v=Math.min(Math.max(n*3,i*.8)*1e3,v))}}var d={timeout:v,maxRetry:a,retryDelay:h,maxRetryDelay:l,highWaterMark:0},c={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};f.load(t,d,c)},m.loadsuccess=function(t,r,e,f){if(f===void 0&&(f=null),e.isSidxRequest){this.handleSidxRequest(t,e),this.handlePlaylistLoaded(t,r,e,f);return}this.resetInternalLoader(e.type);var o=t.data;if(o.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(t,e,"no EXTM3U delimiter",f);return}r.parsing.start=performance.now(),o.indexOf("#EXTINF:")>0||o.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(t,r,e,f):this.handleMasterPlaylist(t,r,e,f)},m.loaderror=function(t,r,e){e===void 0&&(e=null),this.handleNetworkError(r,e,!1,t)},m.loadtimeout=function(t,r,e){e===void 0&&(e=null),this.handleNetworkError(r,e,!0)},m.handleMasterPlaylist=function(t,r,e,f){var o=this.hls,a=t.data,v=L(t,e),h=I.default.parseMasterPlaylist(a,v),l=h.levels,s=h.sessionData;if(!l.length){this.handleManifestParsingError(t,e,"no level found in manifest",f);return}var n=l.map(function(P){return{id:P.attrs.AUDIO,audioCodec:P.audioCodec}}),i=l.map(function(P){return{id:P.attrs.SUBTITLES,textCodec:P.textCodec}}),d=I.default.parseMasterPlaylistMedia(a,v,"AUDIO",n),c=I.default.parseMasterPlaylistMedia(a,v,"SUBTITLES",i),S=I.default.parseMasterPlaylistMedia(a,v,"CLOSED-CAPTIONS");if(d.length){var R=d.some(function(P){return!P.url});!R&&l[0].audioCodec&&!l[0].attrs.AUDIO&&(b.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),d.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new g.AttrList({}),bitrate:0,url:""}))}o.trigger(O.Events.MANIFEST_LOADED,{levels:l,audioTracks:d,subtitles:c,captions:S,url:v,stats:r,networkDetails:f,sessionData:s})},m.handleTrackOrLevelPlaylist=function(t,r,e,f){var o=this.hls,a=e.id,v=e.level,h=e.type,l=L(t,e),s=Object(M.isFiniteNumber)(a)?a:0,n=Object(M.isFiniteNumber)(v)?v:s,i=y(e),d=I.default.parseLevelPlaylist(t.data,l,n,i,s);if(!d.fragments.length){o.trigger(O.Events.ERROR,{type:D.ErrorTypes.NETWORK_ERROR,details:D.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:l,reason:"no fragments found in level",level:typeof e.level=="number"?e.level:void 0});return}if(h===A.PlaylistContextType.MANIFEST){var c={attrs:new g.AttrList({}),bitrate:0,details:d,name:"",url:l};o.trigger(O.Events.MANIFEST_LOADED,{levels:[c],audioTracks:[],url:l,stats:r,networkDetails:f,sessionData:null})}if(r.parsing.end=performance.now(),d.needSidxRanges){var S,R=(S=d.fragments[0].initSegment)===null||S===void 0?void 0:S.url;this.load({url:R,isSidxRequest:!0,type:h,level:v,levelDetails:d,id:a,groupId:null,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer",deliveryDirectives:null});return}e.levelDetails=d,this.handlePlaylistLoaded(t,r,e,f)},m.handleSidxRequest=function(t,r){var e=Object(C.parseSegmentIndex)(new Uint8Array(t.data));if(!!e){var f=e.references,o=r.levelDetails;f.forEach(function(a,v){var h=a.info,l=o.fragments[v];l.byteRange.length===0&&l.setByteRange(String(1+h.end-h.start)+"@"+String(h.start)),l.initSegment&&l.initSegment.setByteRange(String(e.moovEndOffset)+"@0")})}},m.handleManifestParsingError=function(t,r,e,f){this.hls.trigger(O.Events.ERROR,{type:D.ErrorTypes.NETWORK_ERROR,details:D.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:r.type===A.PlaylistContextType.MANIFEST,url:t.url,reason:e,response:t,context:r,networkDetails:f})},m.handleNetworkError=function(t,r,e,f){e===void 0&&(e=!1),b.logger.warn("[playlist-loader]: A network "+(e?"timeout":"error")+" occurred while loading "+t.type+" level: "+t.level+" id: "+t.id+' group-id: "'+t.groupId+'"');var o=D.ErrorDetails.UNKNOWN,a=!1,v=this.getInternalLoader(t);switch(t.type){case A.PlaylistContextType.MANIFEST:o=e?D.ErrorDetails.MANIFEST_LOAD_TIMEOUT:D.ErrorDetails.MANIFEST_LOAD_ERROR,a=!0;break;case A.PlaylistContextType.LEVEL:o=e?D.ErrorDetails.LEVEL_LOAD_TIMEOUT:D.ErrorDetails.LEVEL_LOAD_ERROR,a=!1;break;case A.PlaylistContextType.AUDIO_TRACK:o=e?D.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:D.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,a=!1;break;case A.PlaylistContextType.SUBTITLE_TRACK:o=e?D.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:D.ErrorDetails.SUBTITLE_LOAD_ERROR,a=!1;break}v&&this.resetInternalLoader(t.type);var h={type:D.ErrorTypes.NETWORK_ERROR,details:o,fatal:a,url:t.url,loader:v,context:t,networkDetails:r};f&&(h.response=f),this.hls.trigger(O.Events.ERROR,h)},m.handlePlaylistLoaded=function(t,r,e,f){var o=e.type,a=e.level,v=e.id,h=e.groupId,l=e.loader,s=e.levelDetails,n=e.deliveryDirectives;if(!(s!=null&&s.targetduration)){this.handleManifestParsingError(t,e,"invalid target duration",f);return}if(!!l)switch(s.live&&(l.getCacheAge&&(s.ageHeader=l.getCacheAge()||0),(!l.getCacheAge||isNaN(s.ageHeader))&&(s.ageHeader=0)),o){case A.PlaylistContextType.MANIFEST:case A.PlaylistContextType.LEVEL:this.hls.trigger(O.Events.LEVEL_LOADED,{details:s,level:a||0,id:v||0,stats:r,networkDetails:f,deliveryDirectives:n});break;case A.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(O.Events.AUDIO_TRACK_LOADED,{details:s,id:v||0,groupId:h||"",stats:r,networkDetails:f,deliveryDirectives:n});break;case A.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(O.Events.SUBTITLE_TRACK_LOADED,{details:s,id:v||0,groupId:h||"",stats:r,networkDetails:f,deliveryDirectives:n});break}},E}();F.default=p},"./src/polyfills/number.ts":function(G,F,T){"use strict";T.r(F),T.d(F,"isFiniteNumber",function(){return M}),T.d(F,"MAX_SAFE_INTEGER",function(){return O});var M=Number.isFinite||function(D){return typeof D=="number"&&isFinite(D)},O=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/remux/aac-helper.ts":function(G,F,T){"use strict";T.r(F);var M=function(){function O(){}return O.getSilentFrame=function(b,C){switch(b){case"mp4a.40.2":if(C===1)return new Uint8Array([0,200,0,128,35,128]);if(C===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(C===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(C===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(C===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(C===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(C===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(C===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(C===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}},O}();F.default=M},"./src/remux/mp4-generator.ts":function(G,F,T){"use strict";T.r(F);var M=Math.pow(2,32)-1,O=function(){function D(){}return D.init=function(){D.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var C;for(C in D.types)D.types.hasOwnProperty(C)&&(D.types[C]=[C.charCodeAt(0),C.charCodeAt(1),C.charCodeAt(2),C.charCodeAt(3)]);var I=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),A=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);D.HDLR_TYPES={video:I,audio:A};var g=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),y=new Uint8Array([0,0,0,0,0,0,0,0]);D.STTS=D.STSC=D.STCO=y,D.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),D.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),D.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),D.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var L=new Uint8Array([105,115,111,109]),p=new Uint8Array([97,118,99,49]),E=new Uint8Array([0,0,0,1]);D.FTYP=D.box(D.types.ftyp,L,E,L,p),D.DINF=D.box(D.types.dinf,D.box(D.types.dref,g))},D.box=function(C){for(var I=8,A=arguments.length,g=new Array(A>1?A-1:0),y=1;y<A;y++)g[y-1]=arguments[y];for(var L=g.length,p=L;L--;)I+=g[L].byteLength;var E=new Uint8Array(I);for(E[0]=I>>24&255,E[1]=I>>16&255,E[2]=I>>8&255,E[3]=I&255,E.set(C,4),L=0,I=8;L<p;L++)E.set(g[L],I),I+=g[L].byteLength;return E},D.hdlr=function(C){return D.box(D.types.hdlr,D.HDLR_TYPES[C])},D.mdat=function(C){return D.box(D.types.mdat,C)},D.mdhd=function(C,I){I*=C;var A=Math.floor(I/(M+1)),g=Math.floor(I%(M+1));return D.box(D.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,C>>24&255,C>>16&255,C>>8&255,C&255,A>>24,A>>16&255,A>>8&255,A&255,g>>24,g>>16&255,g>>8&255,g&255,85,196,0,0]))},D.mdia=function(C){return D.box(D.types.mdia,D.mdhd(C.timescale,C.duration),D.hdlr(C.type),D.minf(C))},D.mfhd=function(C){return D.box(D.types.mfhd,new Uint8Array([0,0,0,0,C>>24,C>>16&255,C>>8&255,C&255]))},D.minf=function(C){return C.type==="audio"?D.box(D.types.minf,D.box(D.types.smhd,D.SMHD),D.DINF,D.stbl(C)):D.box(D.types.minf,D.box(D.types.vmhd,D.VMHD),D.DINF,D.stbl(C))},D.moof=function(C,I,A){return D.box(D.types.moof,D.mfhd(C),D.traf(A,I))},D.moov=function(C){for(var I=C.length,A=[];I--;)A[I]=D.trak(C[I]);return D.box.apply(null,[D.types.moov,D.mvhd(C[0].timescale,C[0].duration)].concat(A).concat(D.mvex(C)))},D.mvex=function(C){for(var I=C.length,A=[];I--;)A[I]=D.trex(C[I]);return D.box.apply(null,[D.types.mvex].concat(A))},D.mvhd=function(C,I){I*=C;var A=Math.floor(I/(M+1)),g=Math.floor(I%(M+1)),y=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,C>>24&255,C>>16&255,C>>8&255,C&255,A>>24,A>>16&255,A>>8&255,A&255,g>>24,g>>16&255,g>>8&255,g&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return D.box(D.types.mvhd,y)},D.sdtp=function(C){var I=C.samples||[],A=new Uint8Array(4+I.length),g,y;for(g=0;g<I.length;g++)y=I[g].flags,A[g+4]=y.dependsOn<<4|y.isDependedOn<<2|y.hasRedundancy;return D.box(D.types.sdtp,A)},D.stbl=function(C){return D.box(D.types.stbl,D.stsd(C),D.box(D.types.stts,D.STTS),D.box(D.types.stsc,D.STSC),D.box(D.types.stsz,D.STSZ),D.box(D.types.stco,D.STCO))},D.avc1=function(C){var I=[],A=[],g,y,L;for(g=0;g<C.sps.length;g++)y=C.sps[g],L=y.byteLength,I.push(L>>>8&255),I.push(L&255),I=I.concat(Array.prototype.slice.call(y));for(g=0;g<C.pps.length;g++)y=C.pps[g],L=y.byteLength,A.push(L>>>8&255),A.push(L&255),A=A.concat(Array.prototype.slice.call(y));var p=D.box(D.types.avcC,new Uint8Array([1,I[3],I[4],I[5],255,224|C.sps.length].concat(I).concat([C.pps.length]).concat(A))),E=C.width,m=C.height,u=C.pixelRatio[0],t=C.pixelRatio[1];return D.box(D.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,E>>8&255,E&255,m>>8&255,m&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),p,D.box(D.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),D.box(D.types.pasp,new Uint8Array([u>>24,u>>16&255,u>>8&255,u&255,t>>24,t>>16&255,t>>8&255,t&255])))},D.esds=function(C){var I=C.config.length;return new Uint8Array([0,0,0,0,3,23+I,0,1,0,4,15+I,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([I]).concat(C.config).concat([6,1,2]))},D.mp4a=function(C){var I=C.samplerate;return D.box(D.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,C.channelCount,0,16,0,0,0,0,I>>8&255,I&255,0,0]),D.box(D.types.esds,D.esds(C)))},D.mp3=function(C){var I=C.samplerate;return D.box(D.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,C.channelCount,0,16,0,0,0,0,I>>8&255,I&255,0,0]))},D.stsd=function(C){return C.type==="audio"?!C.isAAC&&C.codec==="mp3"?D.box(D.types.stsd,D.STSD,D.mp3(C)):D.box(D.types.stsd,D.STSD,D.mp4a(C)):D.box(D.types.stsd,D.STSD,D.avc1(C))},D.tkhd=function(C){var I=C.id,A=C.duration*C.timescale,g=C.width,y=C.height,L=Math.floor(A/(M+1)),p=Math.floor(A%(M+1));return D.box(D.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,I>>24&255,I>>16&255,I>>8&255,I&255,0,0,0,0,L>>24,L>>16&255,L>>8&255,L&255,p>>24,p>>16&255,p>>8&255,p&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,g>>8&255,g&255,0,0,y>>8&255,y&255,0,0]))},D.traf=function(C,I){var A=D.sdtp(C),g=C.id,y=Math.floor(I/(M+1)),L=Math.floor(I%(M+1));return D.box(D.types.traf,D.box(D.types.tfhd,new Uint8Array([0,0,0,0,g>>24,g>>16&255,g>>8&255,g&255])),D.box(D.types.tfdt,new Uint8Array([1,0,0,0,y>>24,y>>16&255,y>>8&255,y&255,L>>24,L>>16&255,L>>8&255,L&255])),D.trun(C,A.length+16+20+8+16+8+8),A)},D.trak=function(C){return C.duration=C.duration||4294967295,D.box(D.types.trak,D.tkhd(C),D.mdia(C))},D.trex=function(C){var I=C.id;return D.box(D.types.trex,new Uint8Array([0,0,0,0,I>>24,I>>16&255,I>>8&255,I&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},D.trun=function(C,I){var A=C.samples||[],g=A.length,y=12+16*g,L=new Uint8Array(y),p,E,m,u,t,r;for(I+=8+y,L.set([0,0,15,1,g>>>24&255,g>>>16&255,g>>>8&255,g&255,I>>>24&255,I>>>16&255,I>>>8&255,I&255],0),p=0;p<g;p++)E=A[p],m=E.duration,u=E.size,t=E.flags,r=E.cts,L.set([m>>>24&255,m>>>16&255,m>>>8&255,m&255,u>>>24&255,u>>>16&255,u>>>8&255,u&255,t.isLeading<<2|t.dependsOn,t.isDependedOn<<6|t.hasRedundancy<<4|t.paddingValue<<1|t.isNonSync,t.degradPrio&240<<8,t.degradPrio&15,r>>>24&255,r>>>16&255,r>>>8&255,r&255],12+16*p);return D.box(D.types.trun,L)},D.initSegment=function(C){D.types||D.init();var I=D.moov(C),A=new Uint8Array(D.FTYP.byteLength+I.byteLength);return A.set(D.FTYP),A.set(I,D.FTYP.byteLength),A},D}();O.types=void 0,O.HDLR_TYPES=void 0,O.STTS=void 0,O.STSC=void 0,O.STCO=void 0,O.STSZ=void 0,O.VMHD=void 0,O.SMHD=void 0,O.STSD=void 0,O.FTYP=void 0,O.DINF=void 0,F.default=O},"./src/remux/mp4-remuxer.ts":function(G,F,T){"use strict";T.r(F),T.d(F,"default",function(){return r}),T.d(F,"normalizePts",function(){return e});var M=T("./src/polyfills/number.ts"),O=T("./src/remux/aac-helper.ts"),D=T("./src/remux/mp4-generator.ts"),b=T("./src/events.ts"),C=T("./src/errors.ts"),I=T("./src/utils/logger.ts"),A=T("./src/types/loader.ts"),g=T("./src/utils/timescale-conversion.ts");function y(){return y=Object.assign||function(v){for(var h=1;h<arguments.length;h++){var l=arguments[h];for(var s in l)Object.prototype.hasOwnProperty.call(l,s)&&(v[s]=l[s])}return v},y.apply(this,arguments)}var L=10*1e3,p=1024,E=1152,m=null,u=null,t=!1,r=function(){function v(l,s,n,i){if(i===void 0&&(i=""),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=l,this.config=s,this.typeSupported=n,this.ISGenerated=!1,m===null){var d=navigator.userAgent||"",c=d.match(/Chrome\/(\d+)/i);m=c?parseInt(c[1]):0}if(u===null){var S=navigator.userAgent.match(/Safari\/(\d+)/i);u=S?parseInt(S[1]):0}t=!!m&&m<75||!!u&&u<600}var h=v.prototype;return h.destroy=function(){},h.resetTimeStamp=function(s){I.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=s},h.resetNextTimestamp=function(){I.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},h.resetInitSegment=function(){I.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},h.getVideoStartPts=function(s){var n=!1,i=s.reduce(function(d,c){var S=c.pts-d;return S<-4294967296?(n=!0,e(d,c.pts)):S>0?d:c.pts},s[0].pts);return n&&I.logger.debug("PTS rollover detected"),i},h.remux=function(s,n,i,d,c,S,R,P){var B,x,U,k,N,K,W=c,w=c,H=s.pid>-1,V=n.pid>-1,j=n.samples.length,X=s.samples.length>0,Y=j>1,$=(!H||X)&&(!V||Y)||this.ISGenerated||R;if($){this.ISGenerated||(U=this.generateIS(s,n,c));var _=this.isVideoContiguous,z=-1;if(Y&&(z=f(n.samples),!_&&this.config.forceKeyFrameOnDiscontinuity))if(K=!0,z>0){I.logger.warn("[mp4-remuxer]: Dropped "+z+" out of "+j+" video samples due to a missing keyframe");var J=this.getVideoStartPts(n.samples);n.samples=n.samples.slice(z),n.dropped+=z,w+=(n.samples[0].pts-J)/(n.timescale||9e4)}else z===-1&&(I.logger.warn("[mp4-remuxer]: No keyframe found out of "+j+" video samples"),K=!1);if(this.ISGenerated){if(X&&Y){var Q=this.getVideoStartPts(n.samples),et=e(s.samples[0].pts,Q)-Q,Z=et/n.inputTimeScale;W+=Math.max(0,Z),w+=Math.max(0,-Z)}if(X){if(s.samplerate||(I.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),U=this.generateIS(s,n,c)),x=this.remuxAudio(s,W,this.isAudioContiguous,S,V||Y||P===A.PlaylistLevelType.AUDIO?w:void 0),Y){var it=x?x.endPTS-x.startPTS:0;n.inputTimeScale||(I.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),U=this.generateIS(s,n,c)),B=this.remuxVideo(n,w,_,it)}}else Y&&(B=this.remuxVideo(n,w,_,0));B&&(B.firstKeyFrame=z,B.independent=z!==-1)}}return this.ISGenerated&&(i.samples.length&&(N=this.remuxID3(i,c)),d.samples.length&&(k=this.remuxText(d,c))),{audio:x,video:B,initSegment:U,independent:K,text:k,id3:N}},h.generateIS=function(s,n,i){var d=s.samples,c=n.samples,S=this.typeSupported,R={},P=!Object(M.isFiniteNumber)(this._initPTS),B="audio/mp4",x,U,k;if(P&&(x=U=1/0),s.config&&d.length&&(s.timescale=s.samplerate,s.isAAC||(S.mpeg?(B="audio/mpeg",s.codec=""):S.mp3&&(s.codec="mp3")),R.audio={id:"audio",container:B,codec:s.codec,initSegment:!s.isAAC&&S.mpeg?new Uint8Array(0):D.default.initSegment([s]),metadata:{channelCount:s.channelCount}},P&&(k=s.inputTimeScale,x=U=d[0].pts-Math.round(k*i))),n.sps&&n.pps&&c.length&&(n.timescale=n.inputTimeScale,R.video={id:"main",container:"video/mp4",codec:n.codec,initSegment:D.default.initSegment([n]),metadata:{width:n.width,height:n.height}},P)){k=n.inputTimeScale;var N=this.getVideoStartPts(c),K=Math.round(k*i);U=Math.min(U,e(c[0].dts,N)-K),x=Math.min(x,N-K)}if(Object.keys(R).length)return this.ISGenerated=!0,P&&(this._initPTS=x,this._initDTS=U),{tracks:R,initPTS:x,timescale:k}},h.remuxVideo=function(s,n,i,d){var c=s.inputTimeScale,S=s.samples,R=[],P=S.length,B=this._initPTS,x=this.nextAvcDts,U=8,k,N,K,W=Number.POSITIVE_INFINITY,w=Number.NEGATIVE_INFINITY,H=0,V=!1;if(!i||x===null){var j=n*c,X=S[0].pts-e(S[0].dts,S[0].pts);x=j-X}for(var Y=0;Y<P;Y++){var $=S[Y];if($.pts=e($.pts-B,x),$.dts=e($.dts-B,x),$.dts>$.pts){var _=18e3;H=Math.max(Math.min(H,$.pts-$.dts),-1*_)}$.dts<S[Y>0?Y-1:Y].dts&&(V=!0)}V&&S.sort(function(Rt,Pt){var Ut=Rt.dts-Pt.dts,Nt=Rt.pts-Pt.pts;return Ut||Nt}),N=S[0].dts,K=S[S.length-1].dts;var z=Math.round((K-N)/(P-1));if(H<0){if(H<z*-2){I.logger.warn("PTS < DTS detected in video samples, offsetting DTS from PTS by "+Object(g.toMsFromMpegTsClock)(-z,!0)+" ms");for(var J=H,Q=0;Q<P;Q++)S[Q].dts=J=Math.max(J,S[Q].pts-z),S[Q].pts=Math.max(J,S[Q].pts)}else{I.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Object(g.toMsFromMpegTsClock)(H,!0)+" ms to overcome this issue");for(var et=0;et<P;et++)S[et].dts=S[et].dts+H}N=S[0].dts}if(i){var Z=N-x,it=Z>z,tt=Z<-1;if(it||tt){it?I.logger.warn("AVC: "+Object(g.toMsFromMpegTsClock)(Z,!0)+" ms ("+Z+"dts) hole between fragments detected, filling it"):I.logger.warn("AVC: "+Object(g.toMsFromMpegTsClock)(-Z,!0)+" ms ("+Z+"dts) overlapping between fragments detected"),N=x;var at=S[0].pts-Z;S[0].dts=N,S[0].pts=at,I.logger.log("Video: First PTS/DTS adjusted: "+Object(g.toMsFromMpegTsClock)(at,!0)+"/"+Object(g.toMsFromMpegTsClock)(N,!0)+", delta: "+Object(g.toMsFromMpegTsClock)(Z,!0)+" ms")}}t&&(N=Math.max(0,N));for(var rt=0,st=0,ut=0;ut<P;ut++){for(var q=S[ut],ot=q.units,vt=ot.length,gt=0,ht=0;ht<vt;ht++)gt+=ot[ht].data.length;st+=gt,rt+=vt,q.length=gt,q.dts=Math.max(q.dts,N),q.pts=Math.max(q.pts,q.dts,0),W=Math.min(q.pts,W),w=Math.max(q.pts,w)}K=S[P-1].dts;var ct=st+4*rt+8,lt;try{lt=new Uint8Array(ct)}catch{this.observer.emit(b.Events.ERROR,b.Events.ERROR,{type:C.ErrorTypes.MUX_ERROR,details:C.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:ct,reason:"fail allocating video mdat "+ct});return}var Tt=new DataView(lt.buffer);Tt.setUint32(0,ct),lt.set(D.default.types.mdat,4);for(var nt=0;nt<P;nt++){for(var dt=S[nt],Lt=dt.units,mt=0,Et=0,At=Lt.length;Et<At;Et++){var pt=Lt[Et],ft=pt.data,yt=pt.data.byteLength;Tt.setUint32(U,yt),U+=4,lt.set(ft,U),U+=yt,mt+=4+yt}if(nt<P-1)k=S[nt+1].dts-dt.dts;else{var Dt=this.config,St=dt.dts-S[nt>0?nt-1:nt].dts;if(Dt.stretchShortVideoTrack&&this.nextAudioPts!==null){var Mt=Math.floor(Dt.maxBufferHole*c),Ot=(d?W+d*c:this.nextAudioPts)-dt.pts;Ot>Mt?(k=Ot-St,k<0&&(k=St),I.logger.log("[mp4-remuxer]: It is approximately "+Ot/90+" ms to the next segment; using duration "+k/90+" ms for the last video frame.")):k=St}else k=St}var bt=Math.round(dt.pts-dt.dts);R.push(new o(dt.key,k,mt,bt))}if(R.length&&m&&m<70){var It=R[0].flags;It.dependsOn=2,It.isNonSync=0}console.assert(k!==void 0,"mp4SampleDuration must be computed"),this.nextAvcDts=x=K+k,this.isVideoContiguous=!0;var Ft=D.default.moof(s.sequenceNumber++,N,y({},s,{samples:R})),Bt="video",xt={data1:Ft,data2:lt,startPTS:W/c,endPTS:(w+k)/c,startDTS:N/c,endDTS:x/c,type:Bt,hasAudio:!1,hasVideo:!0,nb:R.length,dropped:s.dropped};return s.samples=[],s.dropped=0,console.assert(lt.length,"MDAT length must not be zero"),xt},h.remuxAudio=function(s,n,i,d,c){var S=s.inputTimeScale,R=s.samplerate?s.samplerate:S,P=S/R,B=s.isAAC?p:E,x=B*P,U=this._initPTS,k=!s.isAAC&&this.typeSupported.mpeg,N=[],K=s.samples,W=k?0:8,w=this.nextAudioPts||-1,H=n*S;if(this.isAudioContiguous=i=i||K.length&&w>0&&(d&&Math.abs(H-w)<9e3||Math.abs(e(K[0].pts-U,H)-w)<20*x),K.forEach(function(ft){ft.pts=e(ft.pts-U,H)}),!i||w<0){if(K=K.filter(function(ft){return ft.pts>=0}),!K.length)return;c===0?w=0:d?w=Math.max(0,H):w=K[0].pts}if(s.isAAC)for(var V=c!==void 0,j=this.config.maxAudioFramesDrift,X=0,Y=w;X<K.length;X++){var $=K[X],_=$.pts,z=_-Y,J=Math.abs(1e3*z/S);if(z<=-j*x&&V)X===0&&(I.logger.warn("Audio frame @ "+(_/S).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*z/S)+" ms."),this.nextAudioPts=w=Y=_);else if(z>=j*x&&J<L&&V){var Q=Math.round(z/x);Y=_-Q*x,Y<0&&(Q--,Y+=x),X===0&&(this.nextAudioPts=w=Y),I.logger.warn("[mp4-remuxer]: Injecting "+Q+" audio frame @ "+(Y/S).toFixed(3)+"s due to "+Math.round(1e3*z/S)+" ms gap.");for(var et=0;et<Q;et++){var Z=Math.max(Y,0),it=O.default.getSilentFrame(s.manifestCodec||s.codec,s.channelCount);it||(I.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),it=$.unit.subarray()),K.splice(X,0,{unit:it,pts:Z}),Y+=x,X++}}$.pts=Y,Y+=x}for(var tt=null,at=null,rt,st=0,ut=K.length;ut--;)st+=K[ut].unit.byteLength;for(var q=0,ot=K.length;q<ot;q++){var vt=K[q],gt=vt.unit,ht=vt.pts;if(at!==null){var ct=N[q-1];ct.duration=Math.round((ht-at)/P)}else if(i&&s.isAAC&&(ht=w),tt=ht,st>0){st+=W;try{rt=new Uint8Array(st)}catch{this.observer.emit(b.Events.ERROR,b.Events.ERROR,{type:C.ErrorTypes.MUX_ERROR,details:C.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:st,reason:"fail allocating audio mdat "+st});return}if(!k){var lt=new DataView(rt.buffer);lt.setUint32(0,st),rt.set(D.default.types.mdat,4)}}else return;rt.set(gt,W);var Tt=gt.byteLength;W+=Tt,N.push(new o(!0,B,Tt,0)),at=ht}var nt=N.length;if(!!nt){var dt=N[N.length-1];this.nextAudioPts=w=at+P*dt.duration;var Lt=k?new Uint8Array(0):D.default.moof(s.sequenceNumber++,tt/P,y({},s,{samples:N}));s.samples=[];var mt=tt/S,Et=w/S,At="audio",pt={data1:Lt,data2:rt,startPTS:mt,endPTS:Et,startDTS:mt,endDTS:Et,type:At,hasAudio:!0,hasVideo:!1,nb:nt};return this.isAudioContiguous=!0,console.assert(rt.length,"MDAT length must not be zero"),pt}},h.remuxEmptyAudio=function(s,n,i,d){var c=s.inputTimeScale,S=s.samplerate?s.samplerate:c,R=c/S,P=this.nextAudioPts,B=(P!==null?P:d.startDTS*c)+this._initDTS,x=d.endDTS*c+this._initDTS,U=R*p,k=Math.ceil((x-B)/U),N=O.default.getSilentFrame(s.manifestCodec||s.codec,s.channelCount);if(I.logger.warn("[mp4-remuxer]: remux empty Audio"),!N){I.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");return}for(var K=[],W=0;W<k;W++){var w=B+W*U;K.push({unit:N,pts:w,dts:w})}return s.samples=K,this.remuxAudio(s,n,i,!1)},h.remuxID3=function(s,n){var i=s.samples.length;if(!!i){for(var d=s.inputTimeScale,c=this._initPTS,S=this._initDTS,R=0;R<i;R++){var P=s.samples[R];P.pts=e(P.pts-c,n*d)/d,P.dts=e(P.dts-S,n*d)/d}var B=s.samples;return s.samples=[],{samples:B}}},h.remuxText=function(s,n){var i=s.samples.length;if(!!i){for(var d=s.inputTimeScale,c=this._initPTS,S=0;S<i;S++){var R=s.samples[S];R.pts=e(R.pts-c,n*d)/d}s.samples.sort(function(B,x){return B.pts-x.pts});var P=s.samples;return s.samples=[],{samples:P}}},v}();function e(v,h){var l;if(h===null)return v;for(h<v?l=-8589934592:l=8589934592;Math.abs(v-h)>4294967296;)v+=l;return v}function f(v){for(var h=0;h<v.length;h++)if(v[h].key)return h;return-1}var o=function(h,l,s,n){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=l,this.size=s,this.cts=n,this.flags=new a(h)},a=function(h){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=h?2:1,this.isNonSync=h?0:1}},"./src/remux/passthrough-remuxer.ts":function(G,F,T){"use strict";T.r(F);var M=T("./src/polyfills/number.ts"),O=T("./src/utils/mp4-tools.ts"),D=T("./src/loader/fragment.ts"),b=T("./src/utils/logger.ts"),C=function(){function g(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndDTS=null}var y=g.prototype;return y.destroy=function(){},y.resetTimeStamp=function(p){this.initPTS=p,this.lastEndDTS=null},y.resetNextTimestamp=function(){this.lastEndDTS=null},y.resetInitSegment=function(p,E,m){this.audioCodec=E,this.videoCodec=m,this.generateInitSegment(p),this.emitInitSegment=!0},y.generateInitSegment=function(p){var E=this.audioCodec,m=this.videoCodec;if(!p||!p.byteLength){this.initTracks=void 0,this.initData=void 0;return}var u=this.initData=Object(O.parseInitSegment)(p);E||(E=A(u.audio,D.ElementaryStreamTypes.AUDIO)),m||(m=A(u.video,D.ElementaryStreamTypes.VIDEO));var t={};u.audio&&u.video?t.audiovideo={container:"video/mp4",codec:E+","+m,initSegment:p,id:"main"}:u.audio?t.audio={container:"audio/mp4",codec:E,initSegment:p,id:"audio"}:u.video?t.video={container:"video/mp4",codec:m,initSegment:p,id:"main"}:b.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=t},y.remux=function(p,E,m,u,t){var r=this.initPTS,e=this.lastEndDTS,f={audio:void 0,video:void 0,text:u,id3:m,initSegment:void 0};Object(M.isFiniteNumber)(e)||(e=this.lastEndDTS=t||0);var o=E.samples;if(!o||!o.length)return f;var a={initPTS:void 0,timescale:1},v=this.initData;if((!v||!v.length)&&(this.generateInitSegment(o),v=this.initData),!v||!v.length)return b.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),f;this.emitInitSegment&&(a.tracks=this.initTracks,this.emitInitSegment=!1),Object(M.isFiniteNumber)(r)||(this.initPTS=a.initPTS=r=I(v,o,e));var h=Object(O.getDuration)(o,v),l=e,s=h+l;Object(O.offsetStartDTS)(v,o,r),h>0?this.lastEndDTS=s:(b.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var n=!!v.audio,i=!!v.video,d="";n&&(d+="audio"),i&&(d+="video");var c={data1:o,startPTS:l,startDTS:l,endPTS:s,endDTS:s,type:d,hasAudio:n,hasVideo:i,nb:1,dropped:0};return f.audio=c.type==="audio"?c:void 0,f.video=c.type!=="audio"?c:void 0,f.text=u,f.id3=m,f.initSegment=a,f},g}(),I=function(y,L,p){return Object(O.getStartDTS)(y,L)-p};function A(g,y){var L=g==null?void 0:g.codec;return L&&L.length>4?L:L==="hvc1"?"hvc1.1.c.L120.90":L==="av01"?"av01.0.04M.08":L==="avc1"||y===D.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}F.default=C},"./src/task-loop.ts":function(G,F,T){"use strict";T.r(F),T.d(F,"default",function(){return M});var M=function(){function O(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var D=O.prototype;return D.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},D.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},D.onHandlerDestroyed=function(){},D.hasInterval=function(){return!!this._tickInterval},D.hasNextTick=function(){return!!this._tickTimer},D.setInterval=function(C){return this._tickInterval?!1:(this._tickInterval=self.setInterval(this._boundTick,C),!0)},D.clearInterval=function(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1},D.clearNextTick=function(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1},D.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},D.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},D.doTick=function(){},O}()},"./src/types/cmcd.ts":function(G,F,T){"use strict";T.r(F),T.d(F,"CMCDVersion",function(){return M}),T.d(F,"CMCDObjectType",function(){return O}),T.d(F,"CMCDStreamingFormat",function(){return D}),T.d(F,"CMCDStreamType",function(){return b});var M=1,O;(function(C){C.MANIFEST="m",C.AUDIO="a",C.VIDEO="v",C.MUXED="av",C.INIT="i",C.CAPTION="c",C.TIMED_TEXT="tt",C.KEY="k",C.OTHER="o"})(O||(O={}));var D;(function(C){C.DASH="d",C.HLS="h",C.SMOOTH="s",C.OTHER="o"})(D||(D={}));var b;(function(C){C.VOD="v",C.LIVE="l"})(b||(b={}))},"./src/types/level.ts":function(G,F,T){"use strict";T.r(F),T.d(F,"HlsSkip",function(){return D}),T.d(F,"getSkipValue",function(){return b}),T.d(F,"HlsUrlParameters",function(){return C}),T.d(F,"Level",function(){return I});function M(A,g){for(var y=0;y<g.length;y++){var L=g[y];L.enumerable=L.enumerable||!1,L.configurable=!0,"value"in L&&(L.writable=!0),Object.defineProperty(A,L.key,L)}}function O(A,g,y){return g&&M(A.prototype,g),y&&M(A,y),A}var D;(function(A){A.No="",A.Yes="YES",A.v2="v2"})(D||(D={}));function b(A,g){var y=A.canSkipUntil,L=A.canSkipDateRanges,p=A.endSN,E=g!==void 0?g-p:0;return y&&E<y?L?D.v2:D.Yes:D.No}var C=function(){function A(y,L,p){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=y,this.part=L,this.skip=p}var g=A.prototype;return g.addDirectives=function(L){var p=new self.URL(L);return this.msn!==void 0&&p.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&p.searchParams.set("_HLS_part",this.part.toString()),this.skip&&p.searchParams.set("_HLS_skip",this.skip),p.toString()},A}(),I=function(){function A(g){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[g.url],this.attrs=g.attrs,this.bitrate=g.bitrate,g.details&&(this.details=g.details),this.id=g.id||0,this.name=g.name,this.width=g.width||0,this.height=g.height||0,this.audioCodec=g.audioCodec,this.videoCodec=g.videoCodec,this.unknownCodecs=g.unknownCodecs,this.codecSet=[g.videoCodec,g.audioCodec].filter(function(y){return y}).join(",").replace(/\.[^.,]+/g,"")}return O(A,[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(y){var L=y%this.url.length;this._urlId!==L&&(this.details=void 0,this._urlId=L)}}]),A}()},"./src/types/loader.ts":function(G,F,T){"use strict";T.r(F),T.d(F,"PlaylistContextType",function(){return M}),T.d(F,"PlaylistLevelType",function(){return O});var M;(function(D){D.MANIFEST="manifest",D.LEVEL="level",D.AUDIO_TRACK="audioTrack",D.SUBTITLE_TRACK="subtitleTrack"})(M||(M={}));var O;(function(D){D.MAIN="main",D.AUDIO="audio",D.SUBTITLE="subtitle"})(O||(O={}))},"./src/types/transmuxer.ts":function(G,F,T){"use strict";T.r(F),T.d(F,"ChunkMetadata",function(){return M});var M=function(b,C,I,A,g,y){A===void 0&&(A=0),g===void 0&&(g=-1),y===void 0&&(y=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=O(),this.buffering={audio:O(),video:O(),audiovideo:O()},this.level=b,this.sn=C,this.id=I,this.size=A,this.part=g,this.partial=y};function O(){return{start:0,executeStart:0,executeEnd:0,end:0}}},"./src/utils/attr-list.ts":function(G,F,T){"use strict";T.r(F),T.d(F,"AttrList",function(){return D});var M=/^(\d+)x(\d+)$/,O=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,D=function(){function b(I){typeof I=="string"&&(I=b.parseAttrList(I));for(var A in I)I.hasOwnProperty(A)&&(this[A]=I[A])}var C=b.prototype;return C.decimalInteger=function(A){var g=parseInt(this[A],10);return g>Number.MAX_SAFE_INTEGER?1/0:g},C.hexadecimalInteger=function(A){if(this[A]){var g=(this[A]||"0x").slice(2);g=(g.length&1?"0":"")+g;for(var y=new Uint8Array(g.length/2),L=0;L<g.length/2;L++)y[L]=parseInt(g.slice(L*2,L*2+2),16);return y}else return null},C.hexadecimalIntegerAsNumber=function(A){var g=parseInt(this[A],16);return g>Number.MAX_SAFE_INTEGER?1/0:g},C.decimalFloatingPoint=function(A){return parseFloat(this[A])},C.optionalFloat=function(A,g){var y=this[A];return y?parseFloat(y):g},C.enumeratedString=function(A){return this[A]},C.bool=function(A){return this[A]==="YES"},C.decimalResolution=function(A){var g=M.exec(this[A]);if(g!==null)return{width:parseInt(g[1],10),height:parseInt(g[2],10)}},b.parseAttrList=function(A){var g,y={},L='"';for(O.lastIndex=0;(g=O.exec(A))!==null;){var p=g[2];p.indexOf(L)===0&&p.lastIndexOf(L)===p.length-1&&(p=p.slice(1,-1)),y[g[1]]=p}return y},b}()},"./src/utils/binary-search.ts":function(G,F,T){"use strict";T.r(F);var M={search:function(D,b){for(var C=0,I=D.length-1,A=null,g=null;C<=I;){A=(C+I)/2|0,g=D[A];var y=b(g);if(y>0)C=A+1;else if(y<0)I=A-1;else return g}return null}};F.default=M},"./src/utils/buffer-helper.ts":function(G,F,T){"use strict";T.r(F),T.d(F,"BufferHelper",function(){return D});var M=T("./src/utils/logger.ts"),O={length:0,start:function(){return 0},end:function(){return 0}},D=function(){function b(){}return b.isBuffered=function(I,A){try{if(I){for(var g=b.getBuffered(I),y=0;y<g.length;y++)if(A>=g.start(y)&&A<=g.end(y))return!0}}catch{}return!1},b.bufferInfo=function(I,A,g){try{if(I){var y=b.getBuffered(I),L=[],p;for(p=0;p<y.length;p++)L.push({start:y.start(p),end:y.end(p)});return this.bufferedInfo(L,A,g)}}catch{}return{len:0,start:A,end:A,nextStart:void 0}},b.bufferedInfo=function(I,A,g){A=Math.max(0,A),I.sort(function(a,v){var h=a.start-v.start;return h||v.end-a.end});var y=[];if(g)for(var L=0;L<I.length;L++){var p=y.length;if(p){var E=y[p-1].end;I[L].start-E<g?I[L].end>E&&(y[p-1].end=I[L].end):y.push(I[L])}else y.push(I[L])}else y=I;for(var m=0,u,t=A,r=A,e=0;e<y.length;e++){var f=y[e].start,o=y[e].end;if(A+g>=f&&A<o)t=f,r=o,m=r-A;else if(A+g<f){u=f;break}}return{len:m,start:t||0,end:r||0,nextStart:u}},b.getBuffered=function(I){try{return I.buffered}catch(A){return M.logger.log("failed to get media.buffered",A),O}},b}()},"./src/utils/cea-608-parser.ts":function(G,F,T){"use strict";T.r(F),T.d(F,"Row",function(){return r}),T.d(F,"CaptionScreen",function(){return e});var M=T("./src/utils/logger.ts"),O={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},D=function(s){var n=s;return O.hasOwnProperty(s)&&(n=O[s]),String.fromCharCode(n)},b=15,C=100,I={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},A={17:2,18:4,21:6,22:8,23:10,19:13,20:15},g={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},y={25:2,26:4,29:6,30:8,31:10,27:13,28:15},L=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],p;(function(l){l[l.ERROR=0]="ERROR",l[l.TEXT=1]="TEXT",l[l.WARNING=2]="WARNING",l[l.INFO=2]="INFO",l[l.DEBUG=3]="DEBUG",l[l.DATA=3]="DATA"})(p||(p={}));var E=function(){function l(){this.time=null,this.verboseLevel=p.ERROR}var s=l.prototype;return s.log=function(i,d){this.verboseLevel>=i&&M.logger.log(this.time+" ["+i+"] "+d)},l}(),m=function(s){for(var n=[],i=0;i<s.length;i++)n.push(s[i].toString(16));return n},u=function(){function l(n,i,d,c,S){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=n||"white",this.underline=i||!1,this.italics=d||!1,this.background=c||"black",this.flash=S||!1}var s=l.prototype;return s.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},s.setStyles=function(i){for(var d=["foreground","underline","italics","background","flash"],c=0;c<d.length;c++){var S=d[c];i.hasOwnProperty(S)&&(this[S]=i[S])}},s.isDefault=function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash},s.equals=function(i){return this.foreground===i.foreground&&this.underline===i.underline&&this.italics===i.italics&&this.background===i.background&&this.flash===i.flash},s.copy=function(i){this.foreground=i.foreground,this.underline=i.underline,this.italics=i.italics,this.background=i.background,this.flash=i.flash},s.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},l}(),t=function(){function l(n,i,d,c,S,R){this.uchar=void 0,this.penState=void 0,this.uchar=n||" ",this.penState=new u(i,d,c,S,R)}var s=l.prototype;return s.reset=function(){this.uchar=" ",this.penState.reset()},s.setChar=function(i,d){this.uchar=i,this.penState.copy(d)},s.setPenState=function(i){this.penState.copy(i)},s.equals=function(i){return this.uchar===i.uchar&&this.penState.equals(i.penState)},s.copy=function(i){this.uchar=i.uchar,this.penState.copy(i.penState)},s.isEmpty=function(){return this.uchar===" "&&this.penState.isDefault()},l}(),r=function(){function l(n){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var i=0;i<C;i++)this.chars.push(new t);this.logger=n,this.pos=0,this.currPenState=new u}var s=l.prototype;return s.equals=function(i){for(var d=!0,c=0;c<C;c++)if(!this.chars[c].equals(i.chars[c])){d=!1;break}return d},s.copy=function(i){for(var d=0;d<C;d++)this.chars[d].copy(i.chars[d])},s.isEmpty=function(){for(var i=!0,d=0;d<C;d++)if(!this.chars[d].isEmpty()){i=!1;break}return i},s.setCursor=function(i){this.pos!==i&&(this.pos=i),this.pos<0?(this.logger.log(p.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>C&&(this.logger.log(p.DEBUG,"Too large cursor position "+this.pos),this.pos=C)},s.moveCursor=function(i){var d=this.pos+i;if(i>1)for(var c=this.pos+1;c<d+1;c++)this.chars[c].setPenState(this.currPenState);this.setCursor(d)},s.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},s.insertChar=function(i){i>=144&&this.backSpace();var d=D(i);if(this.pos>=C){this.logger.log(p.ERROR,"Cannot insert "+i.toString(16)+" ("+d+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(d,this.currPenState),this.moveCursor(1)},s.clearFromPos=function(i){var d;for(d=i;d<C;d++)this.chars[d].reset()},s.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},s.clearToEndOfRow=function(){this.clearFromPos(this.pos)},s.getTextString=function(){for(var i=[],d=!0,c=0;c<C;c++){var S=this.chars[c].uchar;S!==" "&&(d=!1),i.push(S)}return d?"":i.join("")},s.setPenStyles=function(i){this.currPenState.setStyles(i);var d=this.chars[this.pos];d.setPenState(this.currPenState)},l}(),e=function(){function l(n){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var i=0;i<b;i++)this.rows.push(new r(n));this.logger=n,this.currRow=b-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var s=l.prototype;return s.reset=function(){for(var i=0;i<b;i++)this.rows[i].clear();this.currRow=b-1},s.equals=function(i){for(var d=!0,c=0;c<b;c++)if(!this.rows[c].equals(i.rows[c])){d=!1;break}return d},s.copy=function(i){for(var d=0;d<b;d++)this.rows[d].copy(i.rows[d])},s.isEmpty=function(){for(var i=!0,d=0;d<b;d++)if(!this.rows[d].isEmpty()){i=!1;break}return i},s.backSpace=function(){var i=this.rows[this.currRow];i.backSpace()},s.clearToEndOfRow=function(){var i=this.rows[this.currRow];i.clearToEndOfRow()},s.insertChar=function(i){var d=this.rows[this.currRow];d.insertChar(i)},s.setPen=function(i){var d=this.rows[this.currRow];d.setPenStyles(i)},s.moveCursor=function(i){var d=this.rows[this.currRow];d.moveCursor(i)},s.setCursor=function(i){this.logger.log(p.INFO,"setCursor: "+i);var d=this.rows[this.currRow];d.setCursor(i)},s.setPAC=function(i){this.logger.log(p.INFO,"pacData = "+JSON.stringify(i));var d=i.row-1;if(this.nrRollUpRows&&d<this.nrRollUpRows-1&&(d=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==d){for(var c=0;c<b;c++)this.rows[c].clear();var S=this.currRow+1-this.nrRollUpRows,R=this.lastOutputScreen;if(R){var P=R.rows[S].cueStartTime,B=this.logger.time;if(P&&B!==null&&P<B)for(var x=0;x<this.nrRollUpRows;x++)this.rows[d-this.nrRollUpRows+x+1].copy(R.rows[S+x])}}this.currRow=d;var U=this.rows[this.currRow];if(i.indent!==null){var k=i.indent,N=Math.max(k-1,0);U.setCursor(i.indent),i.color=U.chars[N].penState.foreground}var K={foreground:i.color,underline:i.underline,italics:i.italics,background:"black",flash:!1};this.setPen(K)},s.setBkgData=function(i){this.logger.log(p.INFO,"bkgData = "+JSON.stringify(i)),this.backSpace(),this.setPen(i),this.insertChar(32)},s.setRollUpRows=function(i){this.nrRollUpRows=i},s.rollUp=function(){if(this.nrRollUpRows===null){this.logger.log(p.DEBUG,"roll_up but nrRollUpRows not set yet");return}this.logger.log(p.TEXT,this.getDisplayText());var i=this.currRow+1-this.nrRollUpRows,d=this.rows.splice(i,1)[0];d.clear(),this.rows.splice(this.currRow,0,d),this.logger.log(p.INFO,"Rolling up")},s.getDisplayText=function(i){i=i||!1;for(var d=[],c="",S=-1,R=0;R<b;R++){var P=this.rows[R].getTextString();P&&(S=R+1,i?d.push("Row "+S+": '"+P+"'"):d.push(P.trim()))}return d.length>0&&(i?c="["+d.join(" | ")+"]":c=d.join(`
`)),c},s.getTextAndFormat=function(){return this.rows},l}(),f=function(){function l(n,i,d){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=n,this.outputFilter=i,this.mode=null,this.verbose=0,this.displayedMemory=new e(d),this.nonDisplayedMemory=new e(d),this.lastOutputScreen=new e(d),this.currRollUpRow=this.displayedMemory.rows[b-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=d}var s=l.prototype;return s.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[b-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},s.getHandler=function(){return this.outputFilter},s.setHandler=function(i){this.outputFilter=i},s.setPAC=function(i){this.writeScreen.setPAC(i)},s.setBkgData=function(i){this.writeScreen.setBkgData(i)},s.setMode=function(i){i!==this.mode&&(this.mode=i,this.logger.log(p.INFO,"MODE="+i),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=i)},s.insertChars=function(i){for(var d=0;d<i.length;d++)this.writeScreen.insertChar(i[d]);var c=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(p.INFO,c+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(p.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},s.ccRCL=function(){this.logger.log(p.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},s.ccBS=function(){this.logger.log(p.INFO,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},s.ccAOF=function(){},s.ccAON=function(){},s.ccDER=function(){this.logger.log(p.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},s.ccRU=function(i){this.logger.log(p.INFO,"RU("+i+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(i)},s.ccFON=function(){this.logger.log(p.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},s.ccRDC=function(){this.logger.log(p.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},s.ccTR=function(){this.logger.log(p.INFO,"TR"),this.setMode("MODE_TEXT")},s.ccRTD=function(){this.logger.log(p.INFO,"RTD"),this.setMode("MODE_TEXT")},s.ccEDM=function(){this.logger.log(p.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},s.ccCR=function(){this.logger.log(p.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},s.ccENM=function(){this.logger.log(p.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},s.ccEOC=function(){if(this.logger.log(p.INFO,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){var i=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=i,this.writeScreen=this.nonDisplayedMemory,this.logger.log(p.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},s.ccTO=function(i){this.logger.log(p.INFO,"TO("+i+") - Tab Offset"),this.writeScreen.moveCursor(i)},s.ccMIDROW=function(i){var d={flash:!1};if(d.underline=i%2===1,d.italics=i>=46,d.italics)d.foreground="white";else{var c=Math.floor(i/2)-16,S=["white","green","blue","cyan","red","yellow","magenta"];d.foreground=S[c]}this.logger.log(p.INFO,"MIDROW: "+JSON.stringify(d)),this.writeScreen.setPen(d)},s.outputDataUpdate=function(i){i===void 0&&(i=!1);var d=this.logger.time;d!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=d:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,d,this.lastOutputScreen),i&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:d),this.lastOutputScreen.copy(this.displayedMemory))},s.cueSplitAtTime=function(i){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,i,this.displayedMemory),this.cueStartTime=i))},l}(),o=function(){function l(n,i,d){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var c=new E;this.channels=[null,new f(n,i,c),new f(n+1,d,c)],this.cmdHistory=h(),this.logger=c}var s=l.prototype;return s.getHandler=function(i){return this.channels[i].getHandler()},s.setHandler=function(i,d){this.channels[i].setHandler(d)},s.addData=function(i,d){var c,S,R,P=!1;this.logger.time=i;for(var B=0;B<d.length;B+=2)if(S=d[B]&127,R=d[B+1]&127,!(S===0&&R===0)){if(this.logger.log(p.DATA,"["+m([d[B],d[B+1]])+"] -> ("+m([S,R])+")"),c=this.parseCmd(S,R),c||(c=this.parseMidrow(S,R)),c||(c=this.parsePAC(S,R)),c||(c=this.parseBackgroundAttributes(S,R)),!c&&(P=this.parseChars(S,R),P)){var x=this.currentChannel;if(x&&x>0){var U=this.channels[x];U.insertChars(P)}else this.logger.log(p.WARNING,"No channel found yet. TEXT-MODE?")}!c&&!P&&this.logger.log(p.WARNING,"Couldn't parse cleaned data "+m([S,R])+" orig: "+m([d[B],d[B+1]]))}},s.parseCmd=function(i,d){var c=this.cmdHistory,S=(i===20||i===28||i===21||i===29)&&d>=32&&d<=47,R=(i===23||i===31)&&d>=33&&d<=35;if(!(S||R))return!1;if(v(i,d,c))return a(null,null,c),this.logger.log(p.DEBUG,"Repeated command ("+m([i,d])+") is dropped"),!0;var P=i===20||i===21||i===23?1:2,B=this.channels[P];return i===20||i===21||i===28||i===29?d===32?B.ccRCL():d===33?B.ccBS():d===34?B.ccAOF():d===35?B.ccAON():d===36?B.ccDER():d===37?B.ccRU(2):d===38?B.ccRU(3):d===39?B.ccRU(4):d===40?B.ccFON():d===41?B.ccRDC():d===42?B.ccTR():d===43?B.ccRTD():d===44?B.ccEDM():d===45?B.ccCR():d===46?B.ccENM():d===47&&B.ccEOC():B.ccTO(d-32),a(i,d,c),this.currentChannel=P,!0},s.parseMidrow=function(i,d){var c=0;if((i===17||i===25)&&d>=32&&d<=47){if(i===17?c=1:c=2,c!==this.currentChannel)return this.logger.log(p.ERROR,"Mismatch channel in midrow parsing"),!1;var S=this.channels[c];return S?(S.ccMIDROW(d),this.logger.log(p.DEBUG,"MIDROW ("+m([i,d])+")"),!0):!1}return!1},s.parsePAC=function(i,d){var c,S=this.cmdHistory,R=(i>=17&&i<=23||i>=25&&i<=31)&&d>=64&&d<=127,P=(i===16||i===24)&&d>=64&&d<=95;if(!(R||P))return!1;if(v(i,d,S))return a(null,null,S),!0;var B=i<=23?1:2;d>=64&&d<=95?c=B===1?I[i]:g[i]:c=B===1?A[i]:y[i];var x=this.channels[B];return x?(x.setPAC(this.interpretPAC(c,d)),a(i,d,S),this.currentChannel=B,!0):!1},s.interpretPAC=function(i,d){var c,S={color:null,italics:!1,indent:null,underline:!1,row:i};return d>95?c=d-96:c=d-64,S.underline=(c&1)===1,c<=13?S.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(c/2)]:c<=15?(S.italics=!0,S.color="white"):S.indent=Math.floor((c-16)/2)*4,S},s.parseChars=function(i,d){var c,S=null,R=null;if(i>=25?(c=2,R=i-8):(c=1,R=i),R>=17&&R<=19){var P;R===17?P=d+80:R===18?P=d+112:P=d+144,this.logger.log(p.INFO,"Special char '"+D(P)+"' in channel "+c),S=[P]}else i>=32&&i<=127&&(S=d===0?[i]:[i,d]);if(S){var B=m(S);this.logger.log(p.DEBUG,"Char codes =  "+B.join(",")),a(i,d,this.cmdHistory)}return S},s.parseBackgroundAttributes=function(i,d){var c=(i===16||i===24)&&d>=32&&d<=47,S=(i===23||i===31)&&d>=45&&d<=47;if(!(c||S))return!1;var R,P={};i===16||i===24?(R=Math.floor((d-32)/2),P.background=L[R],d%2===1&&(P.background=P.background+"_semi")):d===45?P.background="transparent":(P.foreground="black",d===47&&(P.underline=!0));var B=i<=23?1:2,x=this.channels[B];return x.setBkgData(P),a(i,d,this.cmdHistory),!0},s.reset=function(){for(var i=0;i<Object.keys(this.channels).length;i++){var d=this.channels[i];d&&d.reset()}this.cmdHistory=h()},s.cueSplitAtTime=function(i){for(var d=0;d<this.channels.length;d++){var c=this.channels[d];c&&c.cueSplitAtTime(i)}},l}();function a(l,s,n){n.a=l,n.b=s}function v(l,s,n){return n.a===l&&n.b===s}function h(){return{a:null,b:null}}F.default=o},"./src/utils/codecs.ts":function(G,F,T){"use strict";T.r(F),T.d(F,"isCodecType",function(){return O}),T.d(F,"isCodecSupportedInMp4",function(){return D});var M={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function O(b,C){var I=M[C];return!!I&&I[b.slice(0,4)]===!0}function D(b,C){return MediaSource.isTypeSupported((C||"video")+'/mp4;codecs="'+b+'"')}},"./src/utils/cues.ts":function(G,F,T){"use strict";T.r(F);var M=T("./src/utils/vttparser.ts"),O=T("./src/utils/webvtt-parser.ts"),D=T("./src/utils/texttrack-utils.ts"),b=/\s/,C={newCue:function(A,g,y,L){for(var p=[],E,m,u,t,r,e=self.VTTCue||self.TextTrackCue,f=0;f<L.rows.length;f++)if(E=L.rows[f],u=!0,t=0,r="",!E.isEmpty()){for(var o=0;o<E.chars.length;o++)b.test(E.chars[o].uchar)&&u?t++:(r+=E.chars[o].uchar,u=!1);E.cueStartTime=g,g===y&&(y+=1e-4),t>=16?t--:t++;var a=Object(M.fixLineBreaks)(r.trim()),v=Object(O.generateCueId)(g,y,a);(!A||!A.cues||!A.cues.getCueById(v))&&(m=new e(g,y,a),m.id=v,m.line=f+1,m.align="left",m.position=10+Math.min(80,Math.floor(t*8/32)*10),p.push(m))}return A&&p.length&&(p.sort(function(h,l){return h.line==="auto"||l.line==="auto"?0:h.line>8&&l.line>8?l.line-h.line:h.line-l.line}),p.forEach(function(h){return Object(D.addCueToTrack)(A,h)})),p}};F.default=C},"./src/utils/discontinuities.ts":function(G,F,T){"use strict";T.r(F),T.d(F,"findFirstFragWithCC",function(){return b}),T.d(F,"shouldAlignOnDiscontinuities",function(){return C}),T.d(F,"findDiscontinuousReferenceFrag",function(){return I}),T.d(F,"adjustSlidingStart",function(){return g}),T.d(F,"alignStream",function(){return y}),T.d(F,"alignPDT",function(){return p}),T.d(F,"alignFragmentByPDTDelta",function(){return E}),T.d(F,"alignMediaPlaylistByPDT",function(){return m});var M=T("./src/polyfills/number.ts"),O=T("./src/utils/logger.ts"),D=T("./src/controller/level-helper.ts");function b(u,t){for(var r=null,e=0,f=u.length;e<f;e++){var o=u[e];if(o&&o.cc===t){r=o;break}}return r}function C(u,t,r){return!!(t.details&&(r.endCC>r.startCC||u&&u.cc<r.startCC))}function I(u,t){var r=u.fragments,e=t.fragments;if(!e.length||!r.length){O.logger.log("No fragments to align");return}var f=b(r,e[0].cc);if(!f||f&&!f.startPTS){O.logger.log("No frag in previous level to align on");return}return f}function A(u,t){if(u){var r=u.start+t;u.start=u.startPTS=r,u.endPTS=r+u.duration}}function g(u,t){for(var r=t.fragments,e=0,f=r.length;e<f;e++)A(r[e],u);t.fragmentHint&&A(t.fragmentHint,u),t.alignedSliding=!0}function y(u,t,r){!t||(L(u,r,t),!r.alignedSliding&&t.details&&p(r,t.details),!r.alignedSliding&&t.details&&!r.skippedSegments&&Object(D.adjustSliding)(t.details,r))}function L(u,t,r){if(C(u,r,t)){var e=I(r.details,t);e&&Object(M.isFiniteNumber)(e.start)&&(O.logger.log("Adjusting PTS using last level due to CC increase within current level "+t.url),g(e.start,t))}}function p(u,t){if(!(!t.fragments.length||!u.hasProgramDateTime||!t.hasProgramDateTime)){var r=t.fragments[0].programDateTime,e=u.fragments[0].programDateTime,f=(e-r)/1e3+t.fragments[0].start;f&&Object(M.isFiniteNumber)(f)&&(O.logger.log("Adjusting PTS using programDateTime delta "+(e-r)+"ms, sliding:"+f.toFixed(3)+" "+u.url+" "),g(f,u))}}function E(u,t){var r=u.programDateTime;if(!!r){var e=(r-t)/1e3;u.start=u.startPTS=e,u.endPTS=e+u.duration}}function m(u,t){if(!(!t.fragments.length||!u.hasProgramDateTime||!t.hasProgramDateTime)){var r=t.fragments[0].programDateTime,e=t.fragments[0].start,f=r-e*1e3;u.fragments.forEach(function(o){E(o,f)}),u.fragmentHint&&E(u.fragmentHint,f),u.alignedSliding=!0}}},"./src/utils/ewma-bandwidth-estimator.ts":function(G,F,T){"use strict";T.r(F);var M=T("./src/utils/ewma.ts"),O=function(){function D(C,I,A){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=A,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new M.default(C),this.fast_=new M.default(I)}var b=D.prototype;return b.update=function(I,A){var g=this.slow_,y=this.fast_;this.slow_.halfLife!==I&&(this.slow_=new M.default(I,g.getEstimate(),g.getTotalWeight())),this.fast_.halfLife!==A&&(this.fast_=new M.default(A,y.getEstimate(),y.getTotalWeight()))},b.sample=function(I,A){I=Math.max(I,this.minDelayMs_);var g=8*A,y=I/1e3,L=g/y;this.fast_.sample(y,L),this.slow_.sample(y,L)},b.canEstimate=function(){var I=this.fast_;return I&&I.getTotalWeight()>=this.minWeight_},b.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},b.destroy=function(){},D}();F.default=O},"./src/utils/ewma.ts":function(G,F,T){"use strict";T.r(F);var M=function(){function O(b,C,I){C===void 0&&(C=0),I===void 0&&(I=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=b,this.alpha_=b?Math.exp(Math.log(.5)/b):0,this.estimate_=C,this.totalWeight_=I}var D=O.prototype;return D.sample=function(C,I){var A=Math.pow(this.alpha_,C);this.estimate_=I*(1-A)+A*this.estimate_,this.totalWeight_+=C},D.getTotalWeight=function(){return this.totalWeight_},D.getEstimate=function(){if(this.alpha_){var C=1-Math.pow(this.alpha_,this.totalWeight_);if(C)return this.estimate_/C}return this.estimate_},O}();F.default=M},"./src/utils/fetch-loader.ts":function(G,F,T){"use strict";T.r(F),T.d(F,"fetchSupported",function(){return E});var M=T("./src/polyfills/number.ts"),O=T("./src/loader/load-stats.ts"),D=T("./src/demux/chunk-cache.ts");function b(e,f){e.prototype=Object.create(f.prototype),e.prototype.constructor=e,y(e,f)}function C(e){var f=typeof Map=="function"?new Map:void 0;return C=function(a){if(a===null||!g(a))return a;if(typeof a!="function")throw new TypeError("Super expression must either be null or a function");if(typeof f<"u"){if(f.has(a))return f.get(a);f.set(a,v)}function v(){return I(a,arguments,L(this).constructor)}return v.prototype=Object.create(a.prototype,{constructor:{value:v,enumerable:!1,writable:!0,configurable:!0}}),y(v,a)},C(e)}function I(e,f,o){return A()?I=Reflect.construct:I=function(v,h,l){var s=[null];s.push.apply(s,h);var n=Function.bind.apply(v,s),i=new n;return l&&y(i,l.prototype),i},I.apply(null,arguments)}function A(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function g(e){return Function.toString.call(e).indexOf("[native code]")!==-1}function y(e,f){return y=Object.setPrototypeOf||function(a,v){return a.__proto__=v,a},y(e,f)}function L(e){return L=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)},L(e)}function p(){return p=Object.assign||function(e){for(var f=1;f<arguments.length;f++){var o=arguments[f];for(var a in o)Object.prototype.hasOwnProperty.call(o,a)&&(e[a]=o[a])}return e},p.apply(this,arguments)}function E(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}var m=function(){function e(o){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=o.fetchSetup||t,this.controller=new self.AbortController,this.stats=new O.LoadStats}var f=e.prototype;return f.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},f.abortInternal=function(){var a=this.response;(!a||!a.ok)&&(this.stats.aborted=!0,this.controller.abort())},f.abort=function(){var a;this.abortInternal(),(a=this.callbacks)!==null&&a!==void 0&&a.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},f.load=function(a,v,h){var l=this,s=this.stats;if(s.loading.start)throw new Error("Loader can only be used once.");s.loading.start=self.performance.now();var n=u(a,this.controller.signal),i=h.onProgress,d=a.responseType==="arraybuffer",c=d?"byteLength":"length";this.context=a,this.config=v,this.callbacks=h,this.request=this.fetchSetup(a,n),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(function(){l.abortInternal(),h.onTimeout(s,a,l.response)},v.timeout),self.fetch(this.request).then(function(S){if(l.response=l.loader=S,!S.ok){var R=S.status,P=S.statusText;throw new r(P||"fetch, bad network response",R,S)}return s.loading.first=Math.max(self.performance.now(),s.loading.start),s.total=parseInt(S.headers.get("Content-Length")||"0"),i&&Object(M.isFiniteNumber)(v.highWaterMark)?l.loadProgressively(S,s,a,v.highWaterMark,i):d?S.arrayBuffer():S.text()}).then(function(S){var R=l.response;self.clearTimeout(l.requestTimeout),s.loading.end=Math.max(self.performance.now(),s.loading.first),s.loaded=s.total=S[c];var P={url:R.url,data:S};i&&!Object(M.isFiniteNumber)(v.highWaterMark)&&i(s,a,S,R),h.onSuccess(P,s,a,R)}).catch(function(S){if(self.clearTimeout(l.requestTimeout),!s.aborted){var R=S.code||0;h.onError({code:R,text:S.message},a,S.details)}})},f.getCacheAge=function(){var a=null;if(this.response){var v=this.response.headers.get("age");a=v?parseFloat(v):null}return a},f.loadProgressively=function(a,v,h,l,s){l===void 0&&(l=0);var n=new D.default,i=a.body.getReader(),d=function c(){return i.read().then(function(S){if(S.done)return n.dataLength&&s(v,h,n.flush(),a),Promise.resolve(new ArrayBuffer(0));var R=S.value,P=R.length;return v.loaded+=P,P<l||n.dataLength?(n.push(R),n.dataLength>=l&&s(v,h,n.flush(),a)):s(v,h,R,a),c()}).catch(function(){return Promise.reject()})};return d()},e}();function u(e,f){var o={method:"GET",mode:"cors",credentials:"same-origin",signal:f,headers:new self.Headers(p({},e.headers))};return e.rangeEnd&&o.headers.set("Range","bytes="+e.rangeStart+"-"+String(e.rangeEnd-1)),o}function t(e,f){return new self.Request(e.url,f)}var r=function(e){b(f,e);function f(o,a,v){var h;return h=e.call(this,o)||this,h.code=void 0,h.details=void 0,h.code=a,h.details=v,h}return f}(C(Error));F.default=m},"./src/utils/imsc1-ttml-parser.ts":function(G,F,T){"use strict";T.r(F),T.d(F,"IMSC1_CODEC",function(){return g}),T.d(F,"parseIMSC1",function(){return E});var M=T("./src/utils/mp4-tools.ts"),O=T("./src/utils/vttparser.ts"),D=T("./src/utils/vttcue.ts"),b=T("./src/demux/id3.ts"),C=T("./src/utils/timescale-conversion.ts"),I=T("./src/utils/webvtt-parser.ts");function A(){return A=Object.assign||function(l){for(var s=1;s<arguments.length;s++){var n=arguments[s];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(l[i]=n[i])}return l},A.apply(this,arguments)}var g="stpp.ttml.im1t",y=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,L=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,p={left:"start",center:"center",right:"end",start:"start",end:"end"};function E(l,s,n,i,d){var c=Object(M.findBox)(new Uint8Array(l),["mdat"]);if(c.length===0){d(new Error("Could not parse IMSC1 mdat"));return}var S=c[0],R=Object(b.utf8ArrayToStr)(new Uint8Array(l,S.start,S.end-S.start)),P=Object(C.toTimescaleFromScale)(s,1,n);try{i(m(R,P))}catch(B){d(B)}}function m(l,s){var n=new DOMParser,i=n.parseFromString(l,"text/xml"),d=i.getElementsByTagName("tt")[0];if(!d)throw new Error("Invalid ttml");var c={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},S=Object.keys(c).reduce(function(U,k){return U[k]=d.getAttribute("ttp:"+k)||c[k],U},{}),R=d.getAttribute("xml:space")!=="preserve",P=t(u(d,"styling","style")),B=t(u(d,"layout","region")),x=u(d,"body","[begin]");return[].map.call(x,function(U){var k=r(U,R);if(!k||!U.hasAttribute("begin"))return null;var N=a(U.getAttribute("begin"),S),K=a(U.getAttribute("dur"),S),W=a(U.getAttribute("end"),S);if(N===null)throw o(U);if(W===null){if(K===null)throw o(U);W=N+K}var w=new D.default(N-s,W-s,k);w.id=Object(I.generateCueId)(w.startTime,w.endTime,w.text);var H=B[U.getAttribute("region")],V=P[U.getAttribute("style")];w.position=10,w.size=80;var j=e(H,V),X=j.textAlign;if(X){var Y=p[X];Y&&(w.lineAlign=Y),w.align=X}return A(w,j),w}).filter(function(U){return U!==null})}function u(l,s,n){var i=l.getElementsByTagName(s)[0];return i?[].slice.call(i.querySelectorAll(n)):[]}function t(l){return l.reduce(function(s,n){var i=n.getAttribute("xml:id");return i&&(s[i]=n),s},{})}function r(l,s){return[].slice.call(l.childNodes).reduce(function(n,i,d){var c;return i.nodeName==="br"&&d?n+`
`:(c=i.childNodes)!==null&&c!==void 0&&c.length?r(i,s):s?n+i.textContent.trim().replace(/\s+/g," "):n+i.textContent},"")}function e(l,s){var n="http://www.w3.org/ns/ttml#styling",i=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"];return i.reduce(function(d,c){var S=f(s,n,c)||f(l,n,c);return S&&(d[c]=S),d},{})}function f(l,s,n){return l.hasAttributeNS(s,n)?l.getAttributeNS(s,n):null}function o(l){return new Error("Could not parse ttml timestamp "+l)}function a(l,s){if(!l)return null;var n=Object(O.parseTimeStamp)(l);return n===null&&(y.test(l)?n=v(l,s):L.test(l)&&(n=h(l,s))),n}function v(l,s){var n=y.exec(l),i=(n[4]|0)+(n[5]|0)/s.subFrameRate;return(n[1]|0)*3600+(n[2]|0)*60+(n[3]|0)+i/s.frameRate}function h(l,s){var n=L.exec(l),i=Number(n[1]),d=n[2];switch(d){case"h":return i*3600;case"m":return i*60;case"ms":return i*1e3;case"f":return i/s.frameRate;case"t":return i/s.tickRate}return i}},"./src/utils/logger.ts":function(G,F,T){"use strict";T.r(F),T.d(F,"enableLogs",function(){return I}),T.d(F,"logger",function(){return A});var M=function(){},O={trace:M,debug:M,log:M,warn:M,info:M,error:M},D=O;function b(g){var y=self.console[g];return y?y.bind(self.console,"["+g+"] >"):M}function C(g){for(var y=arguments.length,L=new Array(y>1?y-1:0),p=1;p<y;p++)L[p-1]=arguments[p];L.forEach(function(E){D[E]=g[E]?g[E].bind(g):b(E)})}function I(g){if(self.console&&g===!0||typeof g=="object"){C(g,"debug","log","info","warn","error");try{D.log()}catch{D=O}}else D=O}var A=D},"./src/utils/mediakeys-helper.ts":function(G,F,T){"use strict";T.r(F),T.d(F,"KeySystems",function(){return M}),T.d(F,"requestMediaKeySystemAccess",function(){return O});var M;(function(D){D.WIDEVINE="com.widevine.alpha",D.PLAYREADY="com.microsoft.playready"})(M||(M={}));var O=function(){return typeof self<"u"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}()},"./src/utils/mediasource-helper.ts":function(G,F,T){"use strict";T.r(F),T.d(F,"getMediaSource",function(){return M});function M(){return self.MediaSource||self.WebKitMediaSource}},"./src/utils/mp4-tools.ts":function(G,F,T){"use strict";T.r(F),T.d(F,"bin2str",function(){return C}),T.d(F,"readUint16",function(){return I}),T.d(F,"readUint32",function(){return A}),T.d(F,"writeUint32",function(){return g}),T.d(F,"findBox",function(){return y}),T.d(F,"parseSegmentIndex",function(){return L}),T.d(F,"parseInitSegment",function(){return p}),T.d(F,"getStartDTS",function(){return E}),T.d(F,"getDuration",function(){return m}),T.d(F,"computeRawDurationFromSamples",function(){return u}),T.d(F,"offsetStartDTS",function(){return t}),T.d(F,"segmentValidRange",function(){return r}),T.d(F,"appendUint8Array",function(){return e});var M=T("./src/utils/typed-array.ts"),O=T("./src/loader/fragment.ts"),D=Math.pow(2,32)-1,b=[].push;function C(f){return String.fromCharCode.apply(null,f)}function I(f,o){"data"in f&&(o+=f.start,f=f.data);var a=f[o]<<8|f[o+1];return a<0?65536+a:a}function A(f,o){"data"in f&&(o+=f.start,f=f.data);var a=f[o]<<24|f[o+1]<<16|f[o+2]<<8|f[o+3];return a<0?4294967296+a:a}function g(f,o,a){"data"in f&&(o+=f.start,f=f.data),f[o]=a>>24,f[o+1]=a>>16&255,f[o+2]=a>>8&255,f[o+3]=a&255}function y(f,o){var a=[];if(!o.length)return a;var v,h,l;"data"in f?(v=f.data,h=f.start,l=f.end):(v=f,h=0,l=v.byteLength);for(var s=h;s<l;){var n=A(v,s),i=C(v.subarray(s+4,s+8)),d=n>1?s+n:l;if(i===o[0])if(o.length===1)a.push({data:v,start:s+8,end:d});else{var c=y({data:v,start:s+8,end:d},o.slice(1));c.length&&b.apply(a,c)}s=d}return a}function L(f){var o=y(f,["moov"]),a=o[0],v=a?a.end:null,h=y(f,["sidx"]);if(!h||!h[0])return null;var l=[],s=h[0],n=s.data[0],i=n===0?8:16,d=A(s,i);i+=4;var c=0,S=0;n===0?i+=8:i+=16,i+=2;var R=s.end+S,P=I(s,i);i+=2;for(var B=0;B<P;B++){var x=i,U=A(s,x);x+=4;var k=U&2147483647,N=(U&2147483648)>>>31;if(N===1)return console.warn("SIDX has hierarchical references (not supported)"),null;var K=A(s,x);x+=4,l.push({referenceSize:k,subsegmentDuration:K,info:{duration:K/d,start:R,end:R+k-1}}),R+=k,x+=4,i=x}return{earliestPresentationTime:c,timescale:d,version:n,referencesCount:P,references:l,moovEndOffset:v}}function p(f){for(var o=[],a=y(f,["moov","trak"]),v=0;v<a.length;v++){var h=a[v],l=y(h,["tkhd"])[0];if(l){var s=l.data[l.start],n=s===0?12:20,i=A(l,n),d=y(h,["mdia","mdhd"])[0];if(d){s=d.data[d.start],n=s===0?12:20;var c=A(d,n),S=y(h,["mdia","hdlr"])[0];if(S){var R=C(S.data.subarray(S.start+8,S.start+12)),P={soun:O.ElementaryStreamTypes.AUDIO,vide:O.ElementaryStreamTypes.VIDEO}[R];if(P){var B=y(h,["mdia","minf","stbl","stsd"])[0],x=void 0;B&&(x=C(B.data.subarray(B.start+12,B.start+16))),o[i]={timescale:c,type:P},o[P]={timescale:c,id:i,codec:x}}}}}}var U=y(f,["moov","mvex","trex"]);return U.forEach(function(k){var N=A(k,4),K=o[N];K&&(K.default={duration:A(k,12),flags:A(k,20)})}),o}function E(f,o){return y(o,["moof","traf"]).reduce(function(a,v){var h=y(v,["tfdt"])[0],l=h.data[h.start],s=y(v,["tfhd"]).reduce(function(n,i){var d=A(i,4),c=f[d];if(c){var S=A(h,4);l===1&&(S*=Math.pow(2,32),S+=A(h,8));var R=c.timescale||9e4,P=S/R;if(isFinite(P)&&(n===null||P<n))return P}return n},null);return s!==null&&isFinite(s)&&(a===null||s<a)?s:a},null)||0}function m(f,o){for(var a=0,v=0,h=0,l=y(f,["moof","traf"]),s=0;s<l.length;s++){var n=l[s],i=y(n,["tfhd"])[0],d=A(i,4),c=o[d];if(!!c){var S=c.default,R=A(i,0)|(S==null?void 0:S.flags),P=S==null?void 0:S.duration;R&8&&(R&2?P=A(i,12):P=A(i,8));for(var B=c.timescale||9e4,x=y(n,["trun"]),U=0;U<x.length;U++){if(a=u(x[U]),!a&&P){var k=A(x[U],4);a=P*k}c.type===O.ElementaryStreamTypes.VIDEO?v+=a/B:c.type===O.ElementaryStreamTypes.AUDIO&&(h+=a/B)}}}if(v===0&&h===0){var N=L(f);if(N!=null&&N.references)return N.references.reduce(function(K,W){return K+W.info.duration||0},0)}return v||h}function u(f){var o=A(f,0),a=8;o&1&&(a+=4),o&4&&(a+=4);for(var v=0,h=A(f,4),l=0;l<h;l++){if(o&256){var s=A(f,a);v+=s,a+=4}o&512&&(a+=4),o&1024&&(a+=4),o&2048&&(a+=4)}return v}function t(f,o,a){y(o,["moof","traf"]).forEach(function(v){y(v,["tfhd"]).forEach(function(h){var l=A(h,4),s=f[l];if(!!s){var n=s.timescale||9e4;y(v,["tfdt"]).forEach(function(i){var d=i.data[i.start],c=A(i,4);if(d===0)g(i,4,c-a*n);else{c*=Math.pow(2,32),c+=A(i,8),c-=a*n,c=Math.max(c,0);var S=Math.floor(c/(D+1)),R=Math.floor(c%(D+1));g(i,4,S),g(i,8,R)}})}})})}function r(f){var o={valid:null,remainder:null},a=y(f,["moof"]);if(a){if(a.length<2)return o.remainder=f,o}else return o;var v=a[a.length-1];return o.valid=Object(M.sliceUint8)(f,0,v.start-8),o.remainder=Object(M.sliceUint8)(f,v.start-8),o}function e(f,o){var a=new Uint8Array(f.length+o.length);return a.set(f),a.set(o,f.length),a}},"./src/utils/output-filter.ts":function(G,F,T){"use strict";T.r(F),T.d(F,"default",function(){return M});var M=function(){function O(b,C){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=b,this.trackName=C}var D=O.prototype;return D.dispatchCue=function(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},D.newCue=function(C,I,A){(this.startTime===null||this.startTime>C)&&(this.startTime=C),this.endTime=I,this.screen=A,this.timelineController.createCaptionsTrack(this.trackName)},D.reset=function(){this.cueRanges=[],this.startTime=null},O}()},"./src/utils/texttrack-utils.ts":function(G,F,T){"use strict";T.r(F),T.d(F,"sendAddTrackEvent",function(){return O}),T.d(F,"addCueToTrack",function(){return D}),T.d(F,"clearCurrentCues",function(){return b}),T.d(F,"removeCuesInRange",function(){return C}),T.d(F,"getCuesInRange",function(){return A});var M=T("./src/utils/logger.ts");function O(g,y){var L;try{L=new Event("addtrack")}catch{L=document.createEvent("Event"),L.initEvent("addtrack",!1,!1)}L.track=g,y.dispatchEvent(L)}function D(g,y){var L=g.mode;if(L==="disabled"&&(g.mode="hidden"),g.cues&&!g.cues.getCueById(y.id))try{if(g.addCue(y),!g.cues.getCueById(y.id))throw new Error("addCue is failed for: "+y)}catch(E){M.logger.debug("[texttrack-utils]: "+E);var p=new self.TextTrackCue(y.startTime,y.endTime,y.text);p.id=y.id,g.addCue(p)}L==="disabled"&&(g.mode=L)}function b(g){var y=g.mode;if(y==="disabled"&&(g.mode="hidden"),g.cues)for(var L=g.cues.length;L--;)g.removeCue(g.cues[L]);y==="disabled"&&(g.mode=y)}function C(g,y,L){var p=g.mode;if(p==="disabled"&&(g.mode="hidden"),g.cues&&g.cues.length>0)for(var E=A(g.cues,y,L),m=0;m<E.length;m++)g.removeCue(E[m]);p==="disabled"&&(g.mode=p)}function I(g,y){if(y<g[0].startTime)return 0;var L=g.length-1;if(y>g[L].endTime)return-1;for(var p=0,E=L;p<=E;){var m=Math.floor((E+p)/2);if(y<g[m].startTime)E=m-1;else if(y>g[m].startTime&&p<L)p=m+1;else return m}return g[p].startTime-y<y-g[E].startTime?p:E}function A(g,y,L){var p=[],E=I(g,y);if(E>-1)for(var m=E,u=g.length;m<u;m++){var t=g[m];if(t.startTime>=y&&t.endTime<=L)p.push(t);else if(t.startTime>L)return p}return p}},"./src/utils/time-ranges.ts":function(G,F,T){"use strict";T.r(F);var M={toString:function(D){for(var b="",C=D.length,I=0;I<C;I++)b+="["+D.start(I).toFixed(3)+","+D.end(I).toFixed(3)+"]";return b}};F.default=M},"./src/utils/timescale-conversion.ts":function(G,F,T){"use strict";T.r(F),T.d(F,"toTimescaleFromBase",function(){return O}),T.d(F,"toTimescaleFromScale",function(){return D}),T.d(F,"toMsFromMpegTsClock",function(){return b}),T.d(F,"toMpegTsClockFromTimescale",function(){return C});var M=9e4;function O(I,A,g,y){g===void 0&&(g=1),y===void 0&&(y=!1);var L=I*A*g;return y?Math.round(L):L}function D(I,A,g,y){return g===void 0&&(g=1),y===void 0&&(y=!1),O(I,A,1/g,y)}function b(I,A){return A===void 0&&(A=!1),O(I,1e3,1/M,A)}function C(I,A){return A===void 0&&(A=1),O(I,M,1/A)}},"./src/utils/typed-array.ts":function(G,F,T){"use strict";T.r(F),T.d(F,"sliceUint8",function(){return M});function M(O,D,b){return Uint8Array.prototype.slice?O.slice(D,b):new Uint8Array(Array.prototype.slice.call(O,D,b))}},"./src/utils/vttcue.ts":function(G,F,T){"use strict";T.r(F),F.default=function(){if(typeof self<"u"&&self.VTTCue)return self.VTTCue;var M=["","lr","rl"],O=["start","middle","end","left","right"];function D(g,y){if(typeof y!="string"||!Array.isArray(g))return!1;var L=y.toLowerCase();return~g.indexOf(L)?L:!1}function b(g){return D(M,g)}function C(g){return D(O,g)}function I(g){for(var y=arguments.length,L=new Array(y>1?y-1:0),p=1;p<y;p++)L[p-1]=arguments[p];for(var E=1;E<arguments.length;E++){var m=arguments[E];for(var u in m)g[u]=m[u]}return g}function A(g,y,L){var p=this,E={enumerable:!0};p.hasBeenReset=!1;var m="",u=!1,t=g,r=y,e=L,f=null,o="",a=!0,v="auto",h="start",l=50,s="middle",n=50,i="middle";Object.defineProperty(p,"id",I({},E,{get:function(){return m},set:function(c){m=""+c}})),Object.defineProperty(p,"pauseOnExit",I({},E,{get:function(){return u},set:function(c){u=!!c}})),Object.defineProperty(p,"startTime",I({},E,{get:function(){return t},set:function(c){if(typeof c!="number")throw new TypeError("Start time must be set to a number.");t=c,this.hasBeenReset=!0}})),Object.defineProperty(p,"endTime",I({},E,{get:function(){return r},set:function(c){if(typeof c!="number")throw new TypeError("End time must be set to a number.");r=c,this.hasBeenReset=!0}})),Object.defineProperty(p,"text",I({},E,{get:function(){return e},set:function(c){e=""+c,this.hasBeenReset=!0}})),Object.defineProperty(p,"region",I({},E,{get:function(){return f},set:function(c){f=c,this.hasBeenReset=!0}})),Object.defineProperty(p,"vertical",I({},E,{get:function(){return o},set:function(c){var S=b(c);if(S===!1)throw new SyntaxError("An invalid or illegal string was specified.");o=S,this.hasBeenReset=!0}})),Object.defineProperty(p,"snapToLines",I({},E,{get:function(){return a},set:function(c){a=!!c,this.hasBeenReset=!0}})),Object.defineProperty(p,"line",I({},E,{get:function(){return v},set:function(c){if(typeof c!="number"&&c!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");v=c,this.hasBeenReset=!0}})),Object.defineProperty(p,"lineAlign",I({},E,{get:function(){return h},set:function(c){var S=C(c);if(!S)throw new SyntaxError("An invalid or illegal string was specified.");h=S,this.hasBeenReset=!0}})),Object.defineProperty(p,"position",I({},E,{get:function(){return l},set:function(c){if(c<0||c>100)throw new Error("Position must be between 0 and 100.");l=c,this.hasBeenReset=!0}})),Object.defineProperty(p,"positionAlign",I({},E,{get:function(){return s},set:function(c){var S=C(c);if(!S)throw new SyntaxError("An invalid or illegal string was specified.");s=S,this.hasBeenReset=!0}})),Object.defineProperty(p,"size",I({},E,{get:function(){return n},set:function(c){if(c<0||c>100)throw new Error("Size must be between 0 and 100.");n=c,this.hasBeenReset=!0}})),Object.defineProperty(p,"align",I({},E,{get:function(){return i},set:function(c){var S=C(c);if(!S)throw new SyntaxError("An invalid or illegal string was specified.");i=S,this.hasBeenReset=!0}})),p.displayState=void 0}return A.prototype.getCueAsHTML=function(){var g=self.WebVTT;return g.convertCueToDOMTree(self,this.text)},A}()},"./src/utils/vttparser.ts":function(G,F,T){"use strict";T.r(F),T.d(F,"parseTimeStamp",function(){return D}),T.d(F,"fixLineBreaks",function(){return y}),T.d(F,"VTTParser",function(){return L});var M=T("./src/utils/vttcue.ts"),O=function(){function p(){}var E=p.prototype;return E.decode=function(u,t){if(!u)return"";if(typeof u!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(u))},p}();function D(p){function E(u,t,r,e){return(u|0)*3600+(t|0)*60+(r|0)+parseFloat(e||0)}var m=p.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return m?parseFloat(m[2])>59?E(m[2],m[3],0,m[4]):E(m[1],m[2],m[3],m[4]):null}var b=function(){function p(){this.values=Object.create(null)}var E=p.prototype;return E.set=function(u,t){!this.get(u)&&t!==""&&(this.values[u]=t)},E.get=function(u,t,r){return r?this.has(u)?this.values[u]:t[r]:this.has(u)?this.values[u]:t},E.has=function(u){return u in this.values},E.alt=function(u,t,r){for(var e=0;e<r.length;++e)if(t===r[e]){this.set(u,t);break}},E.integer=function(u,t){/^-?\d+$/.test(t)&&this.set(u,parseInt(t,10))},E.percent=function(u,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){var r=parseFloat(t);if(r>=0&&r<=100)return this.set(u,r),!0}return!1},p}();function C(p,E,m,u){var t=u?p.split(u):[p];for(var r in t)if(typeof t[r]=="string"){var e=t[r].split(m);if(e.length===2){var f=e[0],o=e[1];E(f,o)}}}var I=new M.default(0,0,""),A=I.align==="middle"?"middle":"center";function g(p,E,m){var u=p;function t(){var f=D(p);if(f===null)throw new Error("Malformed timestamp: "+u);return p=p.replace(/^[^\sa-zA-Z-]+/,""),f}function r(f,o){var a=new b;C(f,function(l,s){var n;switch(l){case"region":for(var i=m.length-1;i>=0;i--)if(m[i].id===s){a.set(l,m[i].region);break}break;case"vertical":a.alt(l,s,["rl","lr"]);break;case"line":n=s.split(","),a.integer(l,n[0]),a.percent(l,n[0])&&a.set("snapToLines",!1),a.alt(l,n[0],["auto"]),n.length===2&&a.alt("lineAlign",n[1],["start",A,"end"]);break;case"position":n=s.split(","),a.percent(l,n[0]),n.length===2&&a.alt("positionAlign",n[1],["start",A,"end","line-left","line-right","auto"]);break;case"size":a.percent(l,s);break;case"align":a.alt(l,s,["start",A,"end","left","right"]);break}},/:/,/\s/),o.region=a.get("region",null),o.vertical=a.get("vertical","");var v=a.get("line","auto");v==="auto"&&I.line===-1&&(v=-1),o.line=v,o.lineAlign=a.get("lineAlign","start"),o.snapToLines=a.get("snapToLines",!0),o.size=a.get("size",100),o.align=a.get("align",A);var h=a.get("position","auto");h==="auto"&&I.position===50&&(h=o.align==="start"||o.align==="left"?0:o.align==="end"||o.align==="right"?100:50),o.position=h}function e(){p=p.replace(/^\s+/,"")}if(e(),E.startTime=t(),e(),p.substr(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+u);p=p.substr(3),e(),E.endTime=t(),e(),r(p,E)}function y(p){return p.replace(/<br(?: \/)?>/gi,`
`)}var L=function(){function p(){this.state="INITIAL",this.buffer="",this.decoder=new O,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var E=p.prototype;return E.parse=function(u){var t=this;u&&(t.buffer+=t.decoder.decode(u,{stream:!0}));function r(){var h=t.buffer,l=0;for(h=y(h);l<h.length&&h[l]!=="\r"&&h[l]!==`
`;)++l;var s=h.substr(0,l);return h[l]==="\r"&&++l,h[l]===`
`&&++l,t.buffer=h.substr(l),s}function e(h){C(h,function(l,s){},/:/)}try{var f="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;f=r();var o=f.match(/^()?WEBVTT([ \t].*)?$/);if(!o||!o[0])throw new Error("Malformed WebVTT signature.");t.state="HEADER"}for(var a=!1;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(a?a=!1:f=r(),t.state){case"HEADER":/:/.test(f)?e(f):f||(t.state="ID");continue;case"NOTE":f||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(f)){t.state="NOTE";break}if(!f)continue;if(t.cue=new M.default(0,0,""),t.state="CUE",f.indexOf("-->")===-1){t.cue.id=f;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{g(f,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{var v=f.indexOf("-->")!==-1;if(!f||v&&(a=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=f}continue;case"BADCUE":f||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},E.flush=function(){var u=this;try{if((u.cue||u.state==="HEADER")&&(u.buffer+=`

`,u.parse()),u.state==="INITIAL"||u.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){u.onparsingerror&&u.onparsingerror(t)}return u.onflush&&u.onflush(),this},p}()},"./src/utils/webvtt-parser.ts":function(G,F,T){"use strict";T.r(F),T.d(F,"generateCueId",function(){return L}),T.d(F,"parseWebVTT",function(){return E});var M=T("./src/polyfills/number.ts"),O=T("./src/utils/vttparser.ts"),D=T("./src/demux/id3.ts"),b=T("./src/utils/timescale-conversion.ts"),C=T("./src/remux/mp4-remuxer.ts"),I=/\r\n|\n\r|\n|\r/g,A=function(u,t,r){return r===void 0&&(r=0),u.substr(r,t.length)===t},g=function(u){var t=parseInt(u.substr(-3)),r=parseInt(u.substr(-6,2)),e=parseInt(u.substr(-9,2)),f=u.length>9?parseInt(u.substr(0,u.indexOf(":"))):0;if(!Object(M.isFiniteNumber)(t)||!Object(M.isFiniteNumber)(r)||!Object(M.isFiniteNumber)(e)||!Object(M.isFiniteNumber)(f))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+u);return t+=1e3*r,t+=60*1e3*e,t+=60*60*1e3*f,t},y=function(u){for(var t=5381,r=u.length;r;)t=t*33^u.charCodeAt(--r);return(t>>>0).toString()};function L(m,u,t){return y(m.toString())+y(u.toString())+y(t)}var p=function(u,t,r){var e=u[t],f=u[e.prevCC];if(!f||!f.new&&e.new){u.ccOffset=u.presentationOffset=e.start,e.new=!1;return}for(;(o=f)!==null&&o!==void 0&&o.new;){var o;u.ccOffset+=e.start-f.start,e.new=!1,e=f,f=u[e.prevCC]}u.presentationOffset=r};function E(m,u,t,r,e,f,o,a){var v=new O.VTTParser,h=Object(D.utf8ArrayToStr)(new Uint8Array(m)).trim().replace(I,`
`).split(`
`),l=[],s=Object(b.toMpegTsClockFromTimescale)(u,t),n="00:00.000",i=0,d=0,c,S=!0,R=!1;v.oncue=function(P){var B=r[e],x=r.ccOffset,U=(i-s)/9e4;if(B!=null&&B.new&&(d!==void 0?x=r.ccOffset=B.start:p(r,e,U)),U&&(x=U-r.presentationOffset),R){var k=P.endTime-P.startTime,N=Object(C.normalizePts)((P.startTime+x-d)*9e4,f*9e4)/9e4;P.startTime=N,P.endTime=N+k}var K=P.text.trim();P.text=decodeURIComponent(encodeURIComponent(K)),P.id||(P.id=L(P.startTime,P.endTime,K)),P.endTime>0&&l.push(P)},v.onparsingerror=function(P){c=P},v.onflush=function(){if(c){a(c);return}o(l)},h.forEach(function(P){if(S)if(A(P,"X-TIMESTAMP-MAP=")){S=!1,R=!0,P.substr(16).split(",").forEach(function(B){A(B,"LOCAL:")?n=B.substr(6):A(B,"MPEGTS:")&&(i=parseInt(B.substr(7)))});try{d=g(n)/1e3}catch(B){R=!1,c=B}return}else P===""&&(S=!1);v.parse(P+`
`)}),v.flush()}},"./src/utils/xhr-loader.ts":function(G,F,T){"use strict";T.r(F);var M=T("./src/utils/logger.ts"),O=T("./src/loader/load-stats.ts"),D=/^age:\s*[\d.]+\s*$/m,b=function(){function C(A){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=A?A.xhrSetup:null,this.stats=new O.LoadStats,this.retryDelay=0}var I=C.prototype;return I.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},I.abortInternal=function(){var g=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),g&&(g.onreadystatechange=null,g.onprogress=null,g.readyState!==4&&(this.stats.aborted=!0,g.abort()))},I.abort=function(){var g;this.abortInternal(),(g=this.callbacks)!==null&&g!==void 0&&g.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},I.load=function(g,y,L){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=g,this.config=y,this.callbacks=L,this.retryDelay=y.retryDelay,this.loadInternal()},I.loadInternal=function(){var g=this.config,y=this.context;if(!!g){var L=this.loader=new self.XMLHttpRequest,p=this.stats;p.loading.first=0,p.loaded=0;var E=this.xhrSetup;try{if(E)try{E(L,y.url)}catch{L.open("GET",y.url,!0),E(L,y.url)}L.readyState||L.open("GET",y.url,!0);var m=this.context.headers;if(m)for(var u in m)L.setRequestHeader(u,m[u])}catch(t){this.callbacks.onError({code:L.status,text:t.message},y,L);return}y.rangeEnd&&L.setRequestHeader("Range","bytes="+y.rangeStart+"-"+(y.rangeEnd-1)),L.onreadystatechange=this.readystatechange.bind(this),L.onprogress=this.loadprogress.bind(this),L.responseType=y.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),g.timeout),L.send()}},I.readystatechange=function(){var g=this.context,y=this.loader,L=this.stats;if(!(!g||!y)){var p=y.readyState,E=this.config;if(!L.aborted&&p>=2)if(self.clearTimeout(this.requestTimeout),L.loading.first===0&&(L.loading.first=Math.max(self.performance.now(),L.loading.start)),p===4){y.onreadystatechange=null,y.onprogress=null;var m=y.status;if(m>=200&&m<300){L.loading.end=Math.max(self.performance.now(),L.loading.first);var u,t;if(g.responseType==="arraybuffer"?(u=y.response,t=u.byteLength):(u=y.responseText,t=u.length),L.loaded=L.total=t,!this.callbacks)return;var r=this.callbacks.onProgress;if(r&&r(L,g,u,y),!this.callbacks)return;var e={url:y.responseURL,data:u};this.callbacks.onSuccess(e,L,g,y)}else L.retry>=E.maxRetry||m>=400&&m<499?(M.logger.error(m+" while loading "+g.url),this.callbacks.onError({code:m,text:y.statusText},g,y)):(M.logger.warn(m+" while loading "+g.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,E.maxRetryDelay),L.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),E.timeout)}},I.loadtimeout=function(){M.logger.warn("timeout while loading "+this.context.url);var g=this.callbacks;g&&(this.abortInternal(),g.onTimeout(this.stats,this.context,this.loader))},I.loadprogress=function(g){var y=this.stats;y.loaded=g.loaded,g.lengthComputable&&(y.total=g.total)},I.getCacheAge=function(){var g=null;if(this.loader&&D.test(this.loader.getAllResponseHeaders())){var y=this.loader.getResponseHeader("age");g=y?parseFloat(y):null}return g},C}();F.default=b}}).default})}}]);

//# sourceMappingURL=404.737a0650.js.map