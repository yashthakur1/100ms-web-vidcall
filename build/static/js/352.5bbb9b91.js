"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[352],{3352:(ct,D,s)=>{s.r(D),s.d(D,{default:()=>st});var r=s(8160),F=s(8404),v=s.n(F),$=s(3751),B=s(8081),b=s(8546),N=s(3510),w=s(300),V=s(3133),j=s(9290),p=s(8485),U=s(7688),C=s(455),g=s(9024),S=s(8721),W=s(6939),G=s(7097),z=s(9520),Q=s(9478),X=Object.defineProperty,O=Object.getOwnPropertySymbols,Y=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable,P=(a,t,e)=>t in a?X(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e,K=(a,t)=>{for(var e in t||(t={}))Y.call(t,e)&&P(a,e,t[e]);if(O)for(var e of O(t))Z.call(t,e)&&P(a,e,t[e]);return a};function I(a){const t={};for(const n of a)t[n[0]]?t[n[0]].push(T(n[1])):t[n[0]]=[T(n[1])];return{rawTags:K({},t),duration:Number(t.INF[0]),fragmentStartAt:t["PROGRAM-DATE-TIME"]?new Date(t["PROGRAM-DATE-TIME"][0]):void 0}}function J(a){const t=a.split(","),e={};for(const n of t){const[o,l]=n.split("=");e[o]=T(l)}return{duration:e.DURATION,id:e.ID,startTime:new Date(e["START-DATE"]),payload:e["X-100MSLIVE-PAYLOAD"]}}function M(a){if(a)return a.getHours()*60*60+a.getMinutes()*60+a.getSeconds()}function k(a,t){return!!a.filter(n=>n.id===t.id).length}function T(a){return a.replace(/^"(.*)"$/,"$1")}var q=Object.defineProperty,H=Object.getOwnPropertySymbols,_=Object.prototype.hasOwnProperty,tt=Object.prototype.propertyIsEnumerable,A=(a,t,e)=>t in a?q(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e,et=(a,t)=>{for(var e in t||(t={}))_.call(t,e)&&A(a,e,t[e]);if(H)for(var e of H(t))tt.call(t,e)&&A(a,e,t[e]);return a},E=(a,t,e)=>(A(a,typeof t!="symbol"?t+"":t,e),e);const x="hls-timed-metadata",y="hls-stream-no-longer-live",rt=10;class at{constructor(t,e){E(this,"hls"),E(this,"videoRef"),E(this,"metadataByTimeStamp",new Map),E(this,"eventEmitter",new z.EventEmitter2),E(this,"isLive",!0),this.hls=new(v())(this.getHLSConfig()),this.videoRef=e,this.hls.loadSource(t),this.hls.attachMedia(e.current),this.handleHLSTimedMetadataParsing(),this.ControllerEvents=[x,y]}reset(){this.hls&&this.hls.media&&(this.hls.detachMedia(),this.hls=null),this.metadataByTimeStamp=null,this.eventEmitter=null}getCurrentLevel(){return this.hls.currentLevel}setCurrentLevel(t){this.hls.currentLevel=t}jumpToLive(){const t=this.videoRef.current;if(t.currentTime=this.hls.liveSyncPosition,t.paused)try{t.play()}catch(e){console.error("Attempt to jump to live position Failed.",e)}}on(t,e){t===y&&this.enableTimeUpdateListener(),this.ControllerEvents.indexOf(t)===-1?this.hls.on(t,e):this.eventEmitter.addListener(t,e)}enableTimeUpdateListener(){this.videoRef.current.addEventListener("timeupdate",t=>{if(this.hls){const e=this.videoRef.current,n=this.getHLSConfig().liveMaxLatencyDuration||rt;this.isLive=this.hls.liveSyncPosition-e.currentTime<=n,this.isLive||this.eventEmitter.emit(y)}})}handleHLSTimedMetadataParsing(){this.hls.on(v().Events.BUFFER_APPENDED,(t,{frag:e})=>{try{const n=e?.tagList,l=I(n).rawTags["EXT-X-DATERANGE"]||[];if(l.length>0)for(let m of l){const d=J(m),u=M(d.startTime);if(this.metadataByTimeStamp.has(u)){const h=this.metadataByTimeStamp.get(u);k(h,d)||this.metadataByTimeStamp.get(u).push(d)}else this.metadataByTimeStamp.set(u,[et({},d)])}}catch(n){console.error("Error in extracting timemetadata",n)}}),this.hls.on(v().Events.FRAG_CHANGED,(t,{frag:e})=>{try{const n=I(e?.tagList),o=M(n.fragmentStartAt),l=[];this.metadataByTimeStamp.forEach((h,f)=>{l.push(f)});let m=o;l.push(o),l.sort();const d=l.indexOf(o);if(m=l[d+1],isNaN(m))return;const u=m-o;if(u>=0&&u<n.duration){const h=this.metadataByTimeStamp.get(m).map(f=>f.payload);setTimeout(()=>{this.eventEmitter.emit(x,h),this.metadataByTimeStamp.delete(m)},u*1e3)}}catch(n){console.error("Frag changed event listener error:",n)}})}getHLSConfig(){return Q.T.optimiseHLSLatency()?{enableWorker:!0,liveSyncDuration:1,liveMaxLatencyDuration:5,liveDurationInfinity:!0,highBufferWatchdogPeriod:1}:{enableWorker:!0,maxBufferLength:20,backBufferLength:10}}}const nt=(0,j.zo)("video",{h:"100%",margin:"0 auto",px:"$10"});let c;const st=()=>{var a;const t=(0,r.useRef)(null),n=(a=(0,$._U)(B.Yt).variants[0])==null?void 0:a.url,[o,l]=(0,r.useState)([]),[m,d]=(0,r.useState)(!0),[u,h]=(0,r.useState)(""),[f,it]=(0,r.useState)(!1);(0,r.useEffect)(()=>{t.current&&n&&(v().isSupported()?(c=new at(n,t),c.on(y,()=>{d(!1)}),c.on(x,i=>{console.log(`%c Payload: ${i}`,"color:#2b2d42; background:#d80032"),G.y.addToast({title:`Payload from timed Metadata ${i}`})}),c.on(v().Events.MANIFEST_LOADED,(i,{levels:L})=>{l(L),h("Auto")})):t.current.canPlayType("application/vnd.apple.mpegurl")&&(t.current.src=n))},[n]),(0,r.useEffect)(()=>{if(c)return()=>c.reset()},[]);const R=(0,r.useCallback)(i=>{if(c){c.setCurrentLevel(ot(i));const L=i.height==="auto"?"Auto":`${i.height}p`;h(L)}},[o]),ot=i=>{if(i.height==="auto")return-1;const L=o.findIndex(({url:lt})=>lt===i.url);return o.length-1-L};return r.createElement(r.Fragment,null,n?r.createElement(r.Fragment,null,r.createElement(p.k,{align:"center",justify:"center",css:{position:"absolute",right:"$10",zIndex:"10"}},c?r.createElement(U.z,{variant:"standard",css:{marginRight:"0.3rem"},onClick:()=>{c.jumpToLive(),d(!0)},key:"LeaveRoom","data-testid":"leave_room_btn"},r.createElement(C.u,{title:"Jump to Live"},r.createElement(p.k,null,r.createElement(b.Z,{color:m?"#CC525F":"FAFAFA",key:"jumpToLive"}),"Live"))):null,r.createElement(g.L.Root,{open:f,onOpenChange:i=>it(i)},r.createElement(g.L.Trigger,{asChild:!0,"data-testid":"quality_selector"},r.createElement(p.k,{css:{color:"$textPrimary",borderRadius:"$1",cursor:"pointer",zIndex:4,border:"$space$px solid $textDisabled",padding:"$4"}},r.createElement(C.u,{title:"Select Quality"},r.createElement(p.k,null,r.createElement(N.Z,null),r.createElement(S.x,{variant:"md"},u))),r.createElement(W.x,{css:{"@lg":{display:"none"},color:"$textDisabled"}},f?r.createElement(w.Z,null):r.createElement(V.Z,null)))),o.length>0&&r.createElement(g.L.Content,{sideOffset:5,align:"end",css:{height:"auto",maxHeight:"$96"}},r.createElement(g.L.Item,{onClick:i=>R({height:"auto"}),css:{h:"auto",flexDirection:"column",flexWrap:"wrap",cursor:"pointer",alignItems:"flex-start"},key:"auto"},r.createElement(S.x,null,"Automatic")),o.map(i=>r.createElement(g.L.Item,{onClick:()=>R(i),css:{h:"auto",flexDirection:"column",flexWrap:"wrap",cursor:"pointer",alignItems:"flex-start"},key:i.url},r.createElement(S.x,null,`${i.height}p (${(Number(i.bitrate/1024)/1024).toFixed(2)} Mbps)`)))))),r.createElement(nt,{ref:t,autoPlay:!0,controls:!0,playsInline:!0})):r.createElement(p.k,{align:"center",justify:"center",css:{size:"100%",px:"$10"}},r.createElement(S.x,{variant:"md",css:{textAlign:"center"}},"Waiting for the Streaming to start...")))}}}]);

//# sourceMappingURL=352.5bbb9b91.js.map